<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title></title>
	<style type="text/css">
		label {
			display: block;
		}
	</style>
</head>
<body>

<label>Please input your name: <input type="text" id="txtName"/>
</label>

<div id="divMessage"/>

</body>
<script src="../../ref/jquery.js"></script>
<script src="../../src/modelProxy.js"></script>
<script src="../../src/eventSubscription.js"></script>
<script>
	via.set( "test", {
		name: "",
		message: function() {
			return this.name ? "hello, " + this.name : "";
		}
	} );

	//simplify the handler a bit
	via( "test.name" ).subscribe( $( "#txtName" ), "change", "val" );
	$( "#divMessage" ).subscribe( "test.message", "afterUpdate", "html" );
	via( "_" ).subscribe( "test.message", "afterUpdate", function( e ) {
		alert( e.publisher.get() );
	} );

	via.debug.enableLog = false;
	via().set( "p", {
		firstName: "John",
		lastName: "Doe",
		fullName: function() {
			return this.firstName + "," + this.lastName;
		},
		addresses: [
			{
				street: "Yonge Street 1",
				city: "Toronto"
			},
			{
				street: "5th Ave 1",
				city: "New York"
			}
		]
	} );

	function printEvent ( e ) {
		console.log(
			"publisher path/value: " + e.publisher.path + "/" + e.publisher.get() +
			", originalPublisher path/value: " + e.originalPublisher.path + "/" + e.originalPublisher.get() +
			", subscribedEvent: " + e.subscribedEvent +
			", type: " + e.type +
			", level: " + e.level +
			", proposed: " + e.proposed +
			", removed: " + e.removed );
	}

	//via( "_" ).subscribe( "p.firstName", "*", printEvent );
	//via( "_" ).subscribe( "p.fullName", "*", printEvent );
	//	via( "_" ).subscribe( "p.addresses", "*", printEvent );
	via( "_" ).subscribe( "p", "*", printEvent );

	//via.set( "p.firstName", "fred" );
	//via.set("p.addresses.0.city", "Beijing");
	//via("p.addresses").removeAt(0);
	via( "p.addresses" ).push( {
		street: "Ave road",
		city: "Montreal"
	} );


</script>
</html>