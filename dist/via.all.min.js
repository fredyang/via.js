/*! via.js v0.2pre Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */(function(g,ea,v){function Ja(a,b){for(var c in b)a[c]||(a[c]=b[c])}function xb(a){return"."===a?"#":na(a.length+2).join("#")}function yb(a){if(a===u)return"";var b=Ka.exec(a);return b?b[1].replace(oa,pa):a}function pa(a){return"#"==a?".":na(a.length).join("#")}function qa(a,b,c,d){var e,f=a.lastIndexOf(".");l(d)&&(d=!0);d&&(-1===f?(d="",e=a):(d=a.substring(0,f),e=a.substring(f+1)),c(d,e,b));if(!T(b))for(e in b)c(a,e,b[e]),qa(a+"."+e,b[e],c,!1)}function La(a,b,c){if(q(c)&&"no_watch"!=c.name){for(var b=
a?a+"."+b:b,d=c.toString(),e,c=[];e=zb.exec(d);)c.pushUnique(e[2]);for(d=0;d<c.length;d++)Ma(b,a?z(a,c[d]):c[d])}}function Ma(a,b){b=C(b);o[b]=o[b]||[];o[b].pushUnique(a)}function Na(a,b){b=C(b);o[b].remove(a);o[b].length||delete o[b]}function Oa(a){return(a=Ab.exec(a))&&a[1]||""}function L(a,b,c,d,e){return b?b+(c-1):d+(e-1)}function fa(){return!1}function U(){return!0}function V(a,b,c,d,e){this.publisher=D(a);this.originalPublisher=D(b);this.type=c;this.proposed=d;this.removed=e}function ra(a,b){i(a)&&
(a=C(a));for(var c=[],d=I.length-1,e;0<=d;d--)e=I[d],b(e,a)&&c.push(e);return c}function Bb(a){var b=this.getMethod,c=this.getProp,a=a.publisher;return c?a[b](c):q(a[b])?a[b]():a[b]}function Cb(a,b){var c=this.setMethod,d=this.setProp,e=b.subscriber;d?e[c](d,a):q(e[c])?e[c](a):e[c]=a}function Pa(a,b,c,d){I.push({publisher:a,subscriber:c,eventTypes:b,handler:d})}function Qa(a,b,c){var d=g(b).viewId();return g.map(a.split(sa),function(a){return i(c)?a+"."+u+"."+d+"."+c:a+"."+u+"."+d+"."+g(c).data(u)}).join(" ")}
function D(a){return i(a)?h(a):a==Ra?null:w(a)&&!a.nodeType?a:g(a)}function Sa(a){w(a)&&!g(a).data(u)&&g(a).data(u,++Db)}function Eb(a){return"."==a?"\\.":".*"}function Ta(a){var b,c,d;d=a.publisher.subsFromOthers();if(d.length)for(c=0;c<d.length;c++){b=d[c];var e=a,f;a:{f=b.eventTypes;var g=a.type,j=void 0,h=void 0,M=j=void 0,i=void 0;if("*"===f)f="*";else{f=f.split(sa);for(i=0;i<f.length;i++)if(j=f[i],(M=Ua.test(j))&&(j=j.replace(Ua,"")),h=j.replace(Fb,Eb),h=M?new y("^"+h):new y("^"+h+"$"),j=h.test(g))if(M){if(M=
"^"==h.source?g:y.rightContext,!M||!M.contains(".")){f=f[i];break a}}else{f=f[i];break a}f=void 0}}e.subscribedEvent=f;if(a.subscribedEvent)a.subscriber=D(b.subscriber),ga(b.handler,a);if(a.isImmediatePropagationStopped())return}if(!a.isCascadeStopped()&&(b=o[a.publisher.path]))for(d=0;d<b.length;d++){c=r(b[d],a.originalPublisher.path,a.type);if(c.isImmediatePropagationStopped()||c.isImmediatePropagationStopped())break;c.hasError()&&a.error()}}function ga(a,b,c){var d,c=l(c)?a.get(b):a.get.apply(a,
[b].concat(c));if(W(c))d=m(!0,{},b),c.done(function(c){a.convert&&(c=a.convert(c,b));if(!l(c))if(W(c))c.done(function(b){ha(a,b,d)});else return ha(a,c,b)});else if(a.convert&&(c=a.convert(c,b)),!l(c))if(W(c))d=m(!0,{},b),c.done(function(b){ha(a,b,d)});else return ha(a,c,b)}function ha(a,b,c){if(!l(b)&&(a.set&&a.set(b,c),!l(b)&&a.finalize))return a.finalize(b,c)}function Gb(a,b,c,d,e){var f,g,j,h,i;i=b.split(" ");for(var k=0;k<i.length;k++)if(f=Hb.exec(i[k])){j=i[k];g=+f[1];i.splice(k,1);b=i.join(" ");
break}h=X(d,a,c,e);b&&Pa(a,b,c,h);j&&(b=function(){var b=new V(a,a,j);b.subscriber=D(c);ga(h,b)},g?setTimeout(b,g):b())}function Ib(a,b,c,d,e,f){var n,j;j=b.split(" ");j.contains("init")&&(n=!0,b=j.remove("init").join(" "));e=X(d,a,c,e);d={handler:e,subscriber:c};b?(b=Qa(b,a,c),f?(e.delegateSelector=f,g(a).delegate(f,b,d,E)):g(a).bind(b,d,E),Pa(a,b,c,e),n&&(f?g(a).find(f).trigger(b):g(a).trigger(b))):n&&(g(a).one("init",d,E),g(a).trigger("init"))}function E(a){a.publisher=D(a.currentTarget);a.originalPublisher=
D(a.target);a.subscriber=D(a.data.subscriber);var b=a.data.handler;delete a.data;1<arguments.length?ga(b,a,F.call(arguments,1)):ga(b,a)}function X(a,b,c,d){var e,a=a||"";if(i(a)){var f=a,g,a=f.split(sa),j=i(b),h=i(c);if(1==a.length)if(f.startsWith("*")){e=N[f.substr(1)];if(!e)throw"common handler "+f+" does not exist";e=m({},e)}else(g=Va(f,b,c))?e={get:g}:!l(b)&&!l(c)&&(e=j?{get:"get",set:f||"set"}:h?f?{get:f,set:"set"}:{get:k.helper(c)}:{get:f,set:f});else{e={};for(j=0;j<Wa.length;j++)(f=a[j])&&
"_"!==f&&"null"!=f&&(e[Wa[j]]=(g=Va(f,b,c))?g:f)}}else if(q(a)||w(a)&&a.get){e=a;if(q(a))e.get=a;if(!e.set&&!l(c)&&i(c))e.set="set"}else throw"invalid handler";!l(b)&&!l(c)&&Jb(e,b,c,d);d=e;ia(d,"initialize",ja);Xa("get",d,b,c);Xa("set",d,b,c);ia(d,"convert",ta);ia(d,"finalize",ua);ia(d,"dispose",Ya);return e}function Jb(a,b,c,d){var e=a.initialize;if(i(e))if(e.startsWith("*")){if(e=ja[e.substring(1)],!e)throw"common initializer does not exist!";}else{var f=e;if(!k.helper(f))throw"initializer does not exist at path "+
f;e=function(a,b,c,d){k.set(f,a,b,c,d)}}if(e)e(D(b),D(c),a,d),delete a.initialize;else if(!l(d))a.options=d}function Va(a,b,c){if(a.startsWith("#"))return a=a.substr(1),i(c)?k.helper(z(c,a)):i(b)?k.helper(z(b,a)):k.helper(a)}function Xa(a,b,c,d){var e=b[a];if(i(e)&&""!=e){var f="get"==a?Za:$a;if(e.startsWith("*")){if(e=e.substr(1),b[a]=f[e],!b[a])throw e+" does not exists common "+a+" filter";}else if(e=e.split("*"),b[a]="get"==a?Bb:Cb,b[a+"Method"]=e[0],e[1]&&(b[a+"Prop"]=e[1]),!l(c)&&!l(d)){var b=
e[0],c="get"==a?c:d,g;i(c)?G[b]||(g=!0):c.nodeType?Y[b]||(g=!0):b in c||(g=!0);if(g)throw("get"==a?"publisher":"subscriber")+" does not have a member "+b;}}}function ia(a,b,c){var d=a[b];i(d)&&(a[b]=d.startsWith("*")?c[d.substr(1)]:function(){return k.set.apply(k,[d].concat(F.call(arguments)))})}function ab(a,b,c){var d;i(a)&&(a.startsWith("$")?(d=(a=a.substr(1))?g(c).findAll(a):g(c),a=d):"."==a?a=b:"_"!==a&&(a=z(b,a)));return a}function bb(a){if(a){for(var b={},c,d,e;c=Kb.exec(a);)e=c[1],d=g.trim(c[2]),
c=g.trim(c[4])||null,"`"==e?(c=c?d+"|"+c:d,d="class"):"$"==e?(c=d+"|"+c,d="pub"):"!"==e&&(c=c.split(Z),c.splice(1,0,d),c=c.join("|"),d="sub"),b[d]=b[d]?b[d]+";"+c:c;return b}}function cb(a){var b=h.themes[a],c=[],d=b.parentThemes;!d&&"via"!=a&&(d="via");"null"==d&&(d=v);b.classes&&c.push(b.classes);if(d){d=d.split(";");for(a=0;a<d.length;a++)c=c.concat(cb(d[a]))}return c}function va(a,b){for(var c=g(a);(c=c.parent())&&c.length;){var d=c.dataSub();if(d&&d[b])return d[b]}return""}function db(a,b,c,
d){var e,f,n,j,h,i,k=c[a]&&c[a].split(";");if(k)for(e=0;e<k.length;e++)if(f=g.trim(k[e]))if(f=f.split(Z))"sub"==a?(n=f[0],n=n.startsWith("$")?n:z(c.ns,n),j=f[1],h=b):(n=b,j=f[0],h=f[1],h=h.startsWith("$")?h:z(c.ns,h)),i=f[3],i=O(i?i:c.options),d.push({publisher:n,eventTypes:j,subscriber:h,handler:f[2],options:i,delegate:f[4]})}function Lb(a){var b=g.trim(g(a).attr(p.subsAttr));if(b){b=bb(b);g(a).dataSub(b);if(b.ns&&"."!==b.ns){if(wa.exec(b.ns))b.ns=z(va(a,"ns"),b.ns)}else b.ns=va(a,"ns");b.theme=
b.theme||va(a,"theme")||p.theme;var c=[];eb(a,b,c);return c.length?c:v}}function eb(a,b,c){var d,e,f,n,j;j=b[Mb];if(!(f=!j))if(!(f="_"===j)){var i;b:if(f=b.theme,!f||!h.themes[f])i=!1;else{if(!h.themes[f].loaded){d=cb(f);if(!d){i=!1;break b}for(e=d.length-1;n=d[e];e--)for(i in n)fb[f+"."+i]=n[i];h.themes[f].loaded=!0}i=!0}f=!i}if(!f){j=j.split(Nb);for(i=0;i<j.length;i++)if(d=Ob.exec(j[i]),f=d[1],f=g.trim(fb[b.theme+"."+f]),f=bb(f)){e=d[3];d=d[5];f.ns=z(z(b.ns,e),f.ns);f.theme=b.theme;d?(e=d.split(Z),
f.options=2==e.length?e[1]:d):f.options=b.options;if(d)if(n=f.sub,e=f.pub,!n&&e&&1==e.split(";").length)e=e.split(Z),f.pub=l(e[3])?f.pub+("|"+d):f.pub+d;else if(!e&&n&&1==n.split(";").length)e=n.split(Z),f.sub=l(e[3])?f.sub+("|"+d):f.sub+d;eb(a,f,c)}}for(var k in b)if(xa.call(b,k)&&!Pb.contains(k))if(A[k])A[k](a,b,c,"."==b[k]?b.options:b[k]);else g(a).dataSub()[k]=b[k];db("sub",a,b,c);db("pub",a,b,c)}function ya(a){if(!g(a).attr(p.subsAttr)||!g(a).dataSub()){var b,c,d=Lb(a);if(d)for(b=0;b<d.length;b++)c=
d[b],s(c.subscriber,c.publisher,c.eventTypes,c.handler,c.options,c.delegate)}g(a).children().each(function(){ya(this)})}function P(a,b,c){return m({},za,w(a)?a:{get:a,set:b,finalize:c})}function gb(a){a=a||$.defaultEngine;if(!a)throw"engine name is not specified or default engine name is null";a=ka[a];if(!a)throw"engine '"+a+"' can not be found.";return a}function Qb(a,b,c,d){var e=gb(d,a),a=g.trim(a);if(!e.isTemplateLoaded||e.isTemplateLoaded(a))return e.render(a,b,c);var f=g.Deferred();$.load(a).done(function(){var d=
e.render(a,b,c),j=g(d);f.resolve(j.selector||!j.length?d:j)});return f.promise()}function Aa(a){var a=a.originalPublisher.path.substr(a.publisher.path.length+1),b=a.indexOf(".");return-1==b?a:a.substr(0,b)}function hb(a,b){var c,d;if(b)for(c=J.length-1;0<=c;c--){if(d=J[c],d.name==b)return d}else for(c=J.length-1;0<=c;c--)if(d=J[c],d.match&&d.match(a))return d}function ib(a){a=a[0];return"true"==a.value?!0:"false"==a.value?!1:"on"!==a.value?a.value:a.checked}function jb(a){if(""===a)return!Ba.length;
for(var b=a+".",c=0,d,e=Ba.length;c<e;c++)if(d=Ba[c],d==a||d.startsWith(b))return!1;return!0}function kb(a){var b=a+"*isValid",c=h.get(b);l(c)&&(k.set(b,null),s(a,"*pathsOfInvalidModels","after*",Rb));return c}function Rb(a){h.set(a.subscriber.path+"*isValid",jb(a.subscriber.path))}function lb(a){g.each(F.call(arguments,1),function(b,c){a=a.replace(new y("\\{"+b+"\\}","g"),c)});return a}function mb(a){var b={get:function(b){var d,e,f;d=this.options;f=a.name&&p.errors[a.name];a.buildError?f=a.buildError(f,
d):(d=w(d)?d.error:d,f=f&&f.contains("{0}")?lb.apply(null,[f].concat(d.split(","))):d||f||a.error);if(null===b.proposed||b.proposed===v||Sb.test(b.proposed)){a:{d=h(b.publisher.path).subsFromOthers();for(var g=0;g<d.length;g++)if(d[g].handler.get===h.handlers("required").get){d=!0;break a}d=!1}d?(d=!1,e=!0):d=!0}else d=a.isValid(b.proposed,this.options);if(d)b.removeError(f);else if(!e||"required"===a.name)b.error(),b.addError(f)}};if(a.initialize)b.initialize=a.initialize,delete a.initialize;return b}
function Q(a,b){return b?function(b){return!a.test(b)}:function(b){return a.test(b)}}function K(){var a=F.call(arguments,0);return function(b,c){return c.error||lb.apply(null,[b].concat(g.map(a,function(a){return c[a]})))}}function Ca(a,b,c){i(b)?s(null,a,nb,"*"+b,c):q(b)&&s(null,a,nb,mb({isValid:b,error:c}));return this}function ob(a){var a=w(a)?R(a.publisher.path):a,b={};b[a]=k.get(a);Tb(b)}function la(a,b,c){var d=g(a).data("appLoader");d||(d={},g(a).data("appLoader",d));if(l(c))return d[b];c?
d[b]=c:delete d[b]}function Ub(a){var b=a.load,c=a.unload;a.load=function(a,c){la(a,this.name)||(b.call(this,a,c),la(a,this.name,this))};a.unload=function(a){la(a,this.name)&&(c.call(this,a),la(a,this.name,null))}}var h=ea.via=function(a,b){return new Da(a,b)},Da=function(a,b){this.path=C(a||"",!0);l(b)||this.set(b)},G,m=g.extend,Ea={},B=g.isArray,q=g.isFunction,Vb={undefined:v,"boolean":v,number:v,string:v},u="__via",Ka=/^__via\.([^\.]+?)(?:\.|$)/,zb=/this\.(?:get|cd)\s*\(\s*(['"])([\*\.\w]+)\1\s*\)/g,
o={},p={},k,S=Ea[u]={},xa=Ea.hasOwnProperty,na=ea.Array,pb=na.prototype,Wb=String.prototype,F=pb.slice,r,Xb=/^(?:\{.*\}|\[.*\])$/,qb=/^\.(\.*)([\.\*])/,wa=/^[\.\*]/,Yb=/[\.\*]/,Zb=/#+|\./g,oa=/#+/g,y=ea.RegExp,Ab=/^(.+)[\.\*]\w+$/,z,$b=/^.+\.(\w+)$|\w+/,ma,l,T,i,w,aa,W,O,C,R,Fa,ba;Ja(pb,{indexOf:function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]==a)return c;return-1},contains:function(a){return-1!==this.indexOf(a)},remove:function(a){a=this.indexOf(a);-1!=a&&this.splice(a,1);return this},removeAt:function(a){this.splice(a,
1);return this},pushUnique:function(a){this.contains(a)||this.push(a);return this},merge:function(a){if(a&&a.length)for(var b=0;b<a.length;b++)this.pushUnique(a[b]);return this},sortObject:function(a,b){l(b)&&(b=!0);a?this.sort(function(c,d){var e=c[a],f=d[a];return e==f?0:b?e>f?1:-1:e>f?-1:1}):b?this.sort():this.sort().reverse()}});Ja(Wb,{startsWith:function(a){return 0===this.indexOf(a)},contains:function(a){return-1!==this.indexOf(a)},endsWith:function(a){return this.lastIndexOf(a)===this.length-
a.length}});G=Da.prototype=h.fn=h.prototype={constructor:Da,get:function(a){var b=this.accessor(a,!0);if(b)return b=!b.index?b.hostObj:b.hostObj[b.index],q(b)?b.apply(this.cd(a).cd(".."),F.call(arguments,1)):b},helper:function(a,b){var c;q(a)&&(b=a,a="");if(b)return c=this.accessor(a),c.index in c.hostObj?this.update(a,b,c):this.create(a,b,c);if(c=this.accessor(a,!0))return!c.index?c.hostObj:c.hostObj[c.index]},set:function(a,b){if(1==arguments.length){if(""==this.path)throw"root object can not changed";
k.set(this.path,a);return this}var c=this.accessor(a),d=c.hostObj[c.index];if(q(d)){if(d.length)return d.apply(h(c.physicalPath).cd(".."),F.call(arguments,1));throw"Function at "+c.logicalPath+" is not a setter method";}return c.index in c.hostObj?this.update(a,b,c):this.create(a,b,c)},accessor:function(a,b){0===a&&(a="0");var c,d,e=Ea,f=this.fullPath(a),g=C(f,!0),j=g.split(".");if(1===j.length)d=g;else{d=j[j.length-1];for(c=0;c<j.length-1&&!(e=e[j[c]],e===v);c++);}if(T(e)){if(b)return;throw"invalid access model using path:"+
f;}return{physicalPath:g,logicalPath:f,hostObj:e,index:d}},create:function(a,b,c){c=c||this.accessor(a);if(c.index in c.hostObj)throw"value at path: '"+c.logicalPath+"' has been defined, try use update method instead";a=c.physicalPath;if(r(a,a,"beforeCreate",b).hasError())return!1;c.hostObj[c.index]=b;r(a,a,"afterCreate");qa(a,b,La);return this},extend:function(a,b){var c;b?c=this.cd(a):(b=a,c=this);for(var d in b)c.set(d,b[d]);return this},update:function(a,b,c,d){aa(a)||(d=c,c=b,b=a,a=!1);d=d||
this.accessor(b);if(!(d.index in d.hostObj))throw"value at path: '"+d.logicalPath+"' has been not defined, try use create method instead";b=d.physicalPath;if(!a&&r(b,b,"beforeUpdate",c).hasError())return!1;a=d.hostObj[d.index];if(a===c)return this;d.hostObj[d.index]=c;r(b,b,"afterUpdate",c,a);qa(b,c,La);return this},del:function(a){if(a===v)return this.path?k.del(this.path):this;var a=this.accessor(a),b=a.physicalPath;if(r(b,b,"beforeDel").hasError())return!1;for(var c=0;c<Ga.length;c++)Ga[c](b,a.logicalPath);
c=a.hostObj[a.index];B(a.hostObj)?a.hostObj.splice(a.index,1):delete a.hostObj[a.index];r(b,b,"afterDel",v,c);return this},createIfUndefined:function(a,b){var c=this.accessor(a);return c.index in c.hostObj?this:this.create(a,b,c)},pushStack:function(a){a.previous=this;return a},cd:function(a){return this.pushStack(h(this.fullPath(a)))},parentModel:function(){return this.cd("..")},shadowModel:function(){return this.cd("*")},siblingModel:function(a){return this.cd(".."+a)},mainModel:function(){return this.pushStack(h(yb(this.path)))},
triggerChange:function(a){a=this.physicalPath(a);r(a,a,"afterUpdate");return this},fullPath:function(a){return z(this.path,a)},logicalPath:function(a){return R(this.fullPath(a))},physicalPath:function(a){return C(this.fullPath(a))},contextPath:function(){return Oa(this.path)},indexPath:function(){var a=$b.exec(this.path);return a[1]||a[0]},indexOf:function(a){return this.get().indexOf(a)},contains:function(a){return-1!==this.indexOf(a)},first:function(a){return a?this.filter(a)[0]:this.get("0")},
last:function(){var a=this.get();return a[a.length-1]},push:function(a){return this.create(this.get().length,a)},pushRange:function(a){for(var b=0;b<a.length;b++)this.push(a[b]);return this},pushUnique:function(a){return!this.contains(a)?this.push(a):this},pop:function(){return this.removeAt(this.get().length-1)},insertAt:function(a,b){this.get().splice(a,0,b);r(this.path,this.path+"."+a,"afterCreate");return this},updateAt:function(a,b){return this.update(a,b)},removeAt:function(a){this.del(a);var a=
this.path,a="("+a.replace(".","\\.")+"\\.)(\\d+)|("+a.replace(".","#+")+"#+)(\\d+)",a=new y(a,"g"),b;for(b in o)if(xa.call(o,b)){var c=o[b],d=b.replace(a,L);d!==b&&(o[d]=c,delete o[b]);for(d=0;d<c.length;d++){var e=c[d],f=e.replace(a,L);f!=e&&(c[d]=f)}}return this},prepend:function(a){return this.insertAt(0,a)},updateItem:function(a,b){if(a==b)return this;var c=this.indexOf(a);if(-1!=c)return this.updateAt(c,b);throw"oldItem not found";},removeItem:function(a){a=this.indexOf(a);return-1!==a?this.removeAt(a):
this},removeItems:function(a){for(var b=0;b<a.length;b++)this.removeItem(a[b]);return this},clear:function(){var a=this.get();a.splice(0,a.length);r(this.path,this.path,"create");return this},count:function(){return this.get().length},filter:function(a){return g(this.get()).filter(a).get()},each:function(a,b){aa(a)||(b=a,a=!1);var c,d,e,f;if(a){f=this.get();for(d=f.length-1;0<=d;d--)if(e=b(d,f[d],f),!0===e)c=!0;else if(!1===e)break;c&&this.triggerChange()}else for(d=this.count()-1;0<=d&&!(!1===b(d,
this.cd(d),this));d--);},sort:function(a,b){return r(this.path,this.path,"afterUpdate",this.get().sortObject(a,b))},isEmpty:function(a){a=this.get(a);return!a?!0:!B(a)?!1:0===a.length},isShadow:function(){return this.path.startsWith(u)},watchPath:function(a){Ma(this.path,a);return this},unwatchPath:function(a){Na(this.path,a);return this},pathsWatching:function(){var a,b,c=[],d=this.path;for(a in o)b=o[a],b.contains(d)&&c.push(a);return c},pathsOfWatchers:function(a){var b=o[this.path]||[];if(a)for(var c=
0;c<b.length;c++)b.merge(h(b[c]).pathsOfWatchers(a));return b}};var Ga=[function(a,b){for(var c in o)Na(a,c);for(c in o)c.startsWith(a)&&delete o[c];for(var d in S){c=u+"."+d;var e=R(c);(e==b||e.startsWith(b+"*")||e.startsWith(b+"."))&&k.del(c)}}];m(h,{util:ma={factory:function(a,b){var c;q(a)?c=eval("(function "+a.name+" () {})"):(c=function(){},b=a,a=null);m(c.prototype,b);return function(){var b=new c;a&&a.apply(b,arguments);return b}},toPhysicalPath:C=function(a,b){for(var c,d="",e="",f;c=Yb.exec(a);)a=
y.rightContext,e=y.leftContext,"."==c[0]?d?(d==u&&b&&!S[e]&&(f=e.replace(oa,pa),l(k.get(f))||(S[e]={})),d=d+"."+e):d=e:(d?(c=(d?d.replace(Zb,xb):d)+"#"+e,f=d+"."+e):f=e?c=e:c="",d=u+(c?"."+c:""),b&&!S[c]&&d!=u&&!l(k.get(f))&&(S[c]={}));return!a?d:d?d+"."+a:a},toLogicalPath:R=function(a){var b;if(a===u)return"*";return(b=Ka.exec(a))?(a=y.rightContext,b=b[1].replace(oa,pa),R(b+"*"+a)):a},isUndefined:l=function(a){return a===v},isPrimitive:T=function(a){return null===a||typeof a in Vb},isString:i=function(a){return"string"===
typeof a},isObject:w=function(a){return"object"===g.type(a)},isBoolean:aa=function(a){return"boolean"===typeof a},toTypedValue:O=function(a){if(i(a)){a=g.trim(a);try{a="true"===a?!0:"false"===a?!1:"null"===a?null:"undefined"===a?v:g.isNumeric(a)?parseFloat(a):Xb.test(a)?g.parseJSON(a):a}catch(b){}}return a},isPromise:W=function(a){return!(!a||!a.promise||!a.done||!a.fail)},clearObj:Fa=function(a){if(T(a))return null;for(var b in a)xa.call(a,b)&&(a[b]=Fa(a[b]));return a},clone:ba=function(a,b){return T(a)?
a:B(a)?a.slice(0):m(!!b,{},a)},local:function(a,b){if(1==arguments.length)return O(localStorage.getItem(a));l(b)?localStorage.removeItem(a):localStorage.setItem(a,JSON.stringify(b))}},onDisposing:function(a){Ga.push(a)},options:p,mergeLogicalPath:z=function(a,b,c){if(!l(b)&&(b+="",b.startsWith("/")))return b.substr(1);l(c)&&(c=!0);c&&b&&a&&!wa.test(b)&&(b="."+b);if(!b||"."==b)return a;if(wa.test(b)){if(qb.test(b)){for(var b=qb.exec(b),c=1+(b[1]?b[1].length:0),d=y.rightContext;c;)a=Oa(a),c--;return d?
a+b[2]+d:"*"===b[2]?a+"*":a}}else return b;return a+b}});g("get,set,del,extend".split(",")).each(function(a,b){h[b]=function(){return k[b].apply(k,F.call(arguments))}});k=h();var Ra={},N,sa=/ /,Ua=/\*\.$/,Fb=/\.|\*/g,ac=/^(\w+)\.?/,Za,$a,ta,ja,Ya,ua,Y=g.fn,H,Db=0,I=[],s,ca,Hb=/init(\d*)/,Wa="get,set,convert,initialize,finalize,dispose".split(",");V.prototype={consturctor:V,isDependent:function(){return!this.publisher.path.startsWith(this.originalPublisher.path)},stopPropagation:function(){this.isPropagationStopped=
U},stopImmediatePropagation:function(){this.isCascadeStopped=this.isPropagationStopped=this.isImmediatePropagationStopped=U},stopCascade:function(){this.isCascadeStopped=U},error:function(){this.hasError=U},isCascadeStopped:fa,isPropagationStopped:fa,isImmediatePropagationStopped:fa,hasError:fa,level:0};r=function(a,b,c,d,e){d=new V(a,b,c,d,e);Ta(d);if(!d.isPropagationStopped()&&d.publisher.path){if(d.isDependent())d.originalPublisher.path=d.publisher.path;do d.publisher.path=d.publisher.contextPath(),
d.level++,d.type=ac.exec(d.type)[1]+"."+d.level,Ta(d);while(!d.isPropagationStopped()&&d.publisher.path)}d.type=c;d.originalPublisher.path=b;d.publisher.path=a;return d};H={getByPublisher:function(a){return ra(a,function(a,c){return a.publisher==c})},getBySubscriber:function(a){return ra(a,function(a,c){return a.subscriber==c})},getByTarget:function(a){return!a?I:ra(a,function(a,c){return a.subscriber==c||a.publisher==c})}};m(h,{Event:V,trigger:r,subscriptions:H.getByTarget,subscribe:s=function(a,
b,c,d,e,f){if(a instanceof h)a=a.path;if(b instanceof h)b=b.path;i(a)&&a.startsWith("$")&&(a=g(a.substr(1)));if(a&&a.jquery)if(!a.length&&!a.selector)a=null;else{a.each(function(a,g){s(g,b,c,d,e,f)});return}i(b)&&b.startsWith("$")&&(b=g(b.substr(1)));if(b&&b.jquery)b.each(function(b,g){s(a,g,c,d,e,f)});else{if(!b&&""!==b)throw"publisher can not be null";if(!c)throw"eventTypes can not be null";if("_"===a||"null"==a||null===a)a=Ra;"_"===e&&(e=v);var n=i(b),j=i(a);Sa(b);Sa(a);n&&(b=C(b));j&&(a=C(a));
n?Gb(b,c,a,d,e):Ib(b,c,a,d,e,f)}},unsubscribe:ca=function(a){var b;if(w(a)){if(!g(a).viewId())return;g(a).removeData(u)}for(var c=I.length-1,d;0<=c;c--)if(d=I[c],b=d.handler,a===d.publisher||a===d.subscriber||i(a)&&(i(d.publisher)&&d.publisher.startsWith(a+".")||i(d.subscriber)&&d.subscriber.startsWith(a+".")))i(d.publisher)||(b.delegateSelector?g(d.publisher).undelegate(b.delegateSelector,d.eventTypes,E):g(d.publisher).unbind(d.eventTypes,E)),b.dispose&&b.dispose(d.publisher,d.subscriber),I.splice(c,
1)},handlers:function(a,b,c){var d;if(w(a))for(d in a)N[d]=X(a[d]);else return l(a)?N:l(b)?N[a]:N[a]=c?m(X(b),c):X(b)},filters:{getters:Za={},setters:$a={},converters:ta={},initializers:ja={},finalizers:ua={},disposers:Ya={}}});N={triggerChange:{get:function(){k.triggerChange(this.options)}},saveLocal:{get:function(a){ma.local(a.publisher.path,a.publisher.get())}}};ma.getUniqueViewEventTypes=Qa;h.onDisposing(ca);m(G,{subscribe:function(a,b,c,d,e){s(this.path,a,b,c,d,e);return this},subscribedBy:function(a,
b,c,d,e){s(a,this.path,b,c,d,e);return this},unsubscribe:function(){ca(this.path);return this},subsFromOthers:function(){return H.getByPublisher(this.path)},subsFromMe:function(){return H.getBySubscriber(this.path)},subscriptions:function(){return H.getByTarget(this.path)},mapEvent:function(a,b,c){s(this.path,this.path,a,function(a){c(a.publisher.get(),a)&&r(a.publisher.path,a.publisher.path,b,a.proposed,a.removed)});return this},saveLocalAfterUpdate:function(a){h.subscribe(null,this.fullPath(a),
"after*","*saveLocal");return this}});m(Y,{subscribe:function(a,b,c,d,e){this.length&&s(this,a,b,c,d,e);return this},subscribedBy:function(a,b,c,d,e){this.length&&s(a,this,b,c,d,e);return this},unsubscribe:function(){return this.each(function(){ca(this)})},subsFromOthers:function(){return H.getByPublisher(this[0])},subsFromMe:function(){return H.getBySubscriber(this[0])},subscriptions:function(){return H.getByTarget(this[0])},initView:function(a,b,c){s(this,a,"init",b,c);return this},viewId:function(){return this.data(u)},
aliasEvent:function(a,b){this.bind(a,function(){g(this).trigger(b)})}});g.createFilterEvent=function(a,b,c){var d=function(a){(!0===c||c(a))&&g(a.target).trigger(m({},a,{type:b,currentTarget:a.target}))};if(g.event.special[b])throw"event '"+b+"' has been defined";g.event.special[b]={setup:function(){g(this).bind(a,d)},teardown:function(){g(this).unbind(a,d)}};return this};var bc=g.cleanData;g.cleanData=function(a){g(a).each(function(){ca(this)});bc(a)};var Ha;h.stage=Ha=function(a){if(!B(a))return Ha(F.call(arguments));
var b,c,d,e,f,g,j,l;for(b=0;b<a.length;b++){c=a[b];e=c.subs;c.actor instanceof h||i(c.actor)&&!c.actor.startsWith("$")?(c.model&&k.set(c.actor,c.model),l=c.actor,j=c.context):(j=c.actor,l=c.context);if(l instanceof h)l=l.path;i(j)&&j.startsWith("$")&&(j=j.substr(1));j=j||document;if(e){B(e[0])||(e=[e]);for(c=0;c<e.length;c++)d=e[c],g=ab(d[0],l,j),f=ab(d[1],l,j),s(g,f,d[2],d[3],d[4],d[5])}}return h};h.application=function(a){var b=[],c,d;d=a.models;var e=a.views;if(d)for(a=0;a<d.length;a++)c=d[a],
b.push({actor:c.path,model:c.value,context:c.contextView,subs:c.subs});if(e)for(a=0;a<e.length;a++)d=e[a],b.push({actor:d.view,context:d.contextModel,subs:d.subs});Ha(b);return h};var Kb=/\s*([`@$!])([#\w\. \*]+)(:([\*\.\w$\/][^`@$!]*))*/g,Nb=/\s*;\s*/g,Ob=/^([^|]+)(\|([^|]+))?(\|(.+?))??$/,Z=/\s*\|\s*/g,Mb="class",Pb="sub,pub,class,theme,ns,options".split(","),fb={},A,t;p.theme="via";p.subsAttr="data-sub";p.autoImportSubs=!0;m(h,{customSubsProps:A={},importSubs:function(){ya(document.documentElement)},
themes:{via:{classes:t={}}},classes:t});m(Y,{findAll:function(a){if(0===this.length)return this;var b=this.filter(a);this.each(function(){b=b.add(g(this).find(a))});return b},importSubs:function(){return this.each(function(){ya(this)})},dataSub:function(a){return l(a)?this.data("datasub"):this.data("datasub",a)}});(function(){var a=function(){p.autoImportSubs&&h.importSubs()};g.isReady?setTimeout(a,10):g(document).bind("ready",a)})();var $,ka={},za={initialize:"*buildTemplateOptions",get:"get",convert:"*template",
set:"html",finalize:"*importSubs"};ja.buildTemplateOptions=function(a,b,c,d){if(i(d))d=d.split(","),c.templateId=g.trim(d[0]),c.useDataSourceAsArrayItem="true"==g.trim(d[1]),c.engineName=d[2];else if(w(d)&&d.templateId)m(c,d);else if(!(c.templateId=g(b).data("defaultTemplate")))if(a=g.trim(g(b).html()))g(b).empty(),c.templateId="__"+g.uuid++,$.compile(c.templateId,a),g(b).data("defaultTemplate",c.templateId);else throw"missing template";};ta.template=function(a,b){if(a&&(B(a)&&a.length||!B(a))){var c=
b.publisher,d=Qb(this.templateId,this.useDataSourceAsArrayItem?[a]:a,{modelPath:c.path,e:b,get:function(){return c.get.apply(c,F.call(arguments))}},this.engineName);if(W(d))return d;i(d)&&(d=g.trim(d));return g(g("<div />").html(d)[0].childNodes)}return""};ua.importSubs=function(a){g(a).importSubs()};h.handlers({renderInside:za,render:P("get","replaceWith")});t.foreach="!init after*.:.|*renderInside";t.renderInside="!init.:.|*renderInside";t.render="!init:.|*render";Y.renderInside=function(a,b,c){b=
b||"";q(c)&&(c={finalize:c});return this.initView(b,c?m({},za,c):"*renderInside",a)};Y.render=function(a,b,c){q(c)&&(c={finalize:c});return this.initView(a,c?m({},h.handlers("render"),c):"*render",b)};h.template=$={defaultEngine:"",engines:function(a,b,c){if(!a)return ka;if(!b)return ka[a];ka[a]=b;if(!c)$.defaultEngine=a},load:function(a){if("undefined"==typeof matrix)throw"The method via.template.load require matrix.js,or you need override the method";return matrix(a+".template")},compile:function(a,
b,c){return gb(c).compile(a,b)},buildTemplateHandler:P};var J,rb=function(a){return null===a||a===v?"":""+a};m(!0,h.filters,{getters:{getOriginalModel:function(a){return a.originalPublisher.get()},getViewValue:function(a){return this.getViewValue(a.publisher)}},setters:{setViewValue:function(a,b){return this.setViewValue(b.subscriber,a,b)}},converters:{toString:rb,toTypedValue:O}});h.handlers({updateViewValue:{initialize:function(a,b,c,d){a=hb(b,d);if(!a||!a.set)throw"can not find set method for view";
c.setViewValue=a.set;a.initialize&&!b.data("accesserInitialized")&&(a.initialize(b),b.data("accesserInitialized",!0))},get:"get",set:"*setViewValue"},updateModelValue:{initialize:function(a,b,c,d){d=hb(a,d);if(!d||!d.get)throw"can not find get method for view";c.getViewValue=d.get;d.initialize&&!a.data("accesserInitialized")&&(d.initialize(a),b.data("accesserInitialized",!0))},get:"*getViewValue",set:"set"},options:{get:function(a){var b=this.options,c=a.subscriber,d=c.val();c.children("option[listItem]").remove().end().append(function(){var c=
"";g(a.publisher.get()).each(function(){c+="<option listItem='1' value='"+b.value(this)+"'>"+b.name(this)+"</option>"});return c}).val(d);c.val()!==d&&g(c.trigger("change"))},initialize:function(a,b,c,d){if(d){var a=d.split(","),e=a[0],f=a[1]||a[0];c.options={name:function(a){return a[e]},value:function(a){return a[f]}}}else c.options={name:function(a){return a.toString()},value:function(a){return a.toString()}}}},hide:function(a){var b=this.effect;if(!b)this.effect=this.options;g(a.subscriber)[a.publisher.isEmpty()?
"show":"hide"](b)},show:function(a){var b=this.effect;if(!b)this.effect=this.options;g(a.subscriber)[a.publisher.isEmpty()?"hide":"show"](b)},showPlural:function(a){var b=a.publisher.get();a.subscriber[1<(b.length||b)?"show":"hide"]()},textCount:function(a){var b=a.publisher.get();a.subscriber.text("length"in b?b.length:b)},enable:function(a){g(a.subscriber).attr("disabled",a.publisher.isEmpty())},disable:function(a){g(a.subscriber).attr("disabled",!a.publisher.isEmpty())},showValue:function(a){a.subscriber.html("<span style='color:red'>"+
a.publisher.path+" : "+JSON.stringify(a.publisher.get())+"</span>")},appendTmplItem:P("*getOriginalModel","append"),updateTmplItem:P(function(a){return a.publisher.get(Aa(a))},function(a,b){b.subscriber.children().eq(+Aa(b)).replaceWith(a)}),removeTmplItem:{get:function(a){a.subscriber.children().eq(+Aa(a)).remove()}},addClass:function(a){a.publisher.get()?a.subscriber.addClass(this.options):a.subscriber.removeClass(this.options)},removeClass:function(a){a.publisher.get()?a.subscriber.removeClass(this.options):
a.subscriber.addClass(this.options)},del:function(a){a.subscriber.del()},"++":function(a){a.subscriber.set(a.subscriber.get()+1)},"--":function(a){a.subscriber.set(a.subscriber.get()-1)},hardCode:{initialize:function(a,b,c,d){c.hardCode=O(d)},get:function(a){a.subscriber.set(this.hardCode)}},"null":function(a){a.subscriber.set(null)},"true":function(a){a.subscriber.set(!0)},"false":function(a){a.subscriber.set(!1)},toggle:function(a){a=a.subscriber;a.set(!a.get())},zero:function(a){a.subscriber.set(0)},
preventDefault:function(a){a.preventDefault()},stopPropagation:function(a){a.stopPropagation()},alert:function(a){alert(l(this.options)?a.subscriber.get():this.options)},log:function(){},sort:{initialize:function(a,b,c,d){d=d.split(",");c.by=d[0];c.asc=!!d[1]},get:function(a){a.subscriber.sort(this.by,this.asc);this.asc=!this.asc}}});J=[{name:"textBoxOrDropDown",get:function(a){return a.val()},set:function(a,b){a.val()!==b&&a.val(b)},match:U},{name:"checkbox",get:ib,set:function(a,b){var c=a[0];c.checked=
aa(b)?b:b==c.value},match:function(a){return a.is(":checkbox")}},{name:"radio",get:ib,set:function(a,b,c){a=a[0];if(!a.name)a.name=c.publisher.path;a.checked=rb(b)==a.value},match:function(a){return a.is(":radio")}},{name:"listBox",get:function(a){var b=[];a.children("option:selected").each(function(){b.push(this.value)});return b},set:function(a,b){function c(){if(this.value==e)return this.selected=!0,!1}a.children("option:selected").removeAttr("selected");for(var d=0,e;d<b.length;d++)e=b[d],a.children("option").each(c)},
match:function(a){return a.is("select[multiple]")}}];h.addViewValueAdapters=function(a){if(B(a))for(var b=0;b<a.length;b++)J.push(a[b]);else J.push(a)};m(A,{caption:function(a,b,c,d){g(a).prepend("<option value=''>"+d+"</option>")},val:function(a,b,c,d){var e,f=b.ns;(d=d||"")?(d=d.split(","),b=d[0]||"change",e=d[1]):b="change";(!e||"updateView"==e)&&c.push({publisher:f,eventTypes:"init1 after*",subscriber:a,handler:"*updateViewValue",options:d[2]});(!e||"updateModel"==e)&&c.push({publisher:a,eventTypes:b,
subscriber:f,handler:"*updateModelValue",options:d[2]})},focus:function(a){g(a).focus()},aliasEvent:function(a,b,c,d){setTimeout(function(){var b,c,h=d.split(";"),j=g(a);for(b=0;b<h.length;b++)c=h[b].split(","),j.aliasEvent(c[0],c[1])},1)},init:function(a,b,c,d){k.get(d,a,b,c,d)}});m(t,{listView:"!init after*.:.|*renderInside!afterCreate.1:.|*appendTmplItem!afterUpdate.1:.|*updateTmplItem!afterDel.1:.|*removeTmplItem",fullyLoadedListView:"!init after*:.|*renderInside",val:"@val:.",options:"!init after*:.|*options",
show:"!init after*:.|*show",hide:"!init after*:.|*hide",enableLater:"!after*:.|*enable",disableLater:"!after*:.|*disable",enable:"!init after*:.|*enable",disable:"!init after*:.|*disable",html:"!init after*:.|get html *toString",text:"!init after*:.|get text *toString",showPlural:"!init after*:.|*showPlural",showValue:"!init after*:.|*showValue",textCount:"!init after*:.|*textCount",alert:"$click:.|*alert",preventDefault:"$click:.|*preventDefault",deleteButton:"@aliasEvent:click,delete",updateButton:"@aliasEvent:click,update",
editButton:"@aliasEvent:click,edit",cancelButton:"@aliasEvent:click,cancel",pageButton:"@aliasEvent:click,changePage"});g.createFilterEvent("keyup","enter",function(a){return 13===a.keyCode}).createFilterEvent("keyup","esc",function(a){return 27===a.keyCode});g.Event.prototype.selectedRowIndex=function(){return this.publisher.children().filter(this.originalPublisher.parents()).index()};p.errors={};var nb="beforeUpdate validate",Ba=S.pathsOfInvalidModels=[],Ia=h("*pathsOfInvalidModels"),Sb=/^\s*$/,
sb=/^\d+$/,cc=/^(\/(\\[^\x00-\x1f]|\[(\\[^\x00-\x1f]|[^\x00-\x1f\\\/])*\]|[^\x00-\x1f\\\/\[])+\/[gim]*)(,(.*))*$/,da=/(\w+)(,(.*))?/,tb=/(\w+),(\w+)(,(.*))?/;G.isValid=function(a){var a=this.fullPath(a),b=kb(a);if(aa(b))return b;for(var b=h.subscriptions(),c={},d=b.length-1,e,f;0<=d;d--)if(e=b[d],i(f=e.publisher)&&!c[f]&&f.startsWith(a)&&e.eventTypes.contains("validate"))c[f]=!0,r(f,f,"validate",k.get(f));return jb(a)};h.isValid=function(a){return k.isValid(a)};m(h.Event.prototype,{addError:function(a){this.publisher.createIfUndefined("*errors",
[]).cd("*errors").pushUnique(a);Ia.pushUnique(this.publisher.path)},removeError:function(a){this.publisher.createIfUndefined("*errors",[]).cd("*errors").removeItem(a).isEmpty()&&Ia.removeItem(this.publisher.path)}});h.validators=function(a){if(B(a)){for(var b=0;b<a.length;b++)h.validators(a[b]);return this}b=a.name;if(A[b])throw"validator name '"+b+"' collide with name in via.rules";if(h.handlers(b))throw"validator name '"+b+"' collide with name in via.handlers";if(a.error)p.errors[b]=a.error;h.handlers(b,
mb(a));t[b]="!beforeUpdate validate:.|*"+b};h.validators([{name:"required",error:"This field is required.",isValid:function(){return!0}},{name:"email",error:"Please enter a valid email address.",isValid:Q(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i)},
{name:"url",error:"Please enter a valid URL.",isValid:Q(/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i)},
{name:"date",error:"Please enter a valid date.",isValid:Q(/Invalid|NaN/,!0)},{name:"dateISO",error:"Please enter a valid date (ISO).",isValid:Q(/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/)},{name:"number",error:"Please enter a valid number.",isValid:Q(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/)},{name:"digits",error:"Please enter only digits.",isValid:Q(sb)},{name:"creditcard",error:"Please enter a valid credit card number.",isValid:function(a){if(/[^0-9\-]+/.test(a))return!1;for(var b=0,c=0,d=!1,a=a.replace(/\D/g,
""),e=a.length-1;0<=e;e--){c=a.charAt(e);c=parseInt(c,10);if(d&&9<(c*=2))c-=9;b+=c;d=!d}return 0===b%10}},{name:"minlength",error:"Please enter at least {0} characters.",isValid:function(a,b){return a.length>=b.minlength},initialize:function(a,b,c,d){var e;if(d&&(e=da.exec(d)))c.options={minlength:+e[1],error:e[3]};else throw"invalid options for minlength validator";},buildError:K("minlength")},{name:"maxlength",error:"Please enter no more than {0} characters.",isValid:function(a,b){return a.length<=
b.maxlength},initialize:function(a,b,c,d){var e;if(d&&(e=da.exec(d)))c.options={maxlength:+e[1],error:e[3]};else throw"invalid options for maxlength validator";},buildError:K("maxlength")},{name:"rangelength",error:"Please enter a value between {0} and {1} characters long.",isValid:function(a,b){return a.length>=b.minlength&&a.length<=b.maxlength},initialize:function(a,b,c,d){var e;if(d&&(e=tb.exec(d)))c.options={minlength:+e[1],maxlength:+e[2],error:e[4]};else throw"invalid options for rangelength validator";
},buildError:K("minlength","maxlength")},{name:"min",error:"Please enter a value greater than or equal to {0}.",isValid:function(a,b){return a>=b.min},initialize:function(a,b,c,d){var e;if(d&&(e=da.exec(d)))c.options={min:+e[1],error:e[3]};else throw"invalid options for min validator";},buildError:K("min")},{name:"max",error:"Please enter a value less than or equal to {0}.",isValid:function(a,b){return a<=b.max},initialize:function(a,b,c,d){var e;if(d&&(e=da.exec(d)))c.options={max:+e[1],error:e[3]};
else throw"invalid options for max validator";},buildError:K("max")},{name:"range",error:"Please enter a value between {0} and {1}.",isValid:function(a,b){return a>=b.min&&a<=b.max},initialize:function(a,b,c,d){var e;if(d&&(e=tb.exec(d)))c.options={min:+e[1],max:+e[2],error:e[4]};else throw"invalid options for range validator";},buildError:K("min","max")},{name:"equal",error:"Please enter the same value again.",isValid:function(a,b){return k.get(b.path)===a},initialize:function(a,b,c,d){var e;if(d&&
(e=da.exec(d)))c.options={path:e[1],error:e[3]};else throw"invalid options for equal validator";}},{name:"regex",error:"Please enter a value match with required pattern.",isValid:function(a,b){return b.regex.test(a)},initialize:function(a,b,c,d){var e;if(d&&(e=cc.exec(d)))c.options={regex:eval(e[1]),error:e[5]};else throw"invalid options for regex validator";}},{name:"fixedValue",error:"Please enter a value {0}",isValid:function(a,b){return a==b.fixedValue},initialize:function(a,b,c,d){if(i(d)){if(a=
/^(\w+)(,(.*))*$/.exec(d))c.options={fixedValue:O(a[1]),error:a[3]}}else if(w(d))c.options=d;else throw"missing options in fixedValue validator";},buildError:K("fixedValue")}]);G.check=function(a,b){Ca(this.path,a,b);return this};G.checkAll=function(a){var b,c,d,e,f;for(b in a){c=this.fullPath(b);d=a[b];for(e=0;e<d.length;e++)f=d[e],i(f)||w(f)?Ca(c,f):B(f)&&Ca(c,f[0],f[1])}return this};h.onDisposing(function(a){Ia.removeItem(a)});A.validate=function(a,b){s(b.ns,a,"click","*validate");kb(b.ns)};h.handlers("validate",
function(a){h.isValid(a.subscriber.path)||a.stopImmediatePropagation()});h.handlers("showError",function(a){a.publisher.isEmpty()?a.subscriber.removeClass("error").next("span.error").remove():a.subscriber.addClass("error").next("span.error").remove().end().after("<span class='error'>"+a.publisher.get()+"</span>")});t.showError="!after*:*errors|*showError";t.validate="@validate";A.queryableListView=function(a,b,c,d){h(b.ns).queryable(!!d)};G.queryable=function(a){var b=this.path;if(!this.get("*query")){var c=
{autoQuery:!!a,hasResult:!1,triggerQueryChange:function(){c.autoQuery||setTimeout(function(){r(b+"*queryResult",b+"*queryResult","afterUpdate")},0)},query:{page:{enabled:!1,index:0,count:1,size:0},sort:{by:null,asc:null},filter:{fn:function(){if(this.get("ops")&&this.get("by")&&this.get("value")){var a=c.query.filter,b=a.ops,f=a.by,a=a.value,g;"equals"==b?g=y("^"+a+"$","i"):"contains"==b&&(g=y(a,"i"));return function(){return g?g.test(this[f]):!0}}},by:"",value:"",ops:"",enabled:function(){return!!this.get("fn")}},
enabled:function(){return this.get("page.enabled")||this.get("sort.by")||this.get("filter.enabled")}},queryResult:function(a){var c=g(k.get(b)),f=this.cd("query"),i=f.get("filter.fn"),c=i?c.filter(i).get():c.get();k.update(b+"*hasResult",0<c.length);f.get("sort.by")&&c.sortObject(f.get("sort.by"),f.get("sort.asc"));f=f.get("page");if(!a&&f.enabled){a=Math.ceil(c.length/f.size)||1;if(a!=f.count){f.count=a;if(f.index>f.count-1)f.index=0;h(b+"*query.page").triggerChange()}c=c.slice(f.index*f.size,(f.index+
1)*f.size)}return c},changePage:function(a){if(w(a)&&(a=a.originalPublisher.attr("page"),!a))return;var e=k.get(b+"*query.page");sb.test(a)?a=+a:"next"==a?a=e.index+1:"previous"==a?a=e.index-1:"first"==a?a=0:"last"==a?a=e.count-1:"disabled"==a&&(a=0,c.resetPaging());if("number"!==typeof a||0>a||a>e.count-1)a=0;k.update(b+"*query.page.index",a);c.triggerQueryChange()},resetSort:function(){k.set(b+"*query.sort.by",null).set(b+"*query.sort.asc",null)},resetFilter:function(){k.update(b+"*query.filter.by",
"").update(b+"*query.filter.value","").update(b+"*query.filter.ops","")},resetPaging:function(){k.update(b+"*query.page.enabled",!1).update(b+"*query.page.size",0).update(b+"*query.page.count",1).update(b+"*query.page.index",0)},resetQuery:function(){c.resetSort();c.resetFilter();c.resetPaging()}};this.extend("*",c).cd("*queryResult").watchPath(b);c.autoQuery||this.cd("*queryResult").unwatchPath(b+"*query")}};m(t,{queryChanged:"$click:*triggerQueryChange",queryableListView:"@rowContainer@queryableListView!init after*:*queryResult|*renderInside",
sort:"$click:*query.sort.by|*hardCode$click:*query.sort.asc|*toggle`queryChanged",resetSort:"!init afterUpdate:*query.sort.by|*show;$click:*resetSort`queryChanged",pager:"!init after*:*query.page|*renderInside!init after*:*hasResult|*show`changePage`preventDefault",changePage:"$changePage:*changePage",applyPaging:"!init afterUpdate:*query.page.size|*enable$click:*query.page.enabled|*true`queryChanged",applyFilter:"`enable:*query.filter.enabled`queryChanged",resetFilter:"`show:*query.filter.enabled$click:*resetFilter`queryChanged",
resetQuery:"$click:*resetQuery`queryChanged!init afterUpdate:*query.enabled|*show",hasQueryResult:"`show:*hasResult",noQueryResult:"`hide:*hasResult"});var x={none:0,create:1,update:2};ma.editMode=x;A.editableListView=function(a,b){var c,d=b.ns,e=h(d);if(!e.get("*edit")){if(e.isShadow()&&!q(e.helper())){c=e.mainModel();var f=(c.logicalPath()+"*edit.item").length+1,d=R(d).substr(f);c=ba(c.get("*edit.itemTemplate."+d+".0"),!0)}else c=k.get(d+"_newItem"),l(c)&&(c=Fa(ba(e.get()[0],!0)));e.get()||e.set([]);
e.create("*edit",{mode:0,item:null,selectedIndex:-1,itemTemplate:c});e.cd("*edit.selectedIndex").mapEvent("afterUpdate","enterUpdateMode",function(a,b){return b.publisher.get("..mode")==x.update}).mapEvent("afterUpdate","cancelUpdateMode",function(a,b){return b.publisher.get("..mode")==x.none});e.cd("*edit.mode").mapEvent("afterUpdate","enterNewMode",function(a,b){return a==x.create&&-1==b.publisher.get("..selectedIndex")}).mapEvent("afterUpdate","cancelNewMode",function(a,b){return a==x.none&&-1==
b.publisher.get("..selectedIndex")})}};A.switchUpdateMode=function(a,b,c,d){c.push({publisher:b.ns+"*edit",eventTypes:"enterUpdateMode*",subscriber:a,handler:"*renderEditItem",options:d});c.push({publisher:b.ns+"*edit",eventTypes:"cancelUpdateMode*",subscriber:a,handler:function(a){a.publisher.mainModel().triggerChange(a.removed)}})};m(G,{newRowItem:function(){var a=this.cd("*edit");a.update("item",ba(a.get("itemTemplate"),!0)).update("mode",x.create)},editRowItem:function(a,b){this.get("*edit.mode")!==
x.none&&this.resetEditItem();l(b)?b=this.indexOf(a):a=this.get()[b];this.cd("*edit").update("item",ba(a,!0)).update("mode",x.update).update("selectedIndex",b)},resetEditItem:function(){var a=this.cd("*edit");l(a.get())||a.update("item",null).update("mode",x.none).update("selectedIndex",-1)},saveEditItem:function(){var a=this.get("*edit.mode"),b=this.get("*edit.item"),c=this.helper();if(a==x.create)q(c)?this.mainModel().push(b):this.push(b),this.resetEditItem();else if(a==x.update)a=this.get("*edit.selectedIndex"),
q(c)?(c=this.get(),this.mainModel().updateItem(c[a],b)):this.updateItem(c[a],b),b=this.cd("*edit"),c=b.get(),c.item=null,b.update("mode",x.none),c.selectedIndex=-1},removeRowItemByIndex:function(a){this.resetEditItem();var b=this.helper();q(b)?(b=this.get(),this.mainModel().removeItem(b[a])):this.removeAt(a)}});h.handlers({newRow:function(a){a.subscriber.newRowItem()},editRow:function(a){a.subscriber.editRowItem(null,a.selectedRowIndex());a.stopPropagation()},saveEditRow:function(a){a.subscriber.saveEditItem();
a.stopPropagation()},saveEditItem:function(a){a.subscriber.mainModel().saveEditItem();a.stopPropagation()},removeRow:function(a){var b=a.selectedRowIndex();a.subscriber.removeRowItemByIndex(b);a.stopPropagation()},cancelEditRow:function(a){a.subscriber.resetEditItem();a.stopPropagation()},cancelEditItem:function(a){a.subscriber.mainModel().resetEditItem();a.stopPropagation()},alignAfterRemove:function(a){var b=a.subscriber,c=a.publisher.path,a=a.originalPublisher.indexPath(),d,e,f,h,j,c="("+c.replace(".",
"\\.")+"\\.)(\\d+)|("+c.replace(".","#+")+"#+)(\\d+)";j=new y(c,"g");g(b).children(":gt("+a+")").find("*").andSelf().each(function(){var a,b,c,k,l;if(a=g(this).dataSub())if(b=a.ns.replace(j,L),b!=a.ns){a.ns=b;d=g(this).subscriptions();for(f=0;f<d.length;f++)if(h=d[f],i(h.publisher))h.publisher=h.publisher.replace(j,L);else if(i(h.subscriber)&&(a=h.subscriber,c=a.replace(j,L),a!=c))h.subscriber=c,e=h.handler,a=h.eventTypes,b=h.eventTypes=a.replace(j,L),l=e.delegateSelector,c={handler:e,subscriber:c},
k=g(h.publisher),l?(k.undelegate(l,a,E),k.delegate(l,b,c,E)):(k.unbind(a,E),k.bind(b,c,E))}})},renderNewItem:P(function(a){return a.publisher.get(".mode")===x.create?a.publisher.get(".item"):null},function(a,b){b.subscriber.html(a).show()}),renderEditItem:P(function(a){return a.publisher.mainModel().get("*edit.item")},function(a,b){b.subscriber.children().eq(b.originalPublisher.get()).replaceWith(a)})});m(t,{deletableRow:"$delete:.|*removeRow",editableDeletableRow:"`deletableRow@editableListView$edit:.|*editRow",
editableListView:"`editableDeletableRow$update:.|*saveEditRow$cancel:.|*cancelEditRow@switchUpdateMode:.",newItemButton:"$click:.|*newRow`hide:*edit.mode",newItemView:"!enterNewMode*:..|*renderNewItem!cancelNewMode:..mode|hide"});h.themes.alignable={classes:{listView:t.listView+"!afterDel.1:.|*alignAfterRemove"}};var ub=[],vb=g.bbq.getState,Tb=g.bbq.pushState;h.trackChange=function(){var a,b,c=vb();for(a=0;a<arguments.length;a++)b=arguments[a],b in c?k.set(b,c[b]):ob(b),s(null,b,"afterUpdate",ob),
ub.push(b);return this};g(ea).bind("hashchange",function(){var a=vb(),b;for(b in a)ub.contains(b)&&k.set(b,a[b])});p.selectedClass="selected";p.tabIdAttribute="data-tab";h.handlers({updateTab:function(a){var b=this.options.split(","),c=b[0],b=b[1]||p.selectedClass;a.publisher.get()==c?a.subscriber.addClass(b):a.subscriber.removeClass(b)},selectTab:function(a){a.subscriber.set(this.options.split(",")[0])}});t.tab="!init afterUpdate:.|*updateTab";t.tabSelector="$click:.|*selectTab`preventDefault`tab";
h.handlers("updateTabHolder",function(a){var b=a.publisher.get(),c=(this.options||"").split(","),d=c[0]||p.selectedClass,e=c[1]||p.tabIdAttribute;a.subscriber.find(this.options||"["+e+"]").andSelf().each(function(a,c){var h=g(c);h.attr(e)==b?h.addClass(d):h.removeClass(d)})});h.customSubsProps.tabSelectorHolder=function(a,b,c,d){var d=(d||"").split(","),e=b.ns,f=d[1]||p.tabIdAttribute,b=this.options||"["+f+"]";g(a).delegate(b,"click",function(){h.set(e,g(this).attr(f))})};t.tabHolder="!init100 afterUpdate:.|*updateTabHolder";
t.tabSelectorHolder="@tabSelectorHolder`tabHolder`preventDefault";var wb={},dc=/^([^,]+)(,(.+))?$/;A.loadapp=function(a,b,c,d){var b=dc.exec(g.trim(d)),e=b[1],f=b[3],b=wb[e]||matrix(e+".appLoader");b.done?b.done(function(b,c){c.name=e;Ub(c);wb[e]=c;c.load(a,f)}):b.load(a,f)}})(jQuery,window);
