/*! via.js v0.2pre Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */(function(g,ea,r){function za(a,b){for(var c in b)a[c]||(a[c]=b[c])}function eb(a){return"."===a?"#":fa(a.length+2).join("#")}function fb(a){if(a===p)return"";var b=Aa.exec(a);return b?b[1].replace(ga,ha):a}function ha(a){return"#"==a?".":fa(a.length).join("#")}function ia(a,b,c,d){var e,f=a.lastIndexOf(".");j(d)&&(d=!0);d&&(-1===f?(d="",e=a):(d=a.substring(0,f),e=a.substring(f+1)),c(d,e,b));if(!J(b))for(e in b)c(a,e,b[e]),ia(a+"."+e,b[e],c,!1)}function Ba(a,b,c){if(t(c)&&"no_watch"!=c.name){for(var b=
a?a+"."+b:b,d=c.toString(),e,c=[];e=gb.exec(d);)c.pushUnique(e[2]);for(d=0;d<c.length;d++)Ca(b,a?u(a,c[d]):c[d])}}function Ca(a,b){b=w(b);o[b]=o[b]||[];o[b].pushUnique(a)}function Da(a,b){b=w(b);o[b].remove(a);o[b].length||delete o[b]}function Ea(a){return(a=hb.exec(a))&&a[1]||""}function Fa(a,b,c,d,e){return b?b+(c-1):d+(e-1)}function V(){return!1}function K(){return!0}function L(a,b,c,d,e){this.publisher=x(a);this.originalPublisher=x(b);this.type=c;this.proposed=d;this.removed=e}function ja(a,b){k(a)&&
(a=w(a));for(var c=[],d=D.length-1,e;0<=d;d--)e=D[d],b(e,a)&&c.push(e);return c}function ib(a){var b=this.getMethod,c=this.getProp,a=a.publisher;return c?a[b](c):t(a[b])?a[b]():a[b]}function jb(a,b){var c=this.setMethod,d=this.setProp,e=b.subscriber;d?e[c](d,a):t(e[c])?e[c](a):e[c]=a}function Ga(a,b,c,d){D.push({publisher:a,subscriber:c,eventTypes:b,handler:d})}function Ha(a,b,c){var d=g(b).viewId();return g.map(a.split(ka),function(a){return k(c)?a+"."+p+"."+d+"."+c:a+"."+p+"."+d+"."+g(c).data(p)}).join(" ")}
function x(a){return k(a)?h(a):a==Ia?null:y(a)&&!a.nodeType?a:g(a)}function Ja(a){y(a)&&!g(a).data(p)&&g(a).data(p,++kb)}function lb(a){return"."==a?"\\.":".*"}function Ka(a){var b,c,d;d=a.publisher.subsFromOthers();if(d.length)for(c=0;c<d.length;c++){b=d[c];var e=a,f;a:{f=b.eventTypes;var g=a.type,i=void 0,l=void 0,G=i=void 0,h=void 0;if("*"===f)f="*";else{f=f.split(ka);for(h=0;h<f.length;h++)if(i=f[h],(G=La.test(i))&&(i=i.replace(La,"")),l=i.replace(mb,lb),l=G?new z("^"+l):new z("^"+l+"$"),i=l.test(g))if(G){if(G=
"^"==l.source?g:z.rightContext,!G||!G.contains(".")){f=f[h];break a}}else{f=f[h];break a}f=void 0}}e.subscribedEvent=f;if(a.subscribedEvent)a.subscriber=x(b.subscriber),W(b.handler,a);if(a.isImmediatePropagationStopped())return}if(!a.isCascadeStopped()&&(b=o[a.publisher.path]))for(d=0;d<b.length;d++){c=q(b[d],a.originalPublisher.path,a.type);if(c.isImmediatePropagationStopped()||c.isImmediatePropagationStopped())break;c.hasError()&&a.error()}}function W(a,b,c){var d,c=j(c)?a.get(b):a.get.apply(a,
[b].concat(c));if(M(c))d=m(!0,{},b),c.done(function(c){a.convert&&(c=a.convert(c,b));if(!j(c))if(M(c))c.done(function(b){X(a,b,d)});else return X(a,c,b)});else if(a.convert&&(c=a.convert(c,b)),!j(c))if(M(c))d=m(!0,{},b),c.done(function(b){X(a,b,d)});else return X(a,c,b)}function X(a,b,c){if(!j(b)&&(a.set&&a.set(b,c),!j(b)&&a.finalize))return a.finalize(b,c)}function nb(a,b,c,d,e){var f,g,i,l,h;h=b.split(" ");for(var j=0;j<h.length;j++)if(f=ob.exec(h[j])){i=h[j];g=+f[1];h.splice(j,1);b=h.join(" ");
break}l=N(d,a,c,e);b&&Ga(a,b,c,l);i&&(b=function(){var b=new L(a,a,i);b.subscriber=x(c);W(l,b)},g?setTimeout(b,g):b())}function pb(a,b,c,d,e,f){var s,i;i=b.split(" ");i.contains("init")&&(s=!0,b=i.remove("init").join(" "));e=N(d,a,c,e);d={handler:e,subscriber:c};b?(b=Ha(b,a,c),f?(e.delegateSelector=f,g(a).delegate(f,b,d,O)):g(a).bind(b,d,O),Ga(a,b,c,e),s&&(f?g(a).find(f).trigger(b):g(a).trigger(b))):s&&(g(a).one("init",d,O),g(a).trigger("init"))}function O(a){a.publisher=x(a.currentTarget);a.originalPublisher=
x(a.target);a.subscriber=x(a.data.subscriber);var b=a.data.handler;delete a.data;1<arguments.length?W(b,a,E.call(arguments,1)):W(b,a)}function N(a,b,c,d){var e,a=a||"";if(k(a)){var f=a,g,a=f.split(ka),i=k(b),h=k(c);if(1==a.length)if(f.startsWith("*")){e=H[f.substr(1)];if(!e)throw"common handler "+f+" does not exist";e=m({},e)}else(g=Ma(f,b,c))?e={get:g}:!j(b)&&!j(c)&&(e=i?{get:"get",set:f||"set"}:h?f?{get:f,set:"set"}:{get:n.helper(c)}:{get:f,set:f});else{e={};for(i=0;i<Na.length;i++)(f=a[i])&&"_"!==
f&&"null"!=f&&(e[Na[i]]=(g=Ma(f,b,c))?g:f)}}else if(t(a)||y(a)&&a.get){e=a;if(t(a))e.get=a;if(!e.set&&!j(c)&&k(c))e.set="set"}else throw"invalid handler";!j(b)&&!j(c)&&qb(e,b,c,d);d=e;Y(d,"initialize",Z);Oa("get",d,b,c);Oa("set",d,b,c);Y(d,"convert",la);Y(d,"finalize",ma);Y(d,"dispose",Pa);return e}function qb(a,b,c,d){var e=a.initialize;if(k(e))if(e.startsWith("*")){if(e=Z[e.substring(1)],!e)throw"common initializer does not exist!";}else{var f=e;if(!n.helper(f))throw"initializer does not exist at path "+
f;e=function(a,b,c,d){n.set(f,a,b,c,d)}}if(e)e(x(b),x(c),a,d),delete a.initialize;else if(!j(d))a.options=d}function Ma(a,b,c){if(a.startsWith("#"))return a=a.substr(1),k(c)?n.helper(u(c,a)):k(b)?n.helper(u(b,a)):n.helper(a)}function Oa(a,b,c,d){var e=b[a];if(k(e)&&""!=e){var f="get"==a?Qa:Ra;if(e.startsWith("*")){if(e=e.substr(1),b[a]=f[e],!b[a])throw e+" does not exists common "+a+" filter";}else if(e=e.split("*"),b[a]="get"==a?ib:jb,b[a+"Method"]=e[0],e[1]&&(b[a+"Prop"]=e[1]),!j(c)&&!j(d)){var b=
e[0],c="get"==a?c:d,g;k(c)?na[b]||(g=!0):c.nodeType?P[b]||(g=!0):b in c||(g=!0);if(g)throw("get"==a?"publisher":"subscriber")+" does not have a member "+b;}}}function Y(a,b,c){var d=a[b];k(d)&&(a[b]=d.startsWith("*")?c[d.substr(1)]:function(){return n.set.apply(n,[d].concat(E.call(arguments)))})}function Sa(a,b,c){var d;k(a)&&(a.startsWith("$")?(d=(a=a.substr(1))?g(c).findAll(a):g(c),a=d):"."==a?a=b:"_"!==a&&(a=u(b,a)));return a}function Ta(a){if(a){for(var b={},c,d,e;c=rb.exec(a);)e=c[1],d=g.trim(c[2]),
c=g.trim(c[4])||null,"`"==e?(c=c?d+"|"+c:d,d="class"):"$"==e?(c=d+"|"+c,d="pub"):"!"==e&&(c=c.split(Q),c.splice(1,0,d),c=c.join("|"),d="sub"),b[d]=b[d]?b[d]+";"+c:c;return b}}function Ua(a){var b=h.themes[a],c=[],d=b.parentThemes;!d&&"via"!=a&&(d="via");"null"==d&&(d=r);b.classes&&c.push(b.classes);if(d){d=d.split(";");for(a=0;a<d.length;a++)c=c.concat(Ua(d[a]))}return c}function oa(a,b){for(var c=g(a);(c=c.parent())&&c.length;){var d=c.dataSub();if(d&&d[b])return d[b]}return""}function Va(a,b,c,
d){var e,f,h,i,l,j,k=c[a]&&c[a].split(";");if(k)for(e=0;e<k.length;e++)if(f=g.trim(k[e]))if(f=f.split(Q))"sub"==a?(h=f[0],h=h.startsWith("$")?h:u(c.ns,h),i=f[1],l=b):(h=b,i=f[0],l=f[1],l=l.startsWith("$")?l:u(c.ns,l)),j=f[3],j=R(j?j:c.options),d.push({publisher:h,eventTypes:i,subscriber:l,handler:f[2],options:j,delegate:f[4]})}function sb(a){var b=g.trim(g(a).attr(A.subsAttr));if(b){b=Ta(b);g(a).dataSub(b);if(b.ns&&"."!==b.ns){if(pa.exec(b.ns))b.ns=u(oa(a,"ns"),b.ns)}else b.ns=oa(a,"ns");b.theme=
b.theme||oa(a,"theme")||A.theme;var c=[];Wa(a,b,c);return c.length?c:r}}function Wa(a,b,c){var d,e,f,s,i;i=b[tb];if(!(f=!i))if(!(f="_"===i)){var l;b:if(f=b.theme,!f||!h.themes[f])l=!1;else{if(!h.themes[f].loaded){d=Ua(f);if(!d){l=!1;break b}for(e=d.length-1;s=d[e];e--)for(l in s)Xa[f+"."+l]=s[l];h.themes[f].loaded=!0}l=!0}f=!l}if(!f){i=i.split(ub);for(l=0;l<i.length;l++)if(d=vb.exec(i[l]),f=d[1],f=g.trim(Xa[b.theme+"."+f]),f=Ta(f)){e=d[3];d=d[5];f.ns=u(u(b.ns,e),f.ns);f.theme=b.theme;d?(e=d.split(Q),
f.options=2==e.length?e[1]:d):f.options=b.options;if(d)if(s=f.sub,e=f.pub,!s&&e&&1==e.split(";").length)e=e.split(Q),f.pub=j(e[3])?f.pub+("|"+d):f.pub+d;else if(!e&&s&&1==s.split(";").length)e=s.split(Q),f.sub=j(e[3])?f.sub+("|"+d):f.sub+d;Wa(a,f,c)}}for(var k in b)if(qa.call(b,k)&&!wb.contains(k))if($[k])$[k](a,b,c,"."==b[k]?b.options:b[k]);else g(a).dataSub()[k]=b[k];Va("sub",a,b,c);Va("pub",a,b,c)}function ra(a){if(!g(a).attr(A.subsAttr)||!g(a).dataSub()){var b,c,d=sb(a);if(d)for(b=0;b<d.length;b++)c=
d[b],v(c.subscriber,c.publisher,c.eventTypes,c.handler,c.options,c.delegate)}g(a).children().each(function(){ra(this)})}function aa(a,b,c){return m({},sa,y(a)?a:{get:a,set:b,finalize:c})}function Ya(a){a=a||S.defaultEngine;if(!a)throw"engine name is not specified or default engine name is null";a=ba[a];if(!a)throw"engine '"+a+"' can not be found.";return a}function xb(a,b,c,d){var e=Ya(d,a),a=g.trim(a);if(!e.isTemplateLoaded||e.isTemplateLoaded(a))return e.render(a,b,c);var f=g.Deferred();S.load(a).done(function(){var d=
e.render(a,b,c),i=g(d);f.resolve(i.selector||!i.length?d:i)});return f.promise()}function ta(a){var a=a.originalPublisher.path.substr(a.publisher.path.length+1),b=a.indexOf(".");return-1==b?a:a.substr(0,b)}function Za(a,b){var c,d;if(b)for(c=F.length-1;0<=c;c--){if(d=F[c],d.name==b)return d}else for(c=F.length-1;0<=c;c--)if(d=F[c],d.match&&d.match(a))return d}function $a(a){a=a[0];return"true"==a.value?!0:"false"==a.value?!1:"on"!==a.value?a.value:a.checked}var h=ea.via=function(a,b){return new ua(a,
b)},ua=function(a,b){this.path=w(a||"",!0);j(b)||this.set(b)},na,m=g.extend,va={},B=g.isArray,t=g.isFunction,yb={undefined:r,"boolean":r,number:r,string:r},p="__via",Aa=/^__via\.([^\.]+?)(?:\.|$)/,gb=/this\.(?:get|cd)\s*\(\s*(['"])([\*\.\w]+)\1\s*\)/g,o={},A={},n,T=va[p]={},qa=va.hasOwnProperty,fa=ea.Array,ab=fa.prototype,zb=String.prototype,E=ab.slice,q,Ab=/^(?:\{.*\}|\[.*\])$/,bb=/^\.(\.*)([\.\*])/,pa=/^[\.\*]/,Bb=/[\.\*]/,Cb=/#+|\./g,ga=/#+/g,z=ea.RegExp,hb=/^(.+)[\.\*]\w+$/,u,Db=/^.+\.(\w+)$|\w+/,
wa,j,J,k,y,ca,M,R,w,da,cb;za(ab,{indexOf:function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]==a)return c;return-1},contains:function(a){return-1!==this.indexOf(a)},remove:function(a){a=this.indexOf(a);-1!=a&&this.splice(a,1);return this},removeAt:function(a){this.splice(a,1);return this},pushUnique:function(a){this.contains(a)||this.push(a);return this},merge:function(a){if(a&&a.length)for(var b=0;b<a.length;b++)this.pushUnique(a[b]);return this},sortObject:function(a,b){j(b)&&(b=!0);a?this.sort(function(c,
d){var e=c[a],f=d[a];return e==f?0:b?e>f?1:-1:e>f?-1:1}):b?this.sort():this.sort().reverse()}});za(zb,{startsWith:function(a){return 0===this.indexOf(a)},contains:function(a){return-1!==this.indexOf(a)},endsWith:function(a){return this.lastIndexOf(a)===this.length-a.length}});na=ua.prototype=h.fn=h.prototype={constructor:ua,get:function(a){var b=this.accessor(a,!0);if(b)return b=!b.index?b.hostObj:b.hostObj[b.index],t(b)?b.apply(this.cd(a).cd(".."),E.call(arguments,1)):b},helper:function(a,b){var c;
t(a)&&(b=a,a="");if(b)return c=this.accessor(a),c.index in c.hostObj?this.update(a,b,c):this.create(a,b,c);if(c=this.accessor(a,!0))return!c.index?c.hostObj:c.hostObj[c.index]},set:function(a,b){if(1==arguments.length){if(""==this.path)throw"root object can not changed";n.set(this.path,a);return this}var c=this.accessor(a),d=c.hostObj[c.index];if(t(d)){if(d.length)return d.apply(h(c.physicalPath).cd(".."),E.call(arguments,1));throw"Function at "+c.logicalPath+" is not a setter method";}return c.index in
c.hostObj?this.update(a,b,c):this.create(a,b,c)},accessor:function(a,b){0===a&&(a="0");var c,d,e=va,f=this.fullPath(a),g=w(f,!0),i=g.split(".");if(1===i.length)d=g;else{d=i[i.length-1];for(c=0;c<i.length-1&&!(e=e[i[c]],e===r);c++);}if(J(e)){if(b)return;throw"invalid access model using path:"+f;}return{physicalPath:g,logicalPath:f,hostObj:e,index:d}},create:function(a,b,c){c=c||this.accessor(a);if(c.index in c.hostObj)throw"value at path: '"+c.logicalPath+"' has been defined, try use update method instead";
a=c.physicalPath;if(q(a,a,"beforeCreate",b).hasError())return!1;c.hostObj[c.index]=b;q(a,a,"afterCreate");ia(a,b,Ba);return this},extend:function(a,b){var c;b?c=this.cd(a):(b=a,c=this);for(var d in b)c.set(d,b[d]);return this},update:function(a,b,c,d){ca(a)||(d=c,c=b,b=a,a=!1);d=d||this.accessor(b);if(!(d.index in d.hostObj))throw"value at path: '"+d.logicalPath+"' has been not defined, try use create method instead";b=d.physicalPath;if(!a&&q(b,b,"beforeUpdate",c).hasError())return!1;a=d.hostObj[d.index];
if(a===c)return this;d.hostObj[d.index]=c;q(b,b,"afterUpdate",c,a);ia(b,c,Ba);return this},del:function(a){if(a===r)return this.path?n.del(this.path):this;var a=this.accessor(a),b=a.physicalPath;if(q(b,b,"beforeDel").hasError())return!1;for(var c=0;c<xa.length;c++)xa[c](b,a.logicalPath);c=a.hostObj[a.index];B(a.hostObj)?a.hostObj.splice(a.index,1):delete a.hostObj[a.index];q(b,b,"afterDel",r,c);return this},createIfUndefined:function(a,b){var c=this.accessor(a);return c.index in c.hostObj?this:this.create(a,
b,c)},pushStack:function(a){a.previous=this;return a},cd:function(a){return this.pushStack(h(this.fullPath(a)))},parentModel:function(){return this.cd("..")},shadowModel:function(){return this.cd("*")},siblingModel:function(a){return this.cd(".."+a)},mainModel:function(){return this.pushStack(h(fb(this.path)))},triggerChange:function(a){a=this.physicalPath(a);q(a,a,"afterUpdate");return this},fullPath:function(a){return u(this.path,a)},logicalPath:function(a){return da(this.fullPath(a))},physicalPath:function(a){return w(this.fullPath(a))},
contextPath:function(){return Ea(this.path)},indexPath:function(){var a=Db.exec(this.path);return a[1]||a[0]},indexOf:function(a){return this.get().indexOf(a)},contains:function(a){return-1!==this.indexOf(a)},first:function(a){return a?this.filter(a)[0]:this.get("0")},last:function(){var a=this.get();return a[a.length-1]},push:function(a){return this.create(this.get().length,a)},pushRange:function(a){for(var b=0;b<a.length;b++)this.push(a[b]);return this},pushUnique:function(a){return!this.contains(a)?
this.push(a):this},pop:function(){return this.removeAt(this.get().length-1)},insertAt:function(a,b){this.get().splice(a,0,b);q(this.path,this.path+"."+a,"afterCreate");return this},updateAt:function(a,b){return this.update(a,b)},removeAt:function(a){this.del(a);var a=this.path,a="("+a.replace(".","\\.")+"\\.)(\\d+)|("+a.replace(".","#+")+"#+)(\\d+)",a=new z(a,"g"),b;for(b in o)if(qa.call(o,b)){var c=o[b],d=b.replace(a,Fa);d!==b&&(o[d]=c,delete o[b]);for(d=0;d<c.length;d++){var e=c[d],f=e.replace(a,
Fa);f!=e&&(c[d]=f)}}return this},prepend:function(a){return this.insertAt(0,a)},updateItem:function(a,b){if(a==b)return this;var c=this.indexOf(a);if(-1!=c)return this.updateAt(c,b);throw"oldItem not found";},removeItem:function(a){a=this.indexOf(a);return-1!==a?this.removeAt(a):this},removeItems:function(a){for(var b=0;b<a.length;b++)this.removeItem(a[b]);return this},clear:function(){var a=this.get();a.splice(0,a.length);q(this.path,this.path,"create");return this},count:function(){return this.get().length},
filter:function(a){return g(this.get()).filter(a).get()},each:function(a,b){ca(a)||(b=a,a=!1);var c,d,e,f;if(a){f=this.get();for(d=f.length-1;0<=d;d--)if(e=b(d,f[d],f),!0===e)c=!0;else if(!1===e)break;c&&this.triggerChange()}else for(d=this.count()-1;0<=d&&!(!1===b(d,this.cd(d),this));d--);},sort:function(a,b){return q(this.path,this.path,"afterUpdate",this.get().sortObject(a,b))},isEmpty:function(a){a=this.get(a);return!a?!0:!B(a)?!1:0===a.length},isShadow:function(){return this.path.startsWith(p)},
watchPath:function(a){Ca(this.path,a);return this},unwatchPath:function(a){Da(this.path,a);return this},pathsWatching:function(){var a,b,c=[],d=this.path;for(a in o)b=o[a],b.contains(d)&&c.push(a);return c},pathsOfWatchers:function(a){var b=o[this.path]||[];if(a)for(var c=0;c<b.length;c++)b.merge(h(b[c]).pathsOfWatchers(a));return b}};var xa=[function(a,b){for(var c in o)Da(a,c);for(c in o)c.startsWith(a)&&delete o[c];for(var d in T){c=p+"."+d;var e=da(c);(e==b||e.startsWith(b+"*")||e.startsWith(b+
"."))&&n.del(c)}}];m(h,{util:wa={factory:function(a,b){var c;t(a)?c=eval("(function "+a.name+" () {})"):(c=function(){},b=a,a=null);m(c.prototype,b);return function(){var b=new c;a&&a.apply(b,arguments);return b}},toPhysicalPath:w=function(a,b){for(var c,d="",e="",f;c=Bb.exec(a);)a=z.rightContext,e=z.leftContext,"."==c[0]?d?(d==p&&b&&!T[e]&&(f=e.replace(ga,ha),j(n.get(f))||(T[e]={})),d=d+"."+e):d=e:(d?(c=(d?d.replace(Cb,eb):d)+"#"+e,f=d+"."+e):f=e?c=e:c="",d=p+(c?"."+c:""),b&&!T[c]&&d!=p&&!j(n.get(f))&&
(T[c]={}));return!a?d:d?d+"."+a:a},toLogicalPath:da=function(a){var b;if(a===p)return"*";return(b=Aa.exec(a))?(a=z.rightContext,b=b[1].replace(ga,ha),da(b+"*"+a)):a},isUndefined:j=function(a){return a===r},isPrimitive:J=function(a){return null===a||typeof a in yb},isString:k=function(a){return"string"===typeof a},isObject:y=function(a){return"object"===g.type(a)},isBoolean:ca=function(a){return"boolean"===typeof a},toTypedValue:R=function(a){if(k(a)){a=g.trim(a);try{a="true"===a?!0:"false"===a?!1:
"null"===a?null:"undefined"===a?r:g.isNumeric(a)?parseFloat(a):Ab.test(a)?g.parseJSON(a):a}catch(b){}}return a},isPromise:M=function(a){return!(!a||!a.promise||!a.done||!a.fail)},clearObj:cb=function(a){if(J(a))return null;for(var b in a)qa.call(a,b)&&(a[b]=cb(a[b]));return a},clone:function(a,b){return J(a)?a:B(a)?a.slice(0):m(!!b,{},a)},local:function(a,b){if(1==arguments.length)return R(localStorage.getItem(a));j(b)?localStorage.removeItem(a):localStorage.setItem(a,JSON.stringify(b))}},onDisposing:function(a){xa.push(a)},
options:A,mergeLogicalPath:u=function(a,b,c){if(!j(b)&&(b+="",b.startsWith("/")))return b.substr(1);j(c)&&(c=!0);c&&b&&a&&!pa.test(b)&&(b="."+b);if(!b||"."==b)return a;if(pa.test(b)){if(bb.test(b)){for(var b=bb.exec(b),c=1+(b[1]?b[1].length:0),d=z.rightContext;c;)a=Ea(a),c--;return d?a+b[2]+d:"*"===b[2]?a+"*":a}}else return b;return a+b}});g("get,set,del,extend".split(",")).each(function(a,b){h[b]=function(){return n[b].apply(n,E.call(arguments))}});n=h();var Ia={},H,ka=/ /,La=/\*\.$/,mb=/\.|\*/g,
Eb=/^(\w+)\.?/,Qa,Ra,la,Z,Pa,ma,P=g.fn,C,kb=0,D=[],v,U,ob=/init(\d*)/,Na="get,set,convert,initialize,finalize,dispose".split(",");L.prototype={consturctor:L,isDependent:function(){return!this.publisher.path.startsWith(this.originalPublisher.path)},stopPropagation:function(){this.isPropagationStopped=K},stopImmediatePropagation:function(){this.isCascadeStopped=this.isPropagationStopped=this.isImmediatePropagationStopped=K},stopCascade:function(){this.isCascadeStopped=K},error:function(){this.hasError=
K},isCascadeStopped:V,isPropagationStopped:V,isImmediatePropagationStopped:V,hasError:V,level:0};q=function(a,b,c,d,e){d=new L(a,b,c,d,e);Ka(d);if(!d.isPropagationStopped()&&d.publisher.path){if(d.isDependent())d.originalPublisher.path=d.publisher.path;do d.publisher.path=d.publisher.contextPath(),d.level++,d.type=Eb.exec(d.type)[1]+"."+d.level,Ka(d);while(!d.isPropagationStopped()&&d.publisher.path)}d.type=c;d.originalPublisher.path=b;d.publisher.path=a;return d};C={getByPublisher:function(a){return ja(a,
function(a,c){return a.publisher==c})},getBySubscriber:function(a){return ja(a,function(a,c){return a.subscriber==c})},getByTarget:function(a){return!a?D:ja(a,function(a,c){return a.subscriber==c||a.publisher==c})}};m(h,{Event:L,trigger:q,subscriptions:C.getByTarget,subscribe:v=function(a,b,c,d,e,f){if(a instanceof h)a=a.path;if(b instanceof h)b=b.path;k(a)&&a.startsWith("$")&&(a=g(a.substr(1)));if(a&&a.jquery)if(!a.length&&!a.selector)a=null;else{a.each(function(a,g){v(g,b,c,d,e,f)});return}k(b)&&
b.startsWith("$")&&(b=g(b.substr(1)));if(b&&b.jquery)b.each(function(b,g){v(a,g,c,d,e,f)});else{if(!b&&""!==b)throw"publisher can not be null";if(!c)throw"eventTypes can not be null";if("_"===a||"null"==a||null===a)a=Ia;"_"===e&&(e=r);var j=k(b),i=k(a);Ja(b);Ja(a);j&&(b=w(b));i&&(a=w(a));j?nb(b,c,a,d,e):pb(b,c,a,d,e,f)}},unsubscribe:U=function(a){var b;if(y(a)){if(!g(a).viewId())return;g(a).removeData(p)}for(var c=D.length-1,d;0<=c;c--)if(d=D[c],b=d.handler,a===d.publisher||a===d.subscriber||k(a)&&
(k(d.publisher)&&d.publisher.startsWith(a+".")||k(d.subscriber)&&d.subscriber.startsWith(a+".")))k(d.publisher)||(b.delegateSelector?g(d.publisher).undelegate(b.delegateSelector,d.eventTypes,O):g(d.publisher).unbind(d.eventTypes,O)),b.dispose&&b.dispose(d.publisher,d.subscriber),D.splice(c,1)},handlers:function(a,b,c){var d;if(y(a))for(d in a)H[d]=N(a[d]);else return j(a)?H:j(b)?H[a]:H[a]=c?m(N(b),c):N(b)},filters:{getters:Qa={},setters:Ra={},converters:la={},initializers:Z={},finalizers:ma={},disposers:Pa=
{}}});H={triggerChange:{get:function(){n.triggerChange(this.options)}},saveLocal:{get:function(a){wa.local(a.publisher.path,a.publisher.get())}}};wa.getUniqueViewEventTypes=Ha;h.onDisposing(U);m(na,{subscribe:function(a,b,c,d,e){v(this.path,a,b,c,d,e);return this},subscribedBy:function(a,b,c,d,e){v(a,this.path,b,c,d,e);return this},unsubscribe:function(){U(this.path);return this},subsFromOthers:function(){return C.getByPublisher(this.path)},subsFromMe:function(){return C.getBySubscriber(this.path)},
subscriptions:function(){return C.getByTarget(this.path)},mapEvent:function(a,b,c){v(this.path,this.path,a,function(a){c(a.publisher.get(),a)&&q(a.publisher.path,a.publisher.path,b,a.proposed,a.removed)});return this},saveLocalAfterUpdate:function(a){h.subscribe(null,this.fullPath(a),"after*","*saveLocal");return this}});m(P,{subscribe:function(a,b,c,d,e){this.length&&v(this,a,b,c,d,e);return this},subscribedBy:function(a,b,c,d,e){this.length&&v(a,this,b,c,d,e);return this},unsubscribe:function(){return this.each(function(){U(this)})},
subsFromOthers:function(){return C.getByPublisher(this[0])},subsFromMe:function(){return C.getBySubscriber(this[0])},subscriptions:function(){return C.getByTarget(this[0])},initView:function(a,b,c){v(this,a,"init",b,c);return this},viewId:function(){return this.data(p)},aliasEvent:function(a,b){this.bind(a,function(){g(this).trigger(b)})}});g.createFilterEvent=function(a,b,c){var d=function(a){(!0===c||c(a))&&g(a.target).trigger(m({},a,{type:b,currentTarget:a.target}))};if(g.event.special[b])throw"event '"+
b+"' has been defined";g.event.special[b]={setup:function(){g(this).bind(a,d)},teardown:function(){g(this).unbind(a,d)}};return this};var Fb=g.cleanData;g.cleanData=function(a){g(a).each(function(){U(this)});Fb(a)};var ya;h.stage=ya=function(a){if(!B(a))return ya(E.call(arguments));var b,c,d,e,f,g,i,j;for(b=0;b<a.length;b++){c=a[b];e=c.subs;c.actor instanceof h||k(c.actor)&&!c.actor.startsWith("$")?(c.model&&n.set(c.actor,c.model),j=c.actor,i=c.context):(i=c.actor,j=c.context);if(j instanceof h)j=
j.path;k(i)&&i.startsWith("$")&&(i=i.substr(1));i=i||document;if(e){B(e[0])||(e=[e]);for(c=0;c<e.length;c++)d=e[c],g=Sa(d[0],j,i),f=Sa(d[1],j,i),v(g,f,d[2],d[3],d[4],d[5])}}return h};h.application=function(a){var b=[],c,d;d=a.models;var e=a.views;if(d)for(a=0;a<d.length;a++)c=d[a],b.push({actor:c.path,model:c.value,context:c.contextView,subs:c.subs});if(e)for(a=0;a<e.length;a++)d=e[a],b.push({actor:d.view,context:d.contextModel,subs:d.subs});ya(b);return h};var rb=/\s*([`@$!])([#\w\. \*]+)(:([\*\.\w$\/][^`@$!]*))*/g,
ub=/\s*;\s*/g,vb=/^([^|]+)(\|([^|]+))?(\|(.+?))??$/,Q=/\s*\|\s*/g,tb="class",wb="sub,pub,class,theme,ns,options".split(","),Xa={},$,I;A.theme="via";A.subsAttr="data-sub";A.autoImportSubs=!0;m(h,{customSubsProps:$={},importSubs:function(){ra(document.documentElement)},themes:{via:{classes:I={}}},classes:I});m(P,{findAll:function(a){if(0===this.length)return this;var b=this.filter(a);this.each(function(){b=b.add(g(this).find(a))});return b},importSubs:function(){return this.each(function(){ra(this)})},
dataSub:function(a){return j(a)?this.data("datasub"):this.data("datasub",a)}});(function(){var a=function(){A.autoImportSubs&&h.importSubs()};g.isReady?setTimeout(a,10):g(document).bind("ready",a)})();var S,ba={},sa={initialize:"*buildTemplateOptions",get:"get",convert:"*template",set:"html",finalize:"*importSubs"};Z.buildTemplateOptions=function(a,b,c,d){if(k(d))d=d.split(","),c.templateId=g.trim(d[0]),c.useDataSourceAsArrayItem="true"==g.trim(d[1]),c.engineName=d[2];else if(y(d)&&d.templateId)m(c,
d);else if(!(c.templateId=g(b).data("defaultTemplate")))if(a=g.trim(g(b).html()))g(b).empty(),c.templateId="__"+g.uuid++,S.compile(c.templateId,a),g(b).data("defaultTemplate",c.templateId);else throw"missing template";};la.template=function(a,b){if(a&&(B(a)&&a.length||!B(a))){var c=b.publisher,d=xb(this.templateId,this.useDataSourceAsArrayItem?[a]:a,{modelPath:c.path,e:b,get:function(){return c.get.apply(c,E.call(arguments))}},this.engineName);if(M(d))return d;k(d)&&(d=g.trim(d));return g(g("<div />").html(d)[0].childNodes)}return""};
ma.importSubs=function(a){g(a).importSubs()};h.handlers({renderInside:sa,render:aa("get","replaceWith")});I.foreach="!init after*.:.|*renderInside";I.renderInside="!init.:.|*renderInside";I.render="!init:.|*render";P.renderInside=function(a,b,c){b=b||"";t(c)&&(c={finalize:c});return this.initView(b,c?m({},sa,c):"*renderInside",a)};P.render=function(a,b,c){t(c)&&(c={finalize:c});return this.initView(a,c?m({},h.handlers("render"),c):"*render",b)};h.template=S={defaultEngine:"",engines:function(a,b,
c){if(!a)return ba;if(!b)return ba[a];ba[a]=b;if(!c)S.defaultEngine=a},load:function(a){if("undefined"==typeof matrix)throw"The method via.template.load require matrix.js,or you need override the method";return matrix(a+".template")},compile:function(a,b,c){return Ya(c).compile(a,b)},buildTemplateHandler:aa};var F,db=function(a){return null===a||a===r?"":""+a};m(!0,h.filters,{getters:{getOriginalModel:function(a){return a.originalPublisher.get()},getViewValue:function(a){return this.getViewValue(a.publisher)}},
setters:{setViewValue:function(a,b){return this.setViewValue(b.subscriber,a,b)}},converters:{toString:db,toTypedValue:R}});h.handlers({updateViewValue:{initialize:function(a,b,c,d){a=Za(b,d);if(!a||!a.set)throw"can not find set method for view";c.setViewValue=a.set;a.initialize&&!b.data("accesserInitialized")&&(a.initialize(b),b.data("accesserInitialized",!0))},get:"get",set:"*setViewValue"},updateModelValue:{initialize:function(a,b,c,d){d=Za(a,d);if(!d||!d.get)throw"can not find get method for view";
c.getViewValue=d.get;d.initialize&&!a.data("accesserInitialized")&&(d.initialize(a),b.data("accesserInitialized",!0))},get:"*getViewValue",set:"set"},options:{get:function(a){var b=this.options,c=a.subscriber,d=c.val();c.children("option[listItem]").remove().end().append(function(){var c="";g(a.publisher.get()).each(function(){c+="<option listItem='1' value='"+b.value(this)+"'>"+b.name(this)+"</option>"});return c}).val(d);c.val()!==d&&g(c.trigger("change"))},initialize:function(a,b,c,d){if(d){var a=
d.split(","),e=a[0],f=a[1]||a[0];c.options={name:function(a){return a[e]},value:function(a){return a[f]}}}else c.options={name:function(a){return a.toString()},value:function(a){return a.toString()}}}},hide:function(a){var b=this.effect;if(!b)this.effect=this.options;g(a.subscriber)[a.publisher.isEmpty()?"show":"hide"](b)},show:function(a){var b=this.effect;if(!b)this.effect=this.options;g(a.subscriber)[a.publisher.isEmpty()?"hide":"show"](b)},showPlural:function(a){var b=a.publisher.get();a.subscriber[1<
(b.length||b)?"show":"hide"]()},textCount:function(a){var b=a.publisher.get();a.subscriber.text("length"in b?b.length:b)},enable:function(a){g(a.subscriber).attr("disabled",a.publisher.isEmpty())},disable:function(a){g(a.subscriber).attr("disabled",!a.publisher.isEmpty())},showValue:function(a){a.subscriber.html("<span style='color:red'>"+a.publisher.path+" : "+JSON.stringify(a.publisher.get())+"</span>")},appendTmplItem:aa("*getOriginalModel","append"),updateTmplItem:aa(function(a){return a.publisher.get(ta(a))},
function(a,b){b.subscriber.children().eq(+ta(b)).replaceWith(a)}),removeTmplItem:{get:function(a){a.subscriber.children().eq(+ta(a)).remove()}},addClass:function(a){a.publisher.get()?a.subscriber.addClass(this.options):a.subscriber.removeClass(this.options)},removeClass:function(a){a.publisher.get()?a.subscriber.removeClass(this.options):a.subscriber.addClass(this.options)},del:function(a){a.subscriber.del()},"++":function(a){a.subscriber.set(a.subscriber.get()+1)},"--":function(a){a.subscriber.set(a.subscriber.get()-
1)},hardCode:{initialize:function(a,b,c,d){c.hardCode=R(d)},get:function(a){a.subscriber.set(this.hardCode)}},"null":function(a){a.subscriber.set(null)},"true":function(a){a.subscriber.set(!0)},"false":function(a){a.subscriber.set(!1)},toggle:function(a){a=a.subscriber;a.set(!a.get())},zero:function(a){a.subscriber.set(0)},preventDefault:function(a){a.preventDefault()},stopPropagation:function(a){a.stopPropagation()},alert:function(a){alert(j(this.options)?a.subscriber.get():this.options)},log:function(){},
sort:{initialize:function(a,b,c,d){d=d.split(",");c.by=d[0];c.asc=!!d[1]},get:function(a){a.subscriber.sort(this.by,this.asc);this.asc=!this.asc}}});F=[{name:"textBoxOrDropDown",get:function(a){return a.val()},set:function(a,b){a.val()!==b&&a.val(b)},match:K},{name:"checkbox",get:$a,set:function(a,b){var c=a[0];c.checked=ca(b)?b:b==c.value},match:function(a){return a.is(":checkbox")}},{name:"radio",get:$a,set:function(a,b,c){a=a[0];if(!a.name)a.name=c.publisher.path;a.checked=db(b)==a.value},match:function(a){return a.is(":radio")}},
{name:"listBox",get:function(a){var b=[];a.children("option:selected").each(function(){b.push(this.value)});return b},set:function(a,b){function c(){if(this.value==e)return this.selected=!0,!1}a.children("option:selected").removeAttr("selected");for(var d=0,e;d<b.length;d++)e=b[d],a.children("option").each(c)},match:function(a){return a.is("select[multiple]")}}];h.addViewValueAdapters=function(a){if(B(a))for(var b=0;b<a.length;b++)F.push(a[b]);else F.push(a)};m($,{caption:function(a,b,c,d){g(a).prepend("<option value=''>"+
d+"</option>")},val:function(a,b,c,d){var e,f=b.ns;(d=d||"")?(d=d.split(","),b=d[0]||"change",e=d[1]):b="change";(!e||"updateView"==e)&&c.push({publisher:f,eventTypes:"init1 after*",subscriber:a,handler:"*updateViewValue",options:d[2]});(!e||"updateModel"==e)&&c.push({publisher:a,eventTypes:b,subscriber:f,handler:"*updateModelValue",options:d[2]})},focus:function(a){g(a).focus()},aliasEvent:function(a,b,c,d){setTimeout(function(){var b,c,h=d.split(";"),i=g(a);for(b=0;b<h.length;b++)c=h[b].split(","),
i.aliasEvent(c[0],c[1])},1)},init:function(a,b,c,d){n.get(d,a,b,c,d)}});m(I,{listView:"!init after*.:.|*renderInside!afterCreate.1:.|*appendTmplItem!afterUpdate.1:.|*updateTmplItem!afterDel.1:.|*removeTmplItem",fullyLoadedListView:"!init after*:.|*renderInside",val:"@val:.",options:"!init after*:.|*options",show:"!init after*:.|*show",hide:"!init after*:.|*hide",enableLater:"!after*:.|*enable",disableLater:"!after*:.|*disable",enable:"!init after*:.|*enable",disable:"!init after*:.|*disable",html:"!init after*:.|get html *toString",
text:"!init after*:.|get text *toString",showPlural:"!init after*:.|*showPlural",showValue:"!init after*:.|*showValue",textCount:"!init after*:.|*textCount",alert:"$click:.|*alert",preventDefault:"$click:.|*preventDefault",deleteButton:"@aliasEvent:click,delete",updateButton:"@aliasEvent:click,update",editButton:"@aliasEvent:click,edit",cancelButton:"@aliasEvent:click,cancel",pageButton:"@aliasEvent:click,changePage"});g.createFilterEvent("keyup","enter",function(a){return 13===a.keyCode}).createFilterEvent("keyup",
"esc",function(a){return 27===a.keyCode});g.Event.prototype.selectedRowIndex=function(){return this.publisher.children().filter(this.originalPublisher.parents()).index()}})(jQuery,window);
