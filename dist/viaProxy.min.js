/*!
 * viaProxy.js JavaScript Library 0.2pre
 * http://semanticsworks.com
 *
 * Copyright 2011, Fred Yang
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license
 * http://www.opensource.org/licenses/gpl-2.0
 *
 * Date: Sat Dec 17 08:00:40 2011 -0500
 */
 window.jQuery&&window.via||function(f,D,i){function E(c){this.context=r(c||"",!0)}function w(c){return"object"===typeof c}function n(c){return"string"===typeof c}function I(c){return null===c||typeof c in ua}function J(c){return c===i}function x(c,a){0===a&&(a="0");var b,d,e=F,h=g.joinPath(c,a),f=r(h,!0),j=f.split(".");if(1===j.length)d=f;else{d=j[j.length-1];for(b=0;b<j.length-1&&!(e=e[j[b]],e===i);b++);}if(I(e))throw"invalid access proxy using path:"+h;return{physicalPath:f,logicalPath:h,hostObj:e,
index:d}}function K(c){this.mainPath=c}function r(c,a){if(!c)return"";if("*"===c)return k;var b=c.split("*");if(1===b.length)return c;var d=b[0],b=b[1],e=d.replace(ca,"_");if(a&&d){var h=k+"."+e;!va[e]&&q.get(d)!==i&&q.create(h,new K(d))}return!e?k+"."+b:b?k+"."+e+"."+b:k+"."+e}function da(c){if(c===k)return"*";var a=wa.exec(c);return a&&a[1]?a[2]?a[1].replace(U,".")+"*"+a[3]:a[1].replace(U,".")+"*":c}function L(c,a,b,d){var e,h=c.lastIndexOf(".");b&&(-1===h?(b="",e=c):(b=c.substring(0,h),e=c.substring(h+
1)),d(b,e,a));if(!I(a))for(e in a)y.call(a,e)&&(d(c,e,a[e]),L(c+"."+e,a[e],!1,d))}function ea(c,a,b){if(o(b))for(var b=b.toString(),d,e,h,f;(d=xa.exec(b))&&(e=d[1]);)c?(h=c+"."+a,f=c+"."+e):(h=a,f=e),l[f]=l[f]||[],l[f].pushUnique(h)}function ya(c,a){q.del(c+"."+a)}function fa(c){var a,b,d=s[c.path];if(d)for(b=0;b<d.length;b++){a=d[b];if(ga(a.modelEvents,c.eventType))c.options=a.options,V(a.view,a.modelHandler,c);if(!c.continueEventing)break}if((a=l[c.path])&&a.length)for(d=0;d<a.length;d++){b=u(a[d],
a[d],c.eventType,c.proposed===i?i:q.get(!0,a[d]));if(!b.continueEventing)break;if(b.hasError)c.hasError=!0}}function V(c,a,b){c===W&&(c=null);if(o(a))return a.call(c,b);if(n(a)){var d=a.substring(1),e=a.substring(2);if(a.beginsWith("*")){if(d=z[d])return d.call(c,b)}else if(a.beginsWith("$")){if(o(A[d])){a=b.currentValue();if("css,attr,prop".contains(d))b=b.options||b.targetIndex(),f(c)[d](b,a);else f(c)[d](a&&a.toString());return}}else if(a.beginsWith("v.")&&c[e]){a=b.currentValue();if(o(c[e]))c[e](a);
else c[e]=a;return}}throw"handler: "+a+" not found";}function ga(c,a){var b;if("*"===c)return!0;for(var c=c.split(ha),d=0;d<c.length;d++){b=c[d];if(b===a)return!0;if(b=za.exec(b))if(b[4])if(b[1]){if(X("^"+b[1]+"\\w*\\."+b[4]).test(a))return!0}else{if(X("^\\w+\\."+b[4]).test(a))return!0}else if(b[3]){if(b=b[1]?X("^"+b[1]+"(?!\\w*\\.\\w+)"):Aa,b.test(a))return!0}else if(a.beginsWith(b[1]))return!0}return!1}function B(c,a,b,d,e){w(c)?m(this,c):(this.path=c,this.target=a,this.eventType=b,!J(d)&&(this.proposed=
d),!J(e)&&(this.removed=e))}function ia(c,a,b){n(a)&&a.beginsWith("*")&&(a=z[a.substring(1)]);o(a.buildOptions)&&(b=a.buildOptions.call(c,b));return b}function Y(c){f(c).data(k,!0)}function M(c){return!0===f(c).data(k)}function N(c,a,b,d){w(c)?m(this,c):(this.path=c,this.options=a,this.e=b,this.triggerData=d)}function Ba(c,a){var b=c.data,d=new N(b.path,b.options,c,a),b=b.viewHandler;if(o(b))return O(d,b.call(this,d));if(n(b)){var e=b.substring(1),h=b.substring(2);if(b.beginsWith("*")){if(e=P[e]){e.call(this,
d);return}}else if(b.beginsWith("$")){if(o(A[e]))return O(d,"css,attr,prop".contains(e)?f(this)[e](d.options||d.targetIndex()):f(this)[e]())}else if(b.beginsWith("p.")){if(o(Z[h])){d.targetProxy()[h](d);return}}else if(b.beginsWith("v.")){if(e=this[h],o(e))return O(d,e.call(this,d))}else if(b.beginsWith("m.")&&(e=q.get(!0,h),o(e)))return O(d,e.call(this,d))}throw"view handler: '"+b+"' not found";}function O(c,a){if(a!==i){var b=c.options;n(b)&&b.beginsWith("*")&&(b=$[b.substring(1)])&&(a=b(a));q.update(c.path,
a)}}function ja(c){var a=c.data,b=f(c.target).data("via");(b=b&&b.viewEvents&&b.viewEvents[a])&&f(c.target).trigger(m({},c,{type:a+"."+b,currentTarget:c.target}))}function ka(c){if(!n(c))throw"bindingText must non-empty string";for(var a={},b,d;b=Ca.exec(c);)d=b[1],b=b[3]&&f.trim(b[3])||!0,a[d]=a[d]?a[d]+";"+b:b;return a}function Da(c){if(!c)return!1;var a;a:{a=c+".";for(var b in G)if(b.beginsWith(a)){a=!0;break a}a=!1}if(a)return!0;a=la(c);if(!a)return!1;b=0;for(var d;d=a[b];b++)for(var e in d){var f=
d[e],g=c+"."+e;G[g]=G[g]?G[g]+f:f}return!0}function la(c){var a=g.themes[c];if(a){c=[];a.bindingSet&&c.push(a.bindingSet);if(a=a.subThemes)for(var a=a.split(";"),b=0;b<a.length;b++)c=c.concat(la(a[b]));return c}}function ma(c,a,b){if(a[H]&&"_"!==a[H]&&Da(a.theme))for(var d=a[H].split(Ea),e,f=0;f<d.length;f++){var g=Fa.exec(d[f]);if(e=G[a.theme+"."+g[1]]){e=ka(e);e.path=na(a.path,g[3]);e.theme=a.theme;e.options=g[5]||a.options;ma(c,e,b);var g=c,j=e,i=b;Q("mh",g,j,i);Q("vh",g,j,i);oa(c,e,b)}}}function pa(c){for(c=
f(c);(c=c.parent())&&c.length;){var a=c.data("via");if(a&&a.path)return a.path}return""}function Q(c,a,b,d){var e,f,g,j;if(j=b[c]&&b[c].replace(Ga,"").split(";"))for(e=0;e<j.length;e++)if(f=Ha.exec(j[e]))g=na(b.path,f[1]),d[c].push("mh"===c?{path:g,modelEvents:f[2],view:a,modelHandler:f[3],options:f[5]||b.options}:{path:g,viewEvents:f[2],view:a,viewHandler:f[3],options:f[5]||b.options})}function oa(c,a,b){var d,e;for(e in a)y.call(a,e)&&!Ia.contains(e)&&(d=R[e])&&d(c,a,b,a[e])}function qa(c,a,b,d,
e){e=e||d&&d.engine||t.engine;if(!e)throw"there is not default engine registered";var g,i=d&&(f.isFunction(d)?d:d.callback),j=C[e||d&&d.engine||t.engine],d=d||{};d.get=function(a){return q.get(a)};if(!j)throw"engine '"+j+"' can not be found.";if(j.isTemplateCompiled(a))return g=f(j.renderTemplate(a,b,d)),i&&i.call(c,g),g;if("undefined"!==typeof matrix){var k=f.Deferred();matrix(matrix.resourceName(a)+".template").done(function(){g=f(j.renderTemplate(a,b,d));k.resolve(g)});return k.promise().done(function(){i&&
i.call(c,g)})}throw"can not locate template for '"+a+"'";}function ra(c){f(this).html(c);c.view()}function aa(c){var a=c.currentValue();if(a&&(S(a)&&a.length||!S(a))){var c=c.options,b=c.callback;c.callback=b?function(a){ra.call(this,a);b.call(this,a)}:ra;qa(this,c.templateId,a,c)}else f(this).empty()}function sa(c){var a=c.currentValue();c.currentValue=function(){return[a]};aa.call(this,c)}var g=D.via=function(c){return new E(c)},m=f.extend,F={},S=f.isArray,Ja=f.isPlainObject,o=f.isFunction,xa=/this\.((?:\.?\w+)+)/g,
ua={undefined:i,"boolean":i,number:i,string:i},k="__via",Ka=/__via\.(\w+)/,wa=/__via\.(\w+)(\.(.+))*/,l={},t={},q,va=F[k]={},U=/_/g,ca=/\./g,y=F.hasOwnProperty,p=Array.prototype,La=p.slice,u,Z=E.prototype={};p.indexOf=p.indexOf||function(c,a){for(var b=a||0;b<this.length;b++)if(this[b]==c)return b;return-1};p.contains=p.contains||function(c){return-1!==this.indexOf(c)};p.remove=p.remove||function(c){c=this.indexOf(c);-1!=c&&this.splice(c,1);return this};p.pushUnique=p.pushUnique||function(c){this.contains(c)||
this.push(c);return this};p.sortObject=p.sortObject||function(c,a){a=J(a)?!0:!1;c?this.sort(function(b,d){var e=b[c],f=d[c];return e==f?0:a?e>f?1:-1:e>f?-1:1}):a?this.sort():this.sort().reverse()};p=String.prototype;p.beginsWith=p.beginsWith||function(c){return 0===this.indexOf(c)};p.contains=p.contains||function(c){return-1!==this.indexOf(c)};m(Z,{version:"0.2pre",constructor:E,pushProxy:function(c){c.oldProxy=this;return c},childProxy:function(c){return this.pushProxy(new E(g.joinPath(this.context,
c)))},parentProxy:function(){return this.pushProxy(new g(g.contextOfPath(this.context)))},popProxy:function(){if(this.oldProxy)return this.oldProxy;throw"invalid operation, proxy.popProxy() failed because oldProxy is empty";},shadowProxy:function(){return this.childProxy("*")},mainProxy:function(){var c;if(this.context===k)c="";else if((c=Ka.exec(this.context))&&c[1])c=c[1].replace(U,".");else throw"proxy at '"+this.context+"' is already main proxy";return this.pushProxy(g(c))},triggerChange:function(c){c=
this.physicalPath(c);u(c,c,"afterUpdate");return this},logicalPath:function(c){return da(g.joinPath(this.context,c))},physicalPath:function(c){return r(g.joinPath(this.context,c))},get:function(c,a){if(n(c)||"number"===typeof c)a=""+c,c=!1;var b=x(this.context,a),d=!b.index?b.hostObj:b.hostObj[b.index];return!c&&o(d)?d.call(b.hostObj):d},call:function(c){var a=x(this.context,c),b=a.hostObj[a.index];if(!o(b))throw"object at '"+a.logicalPath+"' is not a function";return b.apply(a.hostObj,La.call(arguments,
1))},create:function(c,a,b){if(Ja(c)){for(var d in c)if(y.call(c,d)&&(b=this.create(d,c[d],a),!b))return!1;return this}b=b||x(this.context,c);if(b.index in b.hostObj)throw"value at path: '"+b.logicalPath+"' has been defined, try use update method instead";c=b.physicalPath;if(u(c,c,"beforeCreate",a).hasError)return!1;b.hostObj[b.index]=a;u(c,c,"afterCreate");L(c,a,!0,ea);return this},update:function(c,a,b){if(""!==this.context&&1===arguments.length)return q.update(this.context,c);b=b||x(this.context,
c);if(!(b.index in b.hostObj))throw"value at path: '"+b.logicalPath+"' has been not defined, try use create method instead";var d=b.physicalPath;if(u(d,d,"beforeUpdate",a).hasError)return!1;var e=b.hostObj[b.index];if(e===a)return this;b.hostObj[b.index]=a;u(d,d,"afterUpdate",i,e);L(d,a,!0,ea);return this},del:function(c,a){if(c===i)return q.del(this.context);var b=x(this.context,c);if(!a&&l[c]&&l[c].length)throw"can not remove path "+c+", because it is referenced!";var d=b.physicalPath;if(!a&&u(d,
d,"beforeDel").hasError)return!1;var e=b.hostObj[b.index];L(d,e,!1,ya);S(b.hostObj)?b.hostObj.splice(b.index,1):delete b.hostObj[b.index];u(d,d,"afterDel",i,e);for(b=0;b<g.modelCleanups.length;b++)g.modelCleanups[b](d);return this},createOrUpdate:function(c,a){var b=x(this.context,c);return b.index in b.hostObj?this.update(c,a,b):this.create(c,a,b)},createIfUndefined:function(c,a){var b=x(this.context,c);return b.index in b.hostObj?this:this.create(c,a,b)},updateAll:function(c){var a,b;for(b in c)if(y.call(c,
b)&&(a=this.update(b,c[b]),!a))return!1;return this},isModelEmpty:function(c,a){var b=this.get(c,a);return!b?!0:!S(b)?!1:0===b.length},indexOf:function(c){return this.get().indexOf(c)},contains:function(c){return-1!==this.indexOf(c)},first:function(){return this.get("0")},last:function(){var c=this.get();return c[c.length-1]},push:function(c){return this.create(this.get().length,c)},pushRange:function(c){for(var a=0;a<c.length;a++)this.push(c[a]);return this},pushUnique:function(c){return!this.contains(c)?
this.push(c):this},pop:function(){return this.removeAt(this.get().length-1)},insertAt:function(c,a){this.get().splice(c,0,a);u(this.context,this.context+"."+c,"afterCreate");return this},updateAt:function(c,a){return this.update(c,a)},removeAt:function(c){return this.del(c)},prepend:function(c){return this.insertAt(0,c)},swap:function(c,a){if(c==a)return this;var b=this.indexOf(c);if(-1!=b)return this.updateAt(b,a);throw"oldItem not found";},removeItem:function(c){c=this.indexOf(c);return-1!==c?this.removeAt(c):
this},clear:function(){var c=this.get();c.splice(0,c.length);u(this.context,this.context,"init");return this},count:function(){return this.get().length},sort:function(c,a){return g.raiseEvent(this.context,this.context,"init",this.get().sortObject(c,a))}});K.prototype={constructor:K,mainModel:function(){return q.get(this.mainPath)}};m(g,{fn:Z,joinPath:function(c,a){return!a?c:c?c+(a.toString().beginsWith("*")?a:"."+a):a},accessor:x,physicalPath:r,logicalPath:da,clearObj:function a(b){if(I(b))return null;
for(var d in b)y.call(b,d)&&(b[d]=a(b[d]));return b},isUndefined:J,isPrimitive:I,isString:n,isObject:w,ns:function(){return k},Shadow:K,modelCleanups:[function(a){for(var b in l)l[b].remove(a),0===l[b].length&&delete l[b];for(var d in l)d.beginsWith(a)&&delete l[d];a.beginsWith(k)||q.del(k+"."+a.replace(ca,"_"))}],addRef:function(a,b){a=r(a);b=r(b);l[b]=l[b]||[];l[b].pushUnique(a);return this},removeRef:function(a,b){a=r(a);b=r(b);l[b].remove(a);l[b].length||delete l[b];return this},modelReferences:l,
options:function(a,b){if(a===i)return t;if(w(a))return m(t,a),a;if(1===arguments.length)return t[a];if(b===i)delete t[a];else return t[a]=b},getAll:function(){var a=m({},F);delete a[k];return a},empty:function(){for(var a in F)a!==k&&q.del(a,!0)}});q=new E("");var za=/(\w+)?(\*?)(\.?)([^\s]*)/,Ma=/^(.+)\.\w+$/,Na=/^.+\.(\w+)$|\w+/,W={},X=D.RegExp,s={},z={},ha=/\s*\|\s*/,Aa=/^\w+(?!\w*\.\w+)/,Oa=/^(\w+)\.?/,A=f.fn;u=function(a,b,d,e,f){a=new B(a,b,d,e,f);fa(a);if(a.continueEventing&&a.bubbleUp)for(a.eventType=
Oa.exec(a.eventType)[1]+".child";((b=g.contextOfPath(a.path))||1)&&!(a.path=b,fa(a),!a.continueEventing||!a.bubbleUp||""===b););return a};B.prototype={constructor:B,targetProxy:function(){return g(this.target)},targetValue:function(a){return g().get(a,this.target)},targetContext:function(){return g.contextOfPath(this.target)},targetIndex:function(){return g.indexOfPath(this.target)},bubbleUp:!0,continueEventing:!0,hasError:!1,currentValue:function(a){return g().get(a,this.path)},currentProxy:function(){return g(this.path)},
isModelEmpty:function(){var a=this.options,a=a?n(a)?"true"===a:!!a:!1;return this.currentProxy().isModelEmpty(a)}};Y(W);m(g,{addModelHandler:function(a,b,d,e,h){if("once"===b)return this.renderViews(a,d,e,h);if(n(d)||o(d))h=e,e=d,d=W;"_"===h&&(h=i);a=r(a,!0);d=f(d);0<d.length&&!s[a]&&(s[a]=[]);d.each(function(){h=ia(this,e,h);Y(this);s[a].push({view:this,modelHandler:e,modelEvents:b,options:h});ga(b,"init")&&V(this,e,new B({path:a,target:a,eventType:"init",options:h}))});return g},removeModelHandler:function(a){if(n(a)){var a=
r(a),b;for(b in s)b.beginsWith(a)&&delete s[b]}else w(a)&&f(a).each(function(a,b){if(M(b))for(var f in s){for(var g=s[f],j=g.length-1;0<=j;j--)g[j].view===b&&g.splice(j,1);0===g.length&&delete s[f]}});return g},getModelHandlerData:function(a){if(n(a))return s[r(a)];if(w(a)){if(!M(a))return;var b={},d;for(d in s)for(var e=s[d],f=e.length-1;0<=f;f--)e[f].view===a&&(b[d]=b[d]||[],b[d].push(e[f]));return b}if(!a)return s},renderViews:function(a,b,d,e){a=r(a,!0);f(b).each(function(){e=ia(this,d,e);V(this,
d,new B({path:a,target:a,eventType:"init",options:e}))});return g},ModelEvent:B,commonModelHandlers:z,raiseEvent:u,indexOfPath:function(a){a=Na.exec(a);return a[1]||a[0]},contextOfPath:function(a){return(a=Ma.exec(a))&&a[1]||""}});g.modelCleanups.push(g.removeModelHandler);A.addModelHandler=function(a,b,d,e){g.addModelHandler(a,b,this,d,e);return this};A.renderViews=function(a,b,d){g.renderViews(a,this,b,d);return this};var P={},$={},v={};N.prototype={constructor:N,targetProxy:function(){return g(this.path)},
targetValue:function(a){return q.get(a,this.path)},targetContext:function(){return g.contextOfPath(this.path)},targetIndex:function(){return g.indexOfPath(this.path)},updateModel:function(a){return q.update(this.path,a)},returnFalse:function(){this.e.stopPropagation();this.e.preventDefault()},stopPropagation:function(){this.e.stopPropagation()},stopImmediatePropagation:function(){this.e.stopImmediatePropagation()}};m(g,{addViewHandler:function(a,b,d,e,h){var d=r(d,!0),l=e;"_"===h&&(h=i);n(e)&&e.beginsWith("*")&&
(e=P[e.substring(1)]);o(e.buildOptions)&&(h=e.buildOptions(a,h));o(e.initialize)&&e.initialize(a);f(a).each(function(){Y(this);b=f.map(b.split(ha),function(a){return a+"."+k+"."+d}).toString();f(this).bind(b,{viewHandler:e,path:d,options:h,originalHandler:l},Ba);v[d]=v[d]||[];v[d].pushUnique(this)});return g},removeViewHandler:function(a){n(a)?(a=r(a),f(v[a]).unbind("."+k+"."+a),delete v[a]):w(a)&&(f(a).unbind("."+k),f(a).each(function(){for(var a in v)v[a].remove(this)}));return g},removeView:function(a){f(a).each(function(a,
d){M(this)&&(g.removeModelHandler(d).removeViewHandler(d),f(this).removeData(k))});return g},commonViewHandlers:P,valueConverters:$,ViewEvent:N,getViewHandlerData:function(a){if(n(a))return v[a];if(w(a)){if(!M(a))return;var b=[],d;for(d in v)y.call(v,d)&&v[d].contains(a)&&b.push(d);return b}if(!a)return v},getHandlerData:function(a){var b=g.getModelHandlerData(a),d=g.getViewHandlerData(a);return n(a)?{viewsToBeUpdated:b,viewsUpdatingMe:d}:{modelsUpdatingMe:b,modelsToBeUpdated:d}}});g.modelCleanups.push(g.removeViewHandler);
var Pa=f.cleanData;f.cleanData=function(a){g.removeView(a);Pa(a)};g.forwardEvent=function(a,b,d){var e=function(a){d(a)&&f(a.target).trigger(m({},a,{type:b,currentTarget:a.target}))};if(f.event.special[b])throw"event '"+b+"' has been defined";f.event.special[b]={setup:function(){f(this).bind(a,e)},teardown:function(){f(this).unbind(a,e)}};return g};g.addViaEvent=function(a,b){f.event.special[a]={setup:function(){f(this).bind(b,a,ja)},teardown:function(){f(this).unbind(b,ja)}};return g};A.addViewHandler=
function(a,b,d,e){g.addViewHandler(this,a,b,d,e);return this};var ba=/^[\.\*]\w+/,ta=/^\.([\.\*])/,Ga=/\s+/g,Ca=/\s*@(\w+)(:([^@]+))*/g,Ea=/\s*;\s*/g,Fa=/(.+?)(,(.+?))?(,(.+))*$/,Ha=/(.+?),(.+?),(.+?)(,(.+))*$/,H="class",Ia="mh,vh,class,theme,path,options".split(","),G={},T={},R;t.theme="via";var na=g.mergePath=function(a,b){if(!b||"."==b)return a;if(ta.test(b))return b.replace(ta,g.contextOfPath(a)+"$1");if(ba.test(b)){var d=/^(.+)\*/.exec(a);return d&&d[1]&&b.beginsWith("*")?d[1]+b:b.replace(ba,
a+"$&")}return b};m(g,{specialParsers:R={},classMatchers:T,view:function(a){return f(a||":via").each(function(){if(!f(this).data("via")){var a;if(a=f(this).attr("via")){a=ka(a);f(this).data("via",a);if(a.path&&"."!==a.path){if(ba.exec(a.path))a.path=pa(this)+a.path}else a.path=pa(this);a.theme=a.theme||t.theme;var d={mh:[],vh:[]},e=a,h=H,i;if(!(i=a[H]))b:{for(var j in T)if(y.call(T,j)&&T[j](this)){i=j;break b}i=void 0}e[h]=i;ma(this,a,d);e=a;Q("mh",this,e,d);Q("vh",this,e,d);oa(this,a,d);a=d}else a=
void 0;if(a){d=a.mh;e=a.vh;for(a=0;a<d.length;a++)h=d[a],g.addModelHandler(h.path,h.modelEvents,h.view,h.modelHandler,h.options);for(a=0;a<e.length;a++)d=e[a],g.addViewHandler(d.view,d.viewEvents,d.path,d.viewHandler,d.options)}}})},themes:{via:{subThemes:i,bindingSet:D={}}}});R.viaEvent=function(a,b,d,e){if(!b.viewEvents)b.viewEvents={};a=e.split(",");for(d=0;d<a.length;d++)e=a[d].split("."),b.viewEvents[e[0]]=e[1]};f.expr[":"].via=function(a){return!!f(a).attr("via")};A.view=function(){g.view(this.findAll(":via"));
return this};f.fn.findAll=f.fn.findAll||function(a){if(0===this.length)return this;var b=this.filter(a);this.each(function(){b=b.add(f(this).find(a))});return b};f.fn.renderTemplate=function(a,b,d,e,g){return this.each(function(){function i(b){a&&(f(k)[a](b),b.view());l&&l.call(k,b)}var j,k=this,l=e&&(f.isFunction(e)?e:e.callback);"object"===typeof e?(e.callback=i,j=e):j=i;qa(k,b,d,j,g)})};g.compileTemplate=function(a,b,d){d=d||t.engine;if(!d)throw"there is not default engine registered";d=C[d];if(!d)throw"engine '"+
d+"' can not be found.";return d.compileTemplate(a,b)};sa.buildOptions=aa.buildOptions=function(a){return n(a)?(a=a.split(","),{templateId:f.trim(a[0]),engineName:a[1]}):a};m(z,{template:aa,templateOne:sa});var C=g.templateEngines={};if(f.tmpl)t.engine="tmpl",C.tmpl={renderTemplate:function(a,b,d){return a.beginsWith("#")?f(a).tmpl(b,d):f.tmpl(a,b,d)},compileTemplate:function(a,b){f.template(a,b)},isTemplateCompiled:function(a){return a.beginsWith("#")?!!f(a).length:!!f.template[a]}};else if(f.render)t.engine=
"jsrender",C.jsrender={renderTemplate:function(a,b,d){return a.beginsWith("#")?f(a).render(b,d):f.render(b,a,d)},compileTemplate:function(a,b){f.template(a,b)},isTemplateCompiled:function(a){return a.beginsWith("#")?!!f(a).length:!!f.views.templates[a]}};C.tmpl&&g.compileTemplate("ddl_tmpl","<option value='${this.value($data)}'>${this.name($data)}</option>");C.jsrender&&g.compileTemplate("ddl_jsrender","<option value='{{=$ctx.value($data)}}'>{{=$ctx.name($data)}}</option>","jsrender");m(z,{dropdown:m(function(a){z.template.call(this,
a)},{buildOptions:function(a){var b=(a||"").split(","),a=1===b.length?{name:function(a){return a.toString()},value:function(a){return a.toString()},engine:a}:{name:function(a){return a[b[0]]},value:function(a){return a[b[1]]},engine:b[2]};a.templateId="ddl_"+(a.engine||t.engine);return a}}),pushViewItem:function(a){f(this).renderTemplate("append",a.options,a.targetValue())},removeViewItem:function(a){f(this).children().eq(+a.targetIndex()).remove()},updateViewItem:function(a){f(this).children().eq(a.targetIndex()).renderTemplate("replaceWith",
a.options,a.targetValue())},showIfTruthy:function(a){f(this)[a.isModelEmpty()?"hide":"show"]()},showIfFalsy:function(a){f(this)[a.isModelEmpty()?"show":"hide"]()},enableIfTruthy:function(a){f(this).attr("disabled",a.isModelEmpty())},enableIfFalsy:function(a){f(this).attr("disabled",!a.isModelEmpty())},val:function(a){a=a.currentValue();a!==f(this).val()&&f(this).val(a)}});m(P,{value:function(a){return o(a.options)?a.options():a.options},evalOptions:function(a){return eval(a.options)},stringOptions:function(a){return a.options},
numberOptions:function(a){return+a.options},trueValue:function(){return!0},falseValue:function(){return!1},toggle:function(a){return!a.targetValue()},trueIfCheck:function(){return this.checked},trueIfUncheck:function(){return!this.checked},returnFalse:function(a){a.returnFalse()},preventDefault:function(a){a.e.preventDefault()},stopBubble:function(a){a.e.stopImmediatePropagation()}});m($,{toNumber:function(a){return+a},toDate:function(a){return new Date(a)},toString:function(a){return null===a||a===
i?"":""+a}});D.simpleList="@mh:.,init|afterUpdate,*template;.,afterCreate.child,*pushViewItem;.,afterUpdate.child,*updateViewItem;.,afterDel.child,*removeViewItem,_";R.lookup=function(a,b,d,e){var e=/^(.+?)(,(.*))*$/.exec(e),f=b.path;d.mh.push({path:g.mergePath(b.path,e[1]),modelEvents:"init",view:a,modelHandler:"*dropdown",options:e[3]});f&&(d.mh.push({path:b.path,modelEvents:"afterUpdate",view:a,modelHandler:"*val"}),d.vh.push({path:b.path,viewEvents:"change",view:a,viewHandler:"$val"}))};g.classMatchers.textBox=
function(a){return f(a).is(":text")};m(D,{textBox:"@mh:.,init|after*,*val@vh:.,keyup,$val",label:"@mh:.,init|after*,$html"})}(jQuery,window);
