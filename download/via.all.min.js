/*! via.js v0.2beta Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */(function(g,fa,w){function Ka(a,b){for(var c in b)a[c]||(a[c]=b[c])}function yb(a){return"."===a?"#":ra(a.length+2).join("#")}function zb(a){if(a===v)return"";var b=La.exec(a);return b?b[1].replace(sa,ta):a}function ta(a){return"#"==a?".":ra(a.length).join("#")}function ua(a,b,c,d){var e,f=a.lastIndexOf(".");l(d)&&(d=!0);d&&(-1===f?(d="",e=a):(d=a.substring(0,f),e=a.substring(f+1)),c(d,e,b));if(!N(b))for(e in b)c(a,e,b[e]),ua(a+"."+e,b[e],c,!1)}function Ma(a,b,c){if(t(c)&&"_"!=c.name){for(var b=a?
a+"."+b:b,d=c.toString(),e,c=[];e=Ab.exec(d);)c.pushUnique(e[2]);for(d=0;d<c.length;d++)Na(b,a?C(a,c[d]):c[d])}}function Na(a,b){b=F(b);q[b]=q[b]||[];q[b].pushUnique(a)}function Oa(a,b){b=F(b);q[b].remove(a);q[b].length||delete q[b]}function Pa(a){return(a=Bb.exec(a))&&a[1]||""}function Cb(a){for(var b=[],c=0;c<a.length;c++)b.push(new this(a[c]));return b}function ga(){return!1}function U(){return!0}function V(a,b,c,d,e){this.publisher=G(a);this.originalPublisher=G(b);this.type=c;this.proposed=d;
this.removed=e}function va(a,b){m(a)&&(a=F(a));for(var c=[],d=K.length-1,e;0<=d;d--)e=K[d],b(e,a)&&c.push(e);return c}function Db(a){var b=a.handler,c=b.getMethod,b=b.getProp,a=a.publisher;return b?a[c](b):t(a[c])?a[c]():a[c]}function Eb(a,b){var c=b.handler,d=c.setMethod;(c=c.setProp)?this[d](c,a):t(this[d])?this[d](a):this[d]=a}function Qa(a,b,c,d){K.push({publisher:a,subscriber:c,eventTypes:b,handler:d})}function Ra(a,b,c){var d=g(b).viewId();return g.map(a.split(wa),function(a){return m(c)?a+
"."+v+"."+d+"."+c:a+"."+v+"."+d+"."+g(c).data(v)}).join(" ")}function G(a){return m(a)?i(a):a==Sa?null:x(a)&&!a.nodeType?a:g(a)}function Ta(a){x(a)&&!g(a).data(v)&&g(a).data(v,++Fb)}function Gb(a){return"."==a?"\\.":".*"}function Ua(a){var b,c,d;d=a.publisher.subsFromOthers();if(d.length)for(c=0;c<d.length;c++){b=d[c];var e=a,f;a:{f=b.eventTypes;var h=a.type,g=void 0,i=void 0,k=g=void 0,y=void 0;if("*"===f)f="*";else{f=f.split(wa);for(y=0;y<f.length;y++)if(g=f[y],(k=Va.test(g))&&(g=g.replace(Va,"")),
i=g.replace(Hb,Gb),i=k?new z("^"+i):new z("^"+i+"$"),g=i.test(h))if(k){if(k="^"==i.source?h:z.rightContext,!k||!k.contains(".")){f=f[y];break a}}else{f=f[y];break a}f=void 0}}e.subscribedEvent=f;a.subscribedEvent&&ha(G(b.subscriber),b.handler,a);if(a.isImmediatePropagationStopped())return}if(!a.isCascadeStopped()&&(b=q[a.publisher.path]))for(d=0;d<b.length;d++){c=o(b[d],a.originalPublisher.path,a.type);if(c.isImmediatePropagationStopped()||c.isImmediatePropagationStopped())break;c.hasError()&&a.error()}}
function ha(a,b,c,d){var e;c.handler=b;d=l(d)?b.get.call(a,c):b.get.apply(a,[c].concat(d));if(W(d))e=n(!0,{},c),d.done(function(d){b.convert&&(d=b.convert.call(a,d,c));if(!l(d))if(W(d))d.done(function(c){ia(a,b,c,e)});else return ia(a,b,d,c)});else if(b.convert&&(d=b.convert.call(a,d,c)),!l(d))if(W(d))e=n(!0,{},c),d.done(function(c){ia(a,b,c,e)});else return ia(a,b,d,c)}function ia(a,b,c,d){if(!l(c)&&(b.set&&b.set.call(a,c,d),!l(c)&&b.finalize))return b.finalize.call(a,c,d)}function D(a){a.publisher=
G(a.currentTarget);a.originalPublisher=G(a.target);var b=G(a.data.subscriber),c=a.data.handler;delete a.data;1<arguments.length?ha(b,c,a,H.call(arguments,1)):ha(b,c,a)}function X(a,b,c,d){var e,a=a||"";if(m(a)){var f=a,h,a=f.split(wa),g=m(b),i=m(c);if(1==a.length)if(f.startsWith("*")){e=O[f.substr(1)];if(!e)throw"common handler "+f+" does not exist";e=n({},e)}else(h=Wa(f,b,c))?e={get:h}:!l(b)&&!l(c)&&(e=g?{get:"get",set:f||"set"}:i?f?{get:f,set:"set"}:{get:j.helper(c)}:{get:f,set:f});else{e={};for(g=
0;g<Xa.length;g++)(f=a[g])&&("_"!==f&&"null"!=f)&&(e[Xa[g]]=(h=Wa(f,b,c))?h:f)}}else if(t(a)||x(a)&&a.get){if(e=a,t(a)&&(e.get=a),!e.set&&!l(c)&&m(c))e.set="set"}else throw"invalid handler";if(!l(b)&&!l(c)){h=e;a=h.initialize;if(m(a))if(a.startsWith("*")){if(a=ja[a.substring(1)],!a)throw"common initializer does not exist!";}else{var k=a;if(!j.helper(k))throw"initializer does not exist at path "+k;a=function(a,b,c,d){j.set(k,a,b,c,d)}}a?(a(G(b),G(c),h,d),delete h.initialize):l(d)||(h.options=d)}d=
e;ka(d,"initialize",ja);Ya("get",d,b,c);Ya("set",d,b,c);ka(d,"convert",xa);ka(d,"finalize",ya);ka(d,"dispose",Za);return e}function Wa(a,b,c){if(a.startsWith("#"))return a=a.substr(1),m(c)?j.helper(C(c,a)):m(b)?j.helper(C(b,a)):j.helper(a)}function Ya(a,b,c,d){var e=b[a];if(m(e)&&""!=e){var f="get"==a?$a:ab;if(e.startsWith("*")){if(e=e.substr(1),b[a]=f[e],!b[a])throw e+" does not exists common "+a+" filter";}else if(e=e.split("*"),b[a]="get"==a?Db:Eb,b[a+"Method"]=e[0],e[1]&&(b[a+"Prop"]=e[1]),!l(c)&&
!l(d)){var b=e[0],c="get"==a?c:d,h;m(c)?P[b]||(h=!0):c.nodeType?Y[b]||(h=!0):b in c||(h=!0);if(h)throw("get"==a?"publisher":"subscriber")+" does not have a member "+b;}}}function ka(a,b,c){var d=a[b];m(d)&&(a[b]=d.startsWith("*")?c[d.substr(1)]:function(){return j.set.apply(j,[d].concat(H.call(arguments)))})}function bb(a){if(a){for(var b=0,c={},d=[],e,f,h;e=Ib.exec(a);)d.push({seperator:e[1]||e[3],propertyName:g.trim(e[2]||e[4]),from:(z.leftContext+z.lastMatch).length}),0!==b&&(d[b-1].to=z.leftContext.length),
b++;d.length&&(d[d.length-1].to=a.length);for(b=0;b<d.length;b++)f=d[b],h=f.seperator,e=f.propertyName,f=g.trim(a.substring(f.from,f.to))||null,"`"==h?(f=f?e+"|"+f:e,e="class"):"$"==h?(f=e+"|"+f,e="pub"):"!"==h&&(f=f.split(Z),f.splice(1,0,e),f=f.join("|"),e="sub"),c[e]=c[e]?c[e]+";"+f:f;return c}}function cb(a){var b=i.themes[a],c=[],d=b.parentThemes;!d&&"via"!=a&&(d="via");"null"==d&&(d=w);b.classes&&c.push(b.classes);if(d){d=d.split(";");for(a=0;a<d.length;a++)c=c.concat(cb(d[a]))}return c}function za(a,
b){for(var c=g(a);(c=c.parent())&&c.length;){var d=c.dataSub();if(d&&d[b])return d[b]}return""}function db(a,b,c,d){var e,f,h,r,i,k,y=c[a]&&c[a].split(";");if(y)for(e=0;e<y.length;e++)if(f=g.trim(y[e]))if(f=f.split(Z))"sub"==a?(h=f[0],h=h.startsWith("$")?h:C(c.ns,h),r=f[1],i=b):(h=b,r=f[0],i=f[1],i=i.startsWith("$")?i:C(c.ns,i)),k=f[3],k=Q(k?k:c.options),d.push({publisher:h,eventTypes:r,subscriber:i,handler:f[2],options:k,delegate:f[4]})}function eb(a,b,c){var d,e,f,h,r;if(f=r=b[Jb])if(f="_"!==r)b:if(f=
b.theme,!f||!i.themes[f])f=!1;else{if(!i.themes[f].loaded){d=cb(f);if(!d){f=!1;break b}for(e=d.length-1;h=d[e];e--)for(var m in h)fb[f+"."+m]=h[m];i.themes[f].loaded=!0}f=!0}if(f){r=r.split(Kb);for(m=0;m<r.length;m++)if(d=Lb.exec(r[m]),f=d[1],f=g.trim(fb[b.theme+"."+f]),f=bb(f))e=d[3],d=d[5],f.ns=C(C(b.ns,e),f.ns),f.theme=b.theme,d?(e=d.split(Z),f.options=2==e.length?e[1]:d):f.options=b.options,d&&(h=f.sub,e=f.pub,!h&&e&&1==e.split(";").length?(e=e.split(Z),f.pub=l(e[3])?f.pub+("|"+d):f.pub+d):!e&&
(h&&1==h.split(";").length)&&(e=h.split(Z),f.sub=l(e[3])?f.sub+("|"+d):f.sub+d)),eb(a,f,c)}for(var k in b)if(la.call(b,k)&&!Mb.contains(k))if(E[k])E[k](a,b,c,"."==b[k]?b.options:b[k]);else g(a).dataSub()[k]=b[k];db("sub",a,b,c);db("pub",a,b,c)}function Aa(a){if(g(a).attr(p.subsAttr)&&!g(a).dataSub()){var b,c,d;(b=g.trim(g(a).attr(p.subsAttr)))?(b=bb(b),g(a).dataSub(b),c=b.ns,b.ns=c&&"."!==c?C(za(a,"ns"),c):za(a,"ns"),b.theme=b.theme||za(a,"theme")||p.theme,c=[],eb(a,b,c),d=c.length?c:w):d=void 0;
if(d)for(b=0;b<d.length;b++)c=d[b],u(c.subscriber,c.publisher,c.eventTypes,c.handler,c.options,c.delegate)}g(a).children().each(function(){Aa(this)})}function R(a,b,c){return n({},Ba,x(a)?a:{get:a,set:b,finalize:c})}function gb(a){a=a||$.defaultEngine;if(!a)throw"engine name is not specified or default engine name is null";a=ma[a];if(!a)throw"engine '"+a+"' can not be found.";return a}function Ca(a){var a=a.originalPublisher.path.substr(a.publisher.path.length+1),b=a.indexOf(".");return-1==b?a:a.substr(0,
b)}function hb(a,b){var c,d;if(b)for(c=L.length-1;0<=c;c--){if(d=L[c],d.name==b)return d}else for(c=L.length-1;0<=c;c--)if(d=L[c],d.match&&d.match(a))return d}function ib(a){a=a[0];return"true"==a.value?!0:"false"==a.value?!1:"on"!==a.value?a.value:a.checked}function jb(a,b){for(var c=i.subscriptions(),d={},e=c.length-1,f,h;0<=e;e--)if(f=c[e],m(h=f.publisher)&&!d[h]&&h.startsWith(a)&&f.eventTypes.contains("validate"))d[h]=!0,b(h)}function kb(a){g.each(H.call(arguments,1),function(b,c){a=a.replace(new z("\\{"+
b+"\\}","g"),c)});return a}function lb(a){var b={get:function(b){var d,e,f;d=b.handler.options;f=a.name&&p.errors[a.name];a.buildError?f=a.buildError(f,d):(d=x(d)?d.error:d,f=f&&f.contains("{0}")?kb.apply(null,[f].concat(d.split(","))):d||f||a.error);if(null===b.proposed||b.proposed===w||Nb.test(b.proposed)){a:{d=i(b.publisher.path).subsFromOthers();for(var h=0;h<d.length;h++)if(d[h].handler.get===i.handlers("v_required").get){d=!0;break a}d=!1}d?(d=!1,e=!0):d=!0}else d=a.isValid(b.proposed,b.handler.options);
d?b.publisher.removeError(f):(!e||"required"===a.name)&&b.publisher.addError(f)}};a.initialize&&(b.initialize=a.initialize,delete a.initialize);return b}function S(a,b){return b?function(b){return!a.test(b)}:function(b){return a.test(b)}}function M(){var a=H.call(arguments,0);return function(b,c){return c.error||kb.apply(null,[b].concat(g.map(a,function(a){return c[a]})))}}function Da(a,b,c){m(b)?u(null,a,Ea,"*v_"+b,c):t(b)&&u(null,a,Ea,lb({isValid:b,error:c}));return this}function mb(a){var b=i(a+
"*errors");b.isEmpty()||(b.clear(),na.removeItem(a))}function aa(a,b,c,d,e){var f=aa.deletedIndex;return b?c<f?a:b+(c-1):e<f?a:d+(e-1)}function oa(a,b,c,d,e){return b?b+(c-1):d+(e-1)}function nb(a){var a=x(a)?T(a.publisher.path):a,b={};b[a]=j.get(a);Ob(b)}function pa(a,b,c){var d=g(a).data("appLoader");d||(d={},g(a).data("appLoader",d));if(l(c))return d[b];c?d[b]=c:delete d[b]}var i=fa.via=function(a,b){return new Fa(a,b)},Fa=function(a,b){this.path=F(a||"",!0);l(b)||this.set(b)},P,n=g.extend,Ga=
{},I=g.isArray,t=g.isFunction,Pb={undefined:w,"boolean":w,number:w,string:w},v="__via",La=/^__via\.([^\.]+?)(?:\.|$)/,Ab=/this\.(?:get)\s*\(\s*(['"])([\*\.\w\/]+)\1\s*\)/g,q={},p={},j,B=Ga[v]={},la=Ga.hasOwnProperty,ra=fa.Array,ob=ra.prototype,Qb=String.prototype,H=ob.slice,o,Rb=/^(?:\{.*\}|\[.*\])$/,pb=/^\.(\.*)([\.\*])/,qb=/^[\.\*]/,Sb=/[\.\*]/,Tb=/#+|\./g,sa=/#+/g,z=fa.RegExp,Bb=/^(.+)[\.\*]\w+$/,C,Ub=/^.+\.(\w+)$|\w+/,ba,l,N,m,x,qa,W,Q,F,T,Ha,ca;Ka(ob,{indexOf:function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]==
a)return c;return-1},contains:function(a){return-1!==this.indexOf(a)},remove:function(a){a=this.indexOf(a);-1!=a&&this.splice(a,1);return this},removeAt:function(a){this.splice(a,1);return this},pushUnique:function(a){this.contains(a)||this.push(a);return this},merge:function(a){if(a&&a.length)for(var b=0;b<a.length;b++)this.pushUnique(a[b]);return this},sortObject:function(a,b){l(b)&&(b=!0);a?this.sort(function(c,d){var e=c[a],f=d[a];return e==f?0:b?e>f?1:-1:e>f?-1:1}):b?this.sort():this.sort().reverse();
return this}});Ka(Qb,{startsWith:function(a){return 0===this.indexOf(a)},contains:function(a){return-1!==this.indexOf(a)},endsWith:function(a){return this.lastIndexOf(a)===this.length-a.length}});P=Fa.prototype=i.fn=i.prototype={constructor:Fa,get:function(a){var b=this.accessor(a,!0);if(b)return b=!b.index?b.hostObj:b.hostObj[b.index],t(b)?b.apply(this.cd(a).cd(".."),H.call(arguments,1)):b},helper:function(a,b){var c;t(a)&&(b=a,a="");if(b)return c=this.accessor(a),c.index in c.hostObj?this.update(a,
b,c):this.create(a,b,c);if(c=this.accessor(a,!0))return!c.index?c.hostObj:c.hostObj[c.index]},set:function(a,b){if(1==arguments.length){if(""==this.path)throw"root object can not changed";j.set(this.path,a);return this}var c=this.accessor(a),d=c.hostObj[c.index];if(t(d)){if(d.length)return d.apply(i(c.physicalPath).cd(".."),H.call(arguments,1));throw"Function at "+c.logicalPath+" is not a setter method";}return c.index in c.hostObj?this.update(a,b,c):this.create(a,b,c)},accessor:function(a,b){0===
a&&(a="0");var c,d,e=Ga,f=this.fullPath(a),h=F(f,!0),g=h.split(".");if(1===g.length)d=h;else{d=g[g.length-1];for(c=0;c<g.length-1&&!(e=e[g[c]],e===w);c++);}if(N(e)){if(b)return;throw"invalid access model using path:"+f;}return{physicalPath:h,logicalPath:f,hostObj:e,index:d}},create:function(a,b,c){c=c||this.accessor(a);if(c.index in c.hostObj)throw"value at path: '"+c.logicalPath+"' has been defined, try use update method instead";a=c.physicalPath;if(o(a,a,"beforeCreate",b).hasError())return!1;c.hostObj[c.index]=
b;o(a,a,"afterCreate");ua(a,b,Ma);return this},extend:function(a,b){var c;b?c=this.cd(a):(b=a,c=this);for(var d in b)c.set(d,b[d]);return this},update:function(a,b,c,d){qa(a)||(d=c,c=b,b=a,a=!1);d=d||this.accessor(b);if(!(d.index in d.hostObj))throw"value at path: '"+d.logicalPath+"' has been not defined, try use create method instead";var b=d.physicalPath,e=d.hostObj[d.index];if(e==c)return this;if(!a&&o(b,b,"beforeUpdate",c).hasError())return!1;d.hostObj[d.index]=c;o(b,b,"afterUpdate",c,e);ua(b,
c,Ma);return this},del:function(a){if(a===w)return this.path?j.del(this.path):this;var a=this.accessor(a),b=a.hostObj,c=a.physicalPath,d=I(b);if(o(c,c,"beforeDel").hasError())return!1;var e=b[a.index];d?b.splice(a.index,1):delete b[a.index];for(b=0;b<Ia.length;b++)Ia[b](c,a.logicalPath,d);o(c,c,"afterDel",w,e);return this},createIfUndefined:function(a,b){var c=this.accessor(a);return c.index in c.hostObj?this:this.create(a,b,c)},pushStack:function(a){a.previous=this;return a},cd:function(a){return this.pushStack(i(this.fullPath(a)))},
parentModel:function(){return this.cd("..")},shadowModel:function(){return this.cd("*")},siblingModel:function(a){return this.cd(".."+a)},mainModel:function(){return this.pushStack(i(zb(this.path)))},triggerChange:function(a){a=this.physicalPath(a);o(a,a,"afterUpdate");return this},fullPath:function(a){return C(this.path,a)},logicalPath:function(a){return T(this.fullPath(a))},physicalPath:function(a){return F(this.fullPath(a))},contextPath:function(){return Pa(this.path)},indexPath:function(){var a=
Ub.exec(this.path);return a[1]||a[0]},indexOf:function(a){return this.get().indexOf(a)},contains:function(a){return-1!==this.indexOf(a)},first:function(a){return a?this.filter(a)[0]:this.get("0")},last:function(){var a=this.get();return a[a.length-1]},push:function(a){return this.create(this.get().length,a)},pushRange:function(a){for(var b=0;b<a.length;b++)this.push(a[b]);return this},pushUnique:function(a){return!this.contains(a)?this.push(a):this},pop:function(){return this.removeAt(this.get().length-
1)},insertAt:function(a,b){this.get().splice(a,0,b);o(this.path,this.path+"."+a,"afterCreate");return this},updateAt:function(a,b){return this.update(a,b)},removeAt:function(a){this.del(a);return this},prepend:function(a){return this.insertAt(0,a)},updateItem:function(a,b){if(a==b)return this;var c=this.indexOf(a);if(-1!=c)return this.updateAt(c,b);throw"oldItem not found";},removeItem:function(a){a=this.indexOf(a);return-1!==a?this.removeAt(a):this},removeItems:function(a){for(var b=0;b<a.length;b++)this.removeItem(a[b]);
return this},clear:function(){var a=this.get();a.splice(0,a.length);o(this.path,this.path,"afterCreate");return this},count:function(){return this.get().length},filter:function(a){return g(this.get()).filter(a).get()},each:function(a,b){qa(a)||(b=a,a=!1);var c,d,e,f;if(a){f=this.get();for(d=f.length-1;0<=d;d--)if(e=b(d,f[d],f),!0===e)c=!0;else if(!1===e)break;c&&this.triggerChange()}else for(d=this.count()-1;0<=d&&!1!==b(d,this.cd(d),this);d--);},sort:function(a,b){return o(this.path,this.path,"afterUpdate",
this.get().sortObject(a,b))},isEmpty:function(a){a=this.get(a);return!a?!0:!I(a)?!1:0===a.length},isShadow:function(){return this.path.startsWith(v)},watchPath:function(a){Na(this.path,a);return this},unwatchPath:function(a){Oa(this.path,a);return this},pathsWatching:function(){var a,b,c=[],d=this.path;for(a in q)b=q[a],b.contains(d)&&c.push(a);return c},pathsOfWatchers:function(a){var b=q[this.path]||[];if(a)for(var c=0;c<b.length;c++)b.merge(i(b[c]).pathsOfWatchers(a));return b},toJSON:function(a){return JSON.stringify(this.get(a))},
compare:function(a){return eval("this.get()"+a)}};var Ia=[function(a,b){for(var c in q)Oa(a,c);for(c in q)c.startsWith(a)&&delete q[c];for(var d in B){c=v+"."+d;var e=T(c);(e==b||e.startsWith(b+"*")||e.startsWith(b+"."))&&j.del(c)}}];n(i,{util:ba={factory:function(a,b){var c,d;t(a)?c=a:(c=function(){},b=a,a=function(a){n(this,a)});n(c.prototype,b);d=function(){var b=new c;a.apply(b,arguments);return b};d.makeSome=Cb;return d},toPhysicalPath:F=function(a,b){for(var c,d="",e="",f;c=Sb.exec(a);)a=z.rightContext,
e=z.leftContext,"."==c[0]?d?(d==v&&(b&&!B[e])&&(f=e.replace(sa,ta),l(j.get(f))||(B[e]={})),d=d+"."+e):d=e:(d?(c=(d?d.replace(Tb,yb):d)+"#"+e,f=d+"."+e):f=e?c=e:c="",d=v+(c?"."+c:""),b&&(!B[c]&&d!=v&&!l(j.get(f)))&&(B[c]={}));return!a?d:d?d+"."+a:a},toLogicalPath:T=function(a){var b;return a===v?"*":(b=La.exec(a))?(a=z.rightContext,b=b[1].replace(sa,ta),T(b+"*"+a)):a},isUndefined:l=function(a){return a===w},isPrimitive:N=function(a){return null===a||typeof a in Pb},isString:m=function(a){return"string"===
typeof a},isObject:x=function(a){return"object"===g.type(a)},isBoolean:qa=function(a){return"boolean"===typeof a},toTypedValue:Q=function(a){if(m(a)){a=g.trim(a);try{a="true"===a?!0:"false"===a?!1:"null"===a?null:"undefined"===a?w:g.isNumeric(a)?parseFloat(a):Rb.test(a)?g.parseJSON(a):a}catch(b){}}return a},isPromise:W=function(a){return!(!a||!a.promise||!a.done||!a.fail)},clearObj:Ha=function(a){if(N(a))return null;for(var b in a)la.call(a,b)&&(a[b]=Ha(a[b]));return a},clone:ca=function(a,b){return N(a)?
a:I(a)?a.slice(0):n(!!b,{},a)},local:function(a,b){if(1==arguments.length)return Q(localStorage.getItem(a));l(b)?localStorage.removeItem(a):localStorage.setItem(a,JSON.stringify(b))},_modelLinks:q},onDisposing:function(a){Ia.push(a)},options:p,mergeLogicalPath:C=function(a,b,c){if(!l(b)&&(b+="",b.startsWith("/")))return b.substr(1);l(c)&&(c=!0);c&&(b&&a&&!qb.test(b))&&(b="."+b);if(!b||"."==b)return a;if(qb.test(b)){if(pb.test(b)){for(var b=pb.exec(b),c=1+(b[1]?b[1].length:0),d=z.rightContext;c;)a=
Pa(a),c--;return d?a?a+b[2]+d:d:"*"===b[2]?a+"*":a}}else return b;return a+b}});g(["get","set","del","extend"]).each(function(a,b){i[b]=function(){return j[b].apply(j,H.call(arguments))}});j=i();var Sa={},O,wa=/ /,Va=/\*\.$/,Hb=/\.|\*/g,Vb=/^(\w+)\.?/,$a,ab,xa,ja,Za,ya,Y=g.fn,J,Fb=0,K=[],u,da,Wb=/init(\d*)/,Xa="get set convert initialize finalize dispose".split(" ");V.prototype={consturctor:V,isDependent:function(){return!this.publisher.path.startsWith(this.originalPublisher.path)},stopPropagation:function(){this.isPropagationStopped=
U},stopImmediatePropagation:function(){this.isCascadeStopped=this.isPropagationStopped=this.isImmediatePropagationStopped=U},stopCascade:function(){this.isCascadeStopped=U},error:function(){this.hasError=U},isCascadeStopped:ga,isPropagationStopped:ga,isImmediatePropagationStopped:ga,hasError:ga,level:0};o=function(a,b,c,d,e){d=new V(a,b,c,d,e);Ua(d);if(!d.isPropagationStopped()&&d.publisher.path){d.isDependent()&&(d.originalPublisher.path=d.publisher.path);do d.publisher.path=d.publisher.contextPath(),
d.level++,d.type=Vb.exec(d.type)[1]+"."+d.level,Ua(d);while(!d.isPropagationStopped()&&d.publisher.path)}d.type=c;d.originalPublisher.path=b;d.publisher.path=a;return d};J={getByPublisher:function(a){return va(a,function(a,c){return a.publisher==c})},getBySubscriber:function(a){return va(a,function(a,c){return a.subscriber==c})},getByTarget:function(a){return!a?K:va(a,function(a,c){return a.subscriber==c||a.publisher==c})}};n(i,{Event:V,trigger:o,subscriptions:J.getByTarget,subscribe:u=function(a,
b,c,d,e,f){a instanceof i&&(a=a.path);b instanceof i&&(b=b.path);m(a)&&a.startsWith("$")&&(a=g(a.substr(1)));if(a&&a.jquery)if(!a.length&&!a.selector)a=null;else{a.each(function(a,h){u(h,b,c,d,e,f)});return}m(b)&&b.startsWith("$")&&(b=g(b.substr(1)));if(b&&b.jquery)b.each(function(b,h){u(a,h,c,d,e,f)});else{if(!b&&""!==b)throw"publisher can not be null";if(!c)throw"eventTypes can not be null";if("_"===a||"null"==a||null===a)a=Sa;"_"===e&&(e=w);var h=m(b),r=m(a);Ta(b);Ta(a);h&&(b=F(b));r&&(a=F(a));
if(h){var l=b,k=c,y=a,h=e,j,n,q,o;o=k.split(" ");for(var p=0;p<o.length;p++)if(r=Wb.exec(o[p])){n=o[p];j=+r[1];o.splice(p,1);k=o.join(" ");break}q=X(d,l,y,h);k&&Qa(l,k,y,q);n&&(k=function(){var a=new V(l,l,n);ha(G(y),q,a)},j?setTimeout(k,j):k())}else(j=b,h=c,r=a,o=e,p=h.split(" "),p.contains("init")&&(k=!0,h=p.remove("init").join(" ")),p=X(d,j,r,o),o={handler:p,subscriber:r},h)?(h=Ra(h,j,r),f?(p.delegateSelector=f,g(j).delegate(f,h,o,D)):g(j).bind(h,o,D),Qa(j,h,r,p),k&&(f?g(j).find(f).trigger(h):
g(j).trigger(h))):k&&(g(j).one("init",o,D),g(j).trigger("init"))}},unsubscribe:da=function(a){var b;if(x(a)){if(!g(a).viewId())return;g(a).removeData(v)}for(var c=K.length-1,d;0<=c;c--){d=K[c];b=d.handler;var e;e=a;var f=d.publisher,h=d.subscriber;e=e===f||e===h?!0:m(e)?m(f)&&f.startsWith(e+".")||m(h)&&h.startsWith(e+"."):!1;e&&(m(d.publisher)||(b.delegateSelector?g(d.publisher).undelegate(b.delegateSelector,d.eventTypes,D):g(d.publisher).unbind(d.eventTypes,D)),b.dispose&&b.dispose(d.publisher,d.subscriber),
K.splice(c,1))}},handlers:function(a,b,c){var d;if(x(a))for(d in a)O[d]=X(a[d]);else return l(a)?O:l(b)?O[a]:O[a]=c?n(X(b),c):X(b)},filters:{getters:$a={},setters:ab={},converters:xa={},initializers:ja={},finalizers:ya={},disposers:Za={}}});O={triggerChange:{get:function(a){j.triggerChange(a.handler.options)}},saveLocal:{get:function(a){ba.local(a.publisher.path,a.publisher.get())}}};i.onDisposing(da);n(P,{subscribe:function(a,b,c,d,e){u(this.path,a,b,c,d,e);return this},subscribedBy:function(a,b,
c,d,e){u(a,this.path,b,c,d,e);return this},unsubscribe:function(){da(this.path);return this},subsFromOthers:function(){return J.getByPublisher(this.path)},subsFromMe:function(){return J.getBySubscriber(this.path)},subscriptions:function(){return J.getByTarget(this.path)},mapEvent:function(a,b,c){u(this.path,this.path,a,function(a){c(a.publisher.get(),a)&&o(a.publisher.path,a.originalPublisher.path,b,a.proposed,a.removed)});return this},saveLocalAfterUpdate:function(a){i.subscribe(null,this.fullPath(a),
"after*","*saveLocal");return this}});n(Y,{subscribe:function(a,b,c,d,e){this.length&&u(this,a,b,c,d,e);return this},subscribedBy:function(a,b,c,d,e){this.length&&u(a,this,b,c,d,e);return this},unsubscribe:function(){return this.each(function(){da(this)})},subsFromOthers:function(){return J.getByPublisher(this[0])},subsFromMe:function(){return J.getBySubscriber(this[0])},subscriptions:function(){return J.getByTarget(this[0])},initView:function(a,b,c){u(this,a,"init",b,c);return this},viewId:function(){return this.data(v)},
aliasEvent:function(a,b){this.bind(a,function(){g(this).trigger(b)})}});g.createFilterEvent=function(a,b,c){var d=function(a){(!0===c||c(a))&&g(a.target).trigger(n({},a,{type:b,currentTarget:a.target}))};if(g.event.special[b])throw"event '"+b+"' has been defined";g.event.special[b]={setup:function(){g(this).bind(a,d)},teardown:function(){g(this).unbind(a,d)}};return this};var Xb=g.cleanData;g.cleanData=function(a){g(a).each(function(){da(this)});Xb(a)};ba.getUniqueViewEventTypes=Ra;ba._viewHandlerGateway=
D;var Ib=/\s*([`@!])([#\w\. \*]+):?|\s*(\$)([#\w\. \*]+):/g,Kb=/\s*;\s*/g,Lb=/^([^|]+)(\|([^|]+))?(\|(.+?))??$/,Z=/\s*\|\s*/g,Jb="class",Mb="sub pub class theme ns options".split(" "),fb={},E,s;p.theme="via";p.subsAttr="data-sub";p.autoImportSubs=!0;n(i,{customSubsProps:E={},importSubs:function(){Aa(document.documentElement)},themes:{via:{classes:s={}}},classes:s});n(Y,{findAll:function(a){if(0===this.length)return this;var b=this.filter(a);this.each(function(){b=b.add(g(this).find(a))});return b},
importSubs:function(){return this.each(function(){Aa(this)})},dataSub:function(a){return l(a)?this.data("datasub"):this.data("datasub",a)}});var rb=function(){p.autoImportSubs&&i.importSubs()};g.isReady?setTimeout(rb,10):g(document).bind("ready",rb);var $,ma={},Ba={initialize:"*buildTemplateOptions",get:"get",convert:"*template",set:"html",finalize:"*importSubs"};ja.buildTemplateOptions=function(a,b,c,d){if(m(d))d=d.split(","),c.templateId=g.trim(d[0]),c.useDataSourceAsArrayItem="true"==g.trim(d[1]),
c.engineName=d[2];else if(x(d)&&d.templateId)n(c,d);else if(!(c.templateId=g(b).data("defaultTemplate")))if(a=g.trim(g(b).html()))g(b).empty(),c.templateId="__"+g.uuid++,$.compile(c.templateId,a),g(b).data("defaultTemplate",c.templateId);else throw"missing template";};xa.template=function(a,b){if(a&&(I(a)&&a.length||!I(a))){var c=b.publisher,d=b.handler,e;var f=d.templateId,h=d.useDataSourceAsArrayItem?[a]:a;e={modelPath:c.path,e:b,get:function(){return c.get.apply(c,H.call(arguments))}};var i=gb(d.engineName,
f),f=g.trim(f);if(!i.isTemplateLoaded||i.isTemplateLoaded(f))e=i.render(f,h,e);else{var j=g.Deferred(),d=n(!0,{},e.e),k=n(!0,{},d.publisher),l=n(!0,{},e);d.publisher=k;l.e=d;$.load(f).done(function(){var a=i.render(f,h,l),b=g(a);j.resolve(b.selector||!b.length?a:b)});e=j.promise()}if(W(e))return e;m(e)&&(e=g.trim(e));return g(g("<div />").html(e)[0].childNodes)}return""};ya.importSubs=function(a){g(a).importSubs()};i.handlers({renderInside:Ba,render:R("get","replaceWith")});s.forOnce="!init:.|*renderInside";
s.forObject="!init after*.:.|*renderInside";s.forArray="!init after*. after*.1:.|*renderInside";s.forAll="!init after*:.|*renderInside";s.render="!init:.|*render";Y.renderInside=function(a,b,c){b=b||"";t(c)&&(c={finalize:c});return this.initView(b,c?n({},Ba,c):"*renderInside",a)};Y.render=function(a,b,c){t(c)&&(c={finalize:c});return this.initView(a,c?n({},i.handlers("render"),c):"*render",b)};i.template=$={defaultEngine:"",engines:function(a,b,c){if(!a)return ma;if(!b)return ma[a];ma[a]=b;c||($.defaultEngine=
a)},load:function(a){if("undefined"==typeof matrix)throw"The method via.template.load require matrix.js,or you need override the method";return matrix(a+".template")},compile:function(a,b,c){return gb(c).compile(a,b)},buildTemplateHandler:R};var L,sb=function(a){return null===a||a===w?"":""+a};n(!0,i.filters,{getters:{getOriginalModel:function(a){return a.originalPublisher.get()},getViewValue:function(a){return a.handler.getViewValue(a.publisher)}},setters:{setViewValue:function(a,b){return b.handler.setViewValue(this,
a,b)}},converters:{toString:sb,toTypedValue:Q,toNumber:function(a){return+a},toDate:function(a){return new Date(a)}}});i.handlers({updateViewValue:{initialize:function(a,b,c,d){a=hb(b,d);if(!a||!a.set)throw"can not find set method for view";c.setViewValue=a.set;a.initialize&&!b.data("accesserInitialized")&&(a.initialize(b),b.data("accesserInitialized",!0))},get:"get",set:"*setViewValue"},updateModelValue:{initialize:function(a,b,c,d){d=hb(a,d);if(!d||!d.get)throw"can not find get method for view";
c.getViewValue=d.get;d.initialize&&!a.data("accesserInitialized")&&(d.initialize(a),b.data("accesserInitialized",!0))},get:"*getViewValue",set:"set"},options:{get:function(a){var b=a.handler.options,c=this.val();this.children("option[listItem]").remove().end().append(function(){var c="";g(a.publisher.get()).each(function(){c+="<option listItem='1' value='"+b.value(this)+"'>"+b.name(this)+"</option>"});return c}).val(c);this.val()!==c&&g(this.trigger("change"))},initialize:function(a,b,c,d){if(d){var a=
d.split(","),e=a[0],f=a[1]||a[0];c.options={name:function(a){return a[e]},value:function(a){return a[f]}}}else c.options={name:function(a){return a.toString()},value:function(a){return a.toString()}}}},hide:function(a){this[l(a.handler.options)?a.publisher.isEmpty()?"show":"hide":a.publisher.compare(a.handler.options)?"hide":"show"]()},show:function(a){this[l(a.handler.options)?a.publisher.isEmpty()?"hide":"show":a.publisher.compare(a.handler.options)?"show":"hide"]()},showPlural:function(a){a=a.publisher.get();
this[1<(a.length||a)?"show":"hide"]()},textCount:function(a){a=a.publisher.get();this.text("length"in a?a.length:a)},enable:function(a){this.attr("disabled",l(a.handler.options)?a.publisher.isEmpty():!a.publisher.compare(a.handler.options))},disable:function(a){this.attr("disabled",l(a.handler.options)?!a.publisher.isEmpty():a.publisher.compare(a.handler.options))},showValue:function(a){this.html("<span style='color:red'>"+a.publisher.path+" : "+a.publisher.toJSON()+"</span>")},appendTmplItem:R("*getOriginalModel",
"append"),updateTmplItem:R(function(a){return a.publisher.get(Ca(a))},function(a,b){this.children().eq(+Ca(b)).replaceWith(a)}),removeTmplItem:{get:function(a){this.children().eq(+Ca(a)).remove()}},addClass:function(a){this[a.publisher.get()?"addClass":"removeClass"](a.handler.options)},removeClass:function(a){this[a.publisher.get()?"removeClass":"addClass"](a.handler.options)},focus:function(a){if(a.publisher.get()){var b=this;setTimeout(function(){b.focus()},1)}},del:function(){this.del()},"++":function(){this.set(this.get()+
1)},"--":function(){this.set(this.get()-1)},hardCode:{initialize:function(a,b,c,d){c.hardCode=Q(d)},get:function(a){this.set(a.handler.hardCode)}},"null":function(){this.set(null)},"true":function(){this.set(!0)},"false":function(){this.set(!1)},toggle:function(){this.set(!this.get())},"0":function(){this.set(0)},preventDefault:function(a){a.preventDefault()},stopPropagation:function(a){a.stopPropagation()},alert:function(a){alert(l(a.handler.options)?this.get():a.handler.options)},log:function(){},
sort:{initialize:function(a,b,c,d){d=d.split(",");c.by=d[0];c.asc=!!d[1]},get:function(a){a=a.handler;this.sort(a.by,a.asc);a.asc=!a.asc}}});L=[{name:"textBoxOrDropDown",get:function(a){return a.val()},set:function(a,b){a.val()!==b&&a.val(b)},match:U},{name:"checkbox",get:ib,set:function(a,b){var c=a[0];c.checked=qa(b)?b:b==c.value},match:function(a){return a.is(":checkbox")}},{name:"radio",get:ib,set:function(a,b,c){a=a[0];a.name||(a.name=c.publisher.path);a.checked=sb(b)==a.value},match:function(a){return a.is(":radio")}},
{name:"listBox",get:function(a){var b=[];a.children("option:selected").each(function(){b.push(this.value)});return b},set:function(a,b){function c(){if(this.value==e)return this.selected=!0,!1}a.children("option:selected").removeAttr("selected");for(var d=0,e;d<b.length;d++)e=b[d],a.children("option").each(c)},match:function(a){return a.is("select[multiple]")}}];i.addViewValueAdapters=function(a){if(I(a))for(var b=0;b<a.length;b++)L.push(a[b]);else L.push(a)};n(E,{caption:function(a,b,c,d){g(a).prepend("<option value=''>"+
d+"</option>")},val:function(a,b,c,d){var e,f=b.ns;(d=d||"")?(d=d.split(","),b=d[0]||"change",e=d[1]):b="change";(!e||"updateView"==e)&&c.push({publisher:f,eventTypes:"init1 after*",subscriber:a,handler:"*updateViewValue",options:d[2]});(!e||"updateModel"==e)&&c.push({publisher:a,eventTypes:b+" resetForm",subscriber:f,handler:"*updateModelValue",options:d[2]})},focusLater:function(a){setTimeout(function(){g(a).focus()},1)},aliasEvent:function(a,b,c,d){setTimeout(function(){var b,c,h=d.split(";"),
i=g(a);for(b=0;b<h.length;b++)c=h[b].split(","),i.aliasEvent(c[0],c[1])},1)},initSubs:function(a,b,c,d){j.get(d,a,b,c,d)}});n(s,{listView:"!init after*.:.|*renderInside!afterCreate.1:.|*appendTmplItem!afterUpdate.1:.|*updateTmplItem!afterDel.1:.|*removeTmplItem",fullUpdateListView:"!init after*:.|*renderInside",val:"@val:.",options:"!init after*:.|*options",show:"!init after*:.|*show",hide:"!init after*:.|*hide",addClass:"!init after*:.|*addClass",removeClass:"!init after*:.|*removeClass",focus:"!init after*:.|*focus",
enableLater:"!after*:.|*enable",disableLater:"!after*:.|*disable",enable:"!init after*:.|*enable",disable:"!init after*:.|*disable",html:"!init after*:.|get html *toString",text:"!init after*:.|get text *toString",showPlural:"!init after*:.|*showPlural",showValue:"!init after*:.|*showValue",textCount:"!init after*:.|*textCount",alert:"$click:.|*alert",preventDefault:"$click:.|*preventDefault",deleteButton:"@aliasEvent:click,delete",updateButton:"@aliasEvent:click,update",editButton:"@aliasEvent:click,edit",
cancelButton:"@aliasEvent:click,cancel",pageButton:"@aliasEvent:click,changePage"});g.createFilterEvent("keyup","enter",function(a){return 13===a.keyCode}).createFilterEvent("keyup","esc",function(a){return 27===a.keyCode});g.Event.prototype.selectedRowIndex=function(){return this.publisher.children().filter(this.originalPublisher.parents()).index()};p.errors={defaultError:"Please enter a valid value"};var Ea="afterUpdate validate",Ja=B.pathsOfInvalidModels=[],na=i("*pathsOfInvalidModels"),Nb=/^\s*$/,
tb=/^\d+$/,Yb=/^(\/(\\[^\x00-\x1f]|\[(\\[^\x00-\x1f]|[^\x00-\x1f\\\/])*\]|[^\x00-\x1f\\\/\[])+\/[gim]*)(,(.*))*$/,ea=/([^,]+)(,(.*))?/,ub=/(\w+),(\w+)(,(.*))?/;i.validators=function(a){if(I(a)){for(var b=0;b<a.length;b++)i.validators(a[b]);return this}b=a.name;if(E[b])throw"validator name '"+b+"' collide with name in via.rules";if(i.handlers(b))throw"validator name '"+b+"' collide with name in via.handlers";a.error&&(p.errors[b]=a.error);var c="v_"+b;i.handlers(c,lb(a));s[b]="!afterUpdate validate:.|*"+
c};i.validators([{name:"required",error:"This field is required.",isValid:function(){return!0}},{name:"email",error:"Please enter a valid email address.",isValid:S(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i)},
{name:"url",error:"Please enter a valid URL.",isValid:S(/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i)},
{name:"date",error:"Please enter a valid date.",isValid:S(/Invalid|NaN/,!0)},{name:"dateISO",error:"Please enter a valid date (ISO).",isValid:S(/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/)},{name:"number",error:"Please enter a valid number.",isValid:S(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/)},{name:"digits",error:"Please enter only digits.",isValid:S(tb)},{name:"creditcard",error:"Please enter a valid credit card number.",isValid:function(a){if(/[^0-9\-]+/.test(a))return!1;for(var b=0,c=0,d=!1,a=a.replace(/\D/g,
""),e=a.length-1;0<=e;e--){c=a.charAt(e);c=parseInt(c,10);if(d&&9<(c*=2))c-=9;b+=c;d=!d}return 0===b%10}},{name:"minlength",error:"Please enter at least {0} characters.",isValid:function(a,b){return a.length>=b.minlength},initialize:function(a,b,c,d){var e;if(d&&(e=ea.exec(d)))c.options={minlength:+e[1],error:e[3]};else throw"invalid options for minlength validator";},buildError:M("minlength")},{name:"maxlength",error:"Please enter no more than {0} characters.",isValid:function(a,b){return a.length<=
b.maxlength},initialize:function(a,b,c,d){var e;if(d&&(e=ea.exec(d)))c.options={maxlength:+e[1],error:e[3]};else throw"invalid options for maxlength validator";},buildError:M("maxlength")},{name:"rangelength",error:"Please enter a value between {0} and {1} characters long.",isValid:function(a,b){return a.length>=b.minlength&&a.length<=b.maxlength},initialize:function(a,b,c,d){var e;if(d&&(e=ub.exec(d)))c.options={minlength:+e[1],maxlength:+e[2],error:e[4]};else throw"invalid options for rangelength validator";
},buildError:M("minlength","maxlength")},{name:"min",error:"Please enter a value greater than or equal to {0}.",isValid:function(a,b){return a>=b.min},initialize:function(a,b,c,d){var e;if(d&&(e=ea.exec(d)))c.options={min:+e[1],error:e[3]};else throw"invalid options for min validator";},buildError:M("min")},{name:"max",error:"Please enter a value less than or equal to {0}.",isValid:function(a,b){return a<=b.max},initialize:function(a,b,c,d){var e;if(d&&(e=ea.exec(d)))c.options={max:+e[1],error:e[3]};
else throw"invalid options for max validator";},buildError:M("max")},{name:"range",error:"Please enter a value between {0} and {1}.",isValid:function(a,b){return a>=b.min&&a<=b.max},initialize:function(a,b,c,d){var e;if(d&&(e=ub.exec(d)))c.options={min:+e[1],max:+e[2],error:e[4]};else throw"invalid options for range validator";},buildError:M("min","max")},{name:"equal",error:"Please enter the same value again.",isValid:function(a,b){return j.get(b.comparePath)===a},initialize:function(a,b,c,d){var e;
if(d&&(e=ea.exec(d)))b=a.cd(e[1]).path,c.options={comparePath:b,error:e[3]},a.subscribe(b,"afterUpdate",function(){this.isEmpty()||o(this.path,this.path,"validate",this.get())});else throw"invalid options for equal validator";}},{name:"regex",error:"Please enter a value match with required pattern.",isValid:function(a,b){return b.regex.test(a)},initialize:function(a,b,c,d){var e;if(d&&(e=Yb.exec(d)))c.options={regex:eval(e[1]),error:e[5]};else throw"invalid options for regex validator";}},{name:"fixedValue",
error:'Please enter value "{0}"',isValid:function(a,b){return a==b.fixedValue},initialize:function(a,b,c,d){if(m(d)){if(a=/^(\w+)(,(.*))*$/.exec(d))c.options={fixedValue:Q(a[1]),error:a[3]}}else if(x(d))c.options=d;else throw"missing options in fixedValue validator";},buildError:M("fixedValue")}]);n(P,{isValid:function(a){a=this.fullPath(a);jb(a,function(a){o(a,a,"validate",j.get(a))});a:if(""===a)a=!Ja.length;else{for(var b=a+".",c=0,d,e=Ja.length;c<e;c++)if(d=Ja[c],d==a||d.startsWith(b)){a=!1;break a}a=
!0}return a},check:function(a,b){if(x(a)){var c,d,e,f,h,g=a;for(c in g){d=this.fullPath(c);e=g[c];for(f=0;f<e.length;f++)h=e[f],m(h)||x(h)?Da(d,h):I(h)&&Da(d,h[0],h[1])}}else t(a)||m(a)&&a.startsWith("#")?(m(a)&&(a=this.helper(a.substr(1))),u(null,this.path,Ea,function(b){b.publisher.clearErrors();var c=a(b.publisher.get());m(c)&&b.publisher.addError(c);!1===c&&b.publisher.addError(p.errors.defaultError)})):m(a)&&Da(this.path,a,b);return this},clearErrors:function(a){var b=this.fullPath(a);mb(b);
N(this.get(a))||jb(b,mb)},addError:function(a){this.createIfUndefined("*errors",[]).cd("*errors").pushUnique(a);na.pushUnique(this.path);return this},removeError:function(a){this.createIfUndefined("*errors",[]).cd("*errors").removeItem(a).isEmpty()&&na.removeItem(this.path);return this}});i.isValid=function(a){return j.isValid(a)};i.onDisposing(function(a){na.removeItem(a)});i.handlers({validate:function(a){i.isValid(this.path)||a.stopImmediatePropagation()},showError:function(a){a.publisher.isEmpty()?
this.removeClass("error").next("span.error").remove():this.addClass("error").next("span.error").remove().end().after("<span class='error'>"+a.publisher.get()+"</span>")}});n(E,{check:function(a,b,c,d){if(!d)throw"missing validator path";d.startsWith("#")||(d="#"+d);i(b.ns).check(d)},validate:function(a,b){u(b.ns,a,"click","*validate")},resetFormErrors:function(a,b){g(a).bind("reset",function(){setTimeout(function(){g(a).find(":input").trigger("resetForm");i(b.ns).clearErrors()},1)})}});n(s,{showError:"!after*:*errors|*showError",
validate:"@validate:.",check:"@check:.",resetFormErrors:"@resetFormErrors:."});E.queryableListView=function(a,b,c,d){i(b.ns).queryable(!!d)};P.queryable=function(a){var b=this.path;if(!this.get("*query")){var c={autoQuery:!!a,hasResult:!1,triggerQueryChange:function(){c.autoQuery||setTimeout(function(){o(b+"*queryResult",b+"*queryResult","afterUpdate")},0)},query:{page:{enabled:!1,index:0,count:1,size:0},sort:{by:null,asc:null},filter:{fn:function(){if(this.get("ops")&&this.get("by")&&this.get("value")){var a=
c.query.filter,b=a.ops,f=a.by,a=a.value,g;"equals"==b?g=z("^"+a+"$","i"):"contains"==b&&(g=z(a,"i"));return function(){return g?g.test(this[f]):!0}}},by:"",value:"",ops:"",enabled:function(){return!!this.get("fn")}},enabled:function(){return this.get("page.enabled")||this.get("sort.by")||this.get("filter.enabled")}},queryResult:function(a){"this.get('query')";var c=g(j.get(b)),f=this.cd("query"),h=f.get("filter.fn"),c=h?c.filter(h).get():c.get();j.update(b+"*hasResult",0<c.length);f.get("sort.by")&&
c.sortObject(f.get("sort.by"),f.get("sort.asc"));f=f.get("page");!a&&f.enabled&&(a=Math.ceil(c.length/f.size)||1,a!=f.count&&(f.count=a,f.index>f.count-1&&(f.index=0),i(b+"*query.page").triggerChange()),c=c.slice(f.index*f.size,(f.index+1)*f.size));return c},changePage:function(a){if(x(a)&&(a=a.originalPublisher.attr("page"),!a))return;var e=j.get(b+"*query.page");tb.test(a)?a=+a:"next"==a?a=e.index+1:"previous"==a?a=e.index-1:"first"==a?a=0:"last"==a?a=e.count-1:"disabled"==a&&(a=0,c.resetPaging());
if("number"!==typeof a||0>a||a>e.count-1)a=0;j.update(b+"*query.page.index",a);c.triggerQueryChange()},resetSort:function(){j.set(b+"*query.sort.by",null).set(b+"*query.sort.asc",null)},resetFilter:function(){j.update(b+"*query.filter.by","").update(b+"*query.filter.value","").update(b+"*query.filter.ops","")},resetPaging:function(){j.update(b+"*query.page.enabled",!1).update(b+"*query.page.size",0).update(b+"*query.page.count",1).update(b+"*query.page.index",0)},resetQuery:function(){c.resetSort();
c.resetFilter();c.resetPaging()}};this.extend("*",c).cd("*queryResult").watchPath(b);c.autoQuery||this.cd("*queryResult").unwatchPath(b+"*query")}};n(s,{queryChanged:"$click:*triggerQueryChange",queryableListView:"@rowContainer@queryableListView!init after*:*queryResult|*renderInside",sort:"$click:*query.sort.by|*hardCode$click:*query.sort.asc|*toggle`queryChanged",resetSort:"!init afterUpdate:*query.sort.by|*show;$click:*resetSort`queryChanged",pager:"!init after*:*query.page|*renderInside!init after*:*hasResult|*show|_`changePage`preventDefault",
changePage:"$changePage:*changePage",applyPaging:"!init afterUpdate:*query.page.size|*enable$click:*query.page.enabled|*true`queryChanged",applyFilter:"`enable:*query.filter.enabled`queryChanged",resetFilter:"`show:*query.filter.enabled$click:*resetFilter`queryChanged",resetQuery:"$click:*resetQuery`queryChanged!init afterUpdate:*query.enabled|*show",withQueryResult:"`show:*hasResult",withoutQueryResult:"`hide:*hasResult"});i.handlers("alignAfterRemove",function(a){var b,c,d,e,f,h,i,j=a.originalPublisher.indexPath(),
k,a=a.publisher.path,a="("+a.replace(".","\\.")+"\\.)(\\d+)|("+a.replace(".","#+")+"#+)(\\d+)";k=new z(a,"g");aa.deletedIndex=j;for(b in q)if(la.call(q,b)){a=q[b];c=b.replace(k,aa);c!==b&&(q[c]=a,delete q[b]);for(d=0;d<a.length;d++)c=a[d],e=c.replace(k,aa),e!=c&&(a[d]=e)}for(b in B)la.call(B,b)&&(c=b.replace(k,aa),c!=b&&(B[c]=B[b],delete B[b]));g(this).children(":gt("+j+")").find("*").andSelf().each(function(){var a,b,c,e,j;if(a=g(this).dataSub())if(b=a.ns.replace(k,oa),b!=a.ns){a.ns=b;f=g(this).subscriptions();
for(d=0;d<f.length;d++)i=f[d],m(i.publisher)?i.publisher=i.publisher.replace(k,oa):m(i.subscriber)&&(a=i.subscriber,c=a.replace(k,oa),a!=c&&(i.subscriber=c,h=i.handler,a=i.eventTypes,b=i.eventTypes=a.replace(k,oa),j=h.delegateSelector,c={handler:h,subscriber:c},e=g(i.publisher),j?(e.undelegate(j,a,D),e.delegate(j,b,c,D)):(e.unbind(a,D),e.bind(b,c,D))))}})});s.alignableListView=s.listView+"!afterDel.1:.|*alignAfterRemove";var A={none:0,create:1,update:2};ba.editMode=A;E.editableListView=function(a,
b){var c,d=b.ns,e=i(d);if(!e.get("*edit")){if(e.isShadow()&&!t(e.helper())){c=e.mainModel();var f=(c.logicalPath()+"*edit.item").length+1,d=T(d).substr(f);c=ca(c.get("*edit.itemTemplate."+d+".0"),!0)}else c=j.get(d+"_newItem"),l(c)&&(c=Ha(ca(e.get()[0],!0)));e.get()||e.set([]);e.createIfUndefined("*edit",{mode:0,item:null,selectedIndex:-1,itemTemplate:c});u(null,e.cd("*edit.selectedIndex"),"afterUpdate",function(a){var b=a.publisher,c=b.get("..mode");c==A.update?o(b.cd("..item").path,b.path,"enterUpdateMode"):
c==A.none&&o(b.path,b.path,"cancelUpdateMode",a.proposed,a.removed)});e.cd("*edit.mode").mapEvent("afterUpdate","enterNewMode",function(a,b){return a==A.create&&-1==b.publisher.get("..selectedIndex")}).mapEvent("afterUpdate","cancelNewMode",function(a,b){return a==A.none&&-1==b.publisher.get("..selectedIndex")})}};E.switchUpdateMode=function(a,b,c,d){c.push({publisher:b.ns+"*edit.item",eventTypes:"enterUpdateMode*",subscriber:a,handler:"*renderEditItem",options:d});c.push({publisher:b.ns+"*edit",
eventTypes:"cancelUpdateMode*",subscriber:a,handler:function(a){a.publisher.mainModel().triggerChange(a.removed)}})};n(P,{newRowItem:function(){var a=this.cd("*edit");a.update("item",ca(a.get("itemTemplate"),!0)).update("mode",A.create)},editRowItem:function(a,b){this.get("*edit.mode")!==A.none&&this.resetEditItem();l(b)?b=this.indexOf(a):a=this.get()[b];this.cd("*edit").update("item",ca(a,!0)).update("mode",A.update).update("selectedIndex",b)},resetEditItem:function(){var a=this.cd("*edit");l(a.get())||
a.update("item",null).update("mode",A.none).update("selectedIndex",-1)},saveEditItem:function(){var a=this.get("*edit.mode"),b=this.get("*edit.item"),c=this.helper();a==A.create?(t(c)?this.mainModel().push(b):this.push(b),this.resetEditItem()):a==A.update&&(a=this.get("*edit.selectedIndex"),t(c)?(c=this.get(),this.mainModel().updateItem(c[a],b)):this.updateItem(c[a],b),b=this.cd("*edit"),c=b.get(),c.item=null,b.update("mode",A.none),c.selectedIndex=-1)},removeRowItemByIndex:function(a){this.resetEditItem();
var b=this.helper();t(b)?(b=this.get(),this.mainModel().removeItem(b[a])):this.removeAt(a)}});i.handlers({newRow:function(){this.newRowItem()},editRow:function(a){this.editRowItem(null,a.selectedRowIndex());a.stopPropagation()},saveEditRow:function(a){this.saveEditItem();a.stopPropagation()},saveEditItem:function(a){this.mainModel().saveEditItem();a.stopPropagation()},removeRow:function(a){var b=a.selectedRowIndex();this.removeRowItemByIndex(b);a.stopPropagation()},cancelEditRow:function(a){this.resetEditItem();
a.stopPropagation()},cancelEditItem:function(a){this.mainModel().resetEditItem();a.stopPropagation()},renderNewItem:R(function(a){return a.publisher.get(".mode")===A.create?a.publisher.get(".item"):null},function(a){this.html(a).show()}),renderEditItem:R("get",function(a,b){this.children().eq(b.originalPublisher.get()).replaceWith(a)})});n(s,{deletableRow:"$delete:.|*removeRow",editableDeletableRow:"`deletableRow@editableListView$edit:.|*editRow",editableListView:"`editableDeletableRow$update:.|*saveEditRow$cancel:.|*cancelEditRow@switchUpdateMode:.",
newItemButton:"$click:.|*newRow`hide:*edit.mode",newItemView:"!enterNewMode*:*edit|*renderNewItem!cancelNewMode:*edit.mode|hide"});var vb=[],wb=g.bbq.getState,Ob=g.bbq.pushState;i.trackChange=function(){var a,b,c=wb();for(a=0;a<arguments.length;a++)b=arguments[a],b in c?j.set(b,c[b]):nb(b),u(null,b,"afterUpdate",nb),vb.push(b);return this};g(fa).bind("hashchange",function(){var a=wb(),b;for(b in a)vb.contains(b)&&j.set(b,a[b])});p.selectedClass="selected";p.tabIdAttribute="data-tab";i.handlers({updateTab:function(a){var b=
a.handler.options.split(","),c=b[0],b=b[1]||p.selectedClass;a.publisher.get()==c?this.addClass(b):this.removeClass(b)},selectTab:function(a){this.set(a.handler.options.split(",")[0])}});s.tab="!init afterUpdate:.|*updateTab";s.tabSelector="$click:.|*selectTab`preventDefault`tab";i.handlers("updateTabHolder",function(a){var b=a.publisher.get(),a=(a.handler.options||"").split(","),c=a[0]||p.tabIdAttribute,d=a[1]||p.selectedClass;this.find("["+c+"]").andSelf().each(function(a,f){var h=g(f);h.attr(c)==
b?h.addClass(d):h.removeClass(d)})});i.customSubsProps.tabSelectorHolder=function(a,b,c,d){var d=(d||"").split(","),e=b.ns,f=d[0]||p.tabIdAttribute;g(a).delegate("["+f+"]","click",function(){i.set(e,g(this).attr(f))})};s.tabHolder="!init100 afterUpdate:.|*updateTabHolder";s.tabSelectorHolder="@tabSelectorHolder:.`tabHolder`preventDefault";var xb={},Zb=/^([^,]+)(,(.+))?$/;E.loadapp=function(a,b,c,d){var b=Zb.exec(g.trim(d)),e=b[1],f=b[3],b=xb[e]||matrix(e+".appLoader");b.done?b.done(function(b,c){c.name=
e;var d=c.load,g=c.unload;c.load=function(a,b){pa(a,this.name)||(d.call(this,a,b),pa(a,this.name,this))};c.unload=function(a){pa(a,this.name)&&(g.call(this,a),pa(a,this.name,null))};xb[e]=c;c.load(a,f)}):b.load(a,f)}})(jQuery,window);
