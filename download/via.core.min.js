/*! via.js v0.2beta Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */(function(g,ga,r){function xa(a,b){for(var c in b)a[c]||(a[c]=b[c])}function db(a){return"."===a?"#":ha(a.length+2).join("#")}function eb(a){if(a===p)return"";var b=ya.exec(a);return b?b[1].replace(ia,ja):a}function ja(a){return"#"==a?".":ha(a.length).join("#")}function ka(a,b,c,d){var e,f=a.lastIndexOf(".");h(d)&&(d=!0);d&&(-1===f?(d="",e=a):(d=a.substring(0,f),e=a.substring(f+1)),c(d,e,b));if(!L(b))for(e in b)c(a,e,b[e]),ka(a+"."+e,b[e],c,!1)}function za(a,b,c){if(v(c)&&"_"!=c.name){for(var b=a?
a+"."+b:b,d=c.toString(),e,c=[];e=fb.exec(d);)c.pushUnique(e[2]);for(d=0;d<c.length;d++)Aa(b,a?w(a,c[d]):c[d])}}function Aa(a,b){b=z(b);q[b]=q[b]||[];q[b].pushUnique(a)}function Ba(a,b){b=z(b);q[b].remove(a);q[b].length||delete q[b]}function Ca(a){return(a=gb.exec(a))&&a[1]||""}function hb(a){for(var b=[],c=0;c<a.length;c++)b.push(new this(a[c]));return b}function W(){return!1}function M(){return!0}function N(a,b,c,d,e){this.publisher=A(a);this.originalPublisher=A(b);this.type=c;this.proposed=d;this.removed=
e}function la(a,b){l(a)&&(a=z(a));for(var c=[],d=F.length-1,e;0<=d;d--)e=F[d],b(e,a)&&c.push(e);return c}function ib(a){var b=a.handler,c=b.getMethod,b=b.getProp,a=a.publisher;return b?a[c](b):v(a[c])?a[c]():a[c]}function jb(a,b){var c=b.handler,d=c.setMethod;(c=c.setProp)?this[d](c,a):v(this[d])?this[d](a):this[d]=a}function Da(a,b,c,d){F.push({publisher:a,subscriber:c,eventTypes:b,handler:d})}function Ea(a,b,c){var d=g(b).viewId();return g.map(a.split(ma),function(a){return l(c)?a+"."+p+"."+d+"."+
c:a+"."+p+"."+d+"."+g(c).data(p)}).join(" ")}function A(a){return l(a)?i(a):a==Fa?null:B(a)&&!a.nodeType?a:g(a)}function Ga(a){B(a)&&!g(a).data(p)&&g(a).data(p,++kb)}function lb(a){return"."==a?"\\.":".*"}function Ha(a){var b,c,d;d=a.publisher.subsFromOthers();if(d.length)for(c=0;c<d.length;c++){b=d[c];var e=a,f;a:{f=b.eventTypes;var j=a.type,g=void 0,h=void 0,k=g=void 0,i=void 0;if("*"===f)f="*";else{f=f.split(ma);for(i=0;i<f.length;i++)if(g=f[i],(k=Ia.test(g))&&(g=g.replace(Ia,"")),h=g.replace(mb,
lb),h=k?new x("^"+h):new x("^"+h+"$"),g=h.test(j))if(k){if(k="^"==h.source?j:x.rightContext,!k||!k.contains(".")){f=f[i];break a}}else{f=f[i];break a}f=void 0}}e.subscribedEvent=f;a.subscribedEvent&&X(A(b.subscriber),b.handler,a);if(a.isImmediatePropagationStopped())return}if(!a.isCascadeStopped()&&(b=q[a.publisher.path]))for(d=0;d<b.length;d++){c=m(b[d],a.originalPublisher.path,a.type);if(c.isImmediatePropagationStopped()||c.isImmediatePropagationStopped())break;c.hasError()&&a.error()}}function X(a,
b,c,d){var e;c.handler=b;d=h(d)?b.get.call(a,c):b.get.apply(a,[c].concat(d));if(O(d))e=n(!0,{},c),d.done(function(d){b.convert&&(d=b.convert.call(a,d,c));if(!h(d))if(O(d))d.done(function(c){Y(a,b,c,e)});else return Y(a,b,d,c)});else if(b.convert&&(d=b.convert.call(a,d,c)),!h(d))if(O(d))e=n(!0,{},c),d.done(function(c){Y(a,b,c,e)});else return Y(a,b,d,c)}function Y(a,b,c,d){if(!h(c)&&(b.set&&b.set.call(a,c,d),!h(c)&&b.finalize))return b.finalize.call(a,c,d)}function H(a){a.publisher=A(a.currentTarget);
a.originalPublisher=A(a.target);var b=A(a.data.subscriber),c=a.data.handler;delete a.data;1<arguments.length?X(b,c,a,I.call(arguments,1)):X(b,c,a)}function P(a,b,c,d){var e,a=a||"";if(l(a)){var f=a,g,a=f.split(ma),s=l(b),i=l(c);if(1==a.length)if(f.startsWith("*")){e=J[f.substr(1)];if(!e)throw"common handler "+f+" does not exist";e=n({},e)}else(g=Ja(f,b,c))?e={get:g}:!h(b)&&!h(c)&&(e=s?{get:"get",set:f||"set"}:i?f?{get:f,set:"set"}:{get:o.helper(c)}:{get:f,set:f});else{e={};for(s=0;s<Ka.length;s++)(f=
a[s])&&("_"!==f&&"null"!=f)&&(e[Ka[s]]=(g=Ja(f,b,c))?g:f)}}else if(v(a)||B(a)&&a.get){if(e=a,v(a)&&(e.get=a),!e.set&&!h(c)&&l(c))e.set="set"}else throw"invalid handler";if(!h(b)&&!h(c)){g=e;a=g.initialize;if(l(a))if(a.startsWith("*")){if(a=Z[a.substring(1)],!a)throw"common initializer does not exist!";}else{var k=a;if(!o.helper(k))throw"initializer does not exist at path "+k;a=function(a,b,c,d){o.set(k,a,b,c,d)}}a?(a(A(b),A(c),g,d),delete g.initialize):h(d)||(g.options=d)}d=e;$(d,"initialize",Z);
La("get",d,b,c);La("set",d,b,c);$(d,"convert",na);$(d,"finalize",oa);$(d,"dispose",Ma);return e}function Ja(a,b,c){if(a.startsWith("#"))return a=a.substr(1),l(c)?o.helper(w(c,a)):l(b)?o.helper(w(b,a)):o.helper(a)}function La(a,b,c,d){var e=b[a];if(l(e)&&""!=e){var f="get"==a?Na:Oa;if(e.startsWith("*")){if(e=e.substr(1),b[a]=f[e],!b[a])throw e+" does not exists common "+a+" filter";}else if(e=e.split("*"),b[a]="get"==a?ib:jb,b[a+"Method"]=e[0],e[1]&&(b[a+"Prop"]=e[1]),!h(c)&&!h(d)){var b=e[0],c="get"==
a?c:d,g;l(c)?pa[b]||(g=!0):c.nodeType?Q[b]||(g=!0):b in c||(g=!0);if(g)throw("get"==a?"publisher":"subscriber")+" does not have a member "+b;}}}function $(a,b,c){var d=a[b];l(d)&&(a[b]=d.startsWith("*")?c[d.substr(1)]:function(){return o.set.apply(o,[d].concat(I.call(arguments)))})}function Pa(a){if(a){for(var b=0,c={},d=[],e,f,j;e=nb.exec(a);)d.push({seperator:e[1]||e[3],propertyName:g.trim(e[2]||e[4]),from:(x.leftContext+x.lastMatch).length}),0!==b&&(d[b-1].to=x.leftContext.length),b++;d.length&&
(d[d.length-1].to=a.length);for(b=0;b<d.length;b++)f=d[b],j=f.seperator,e=f.propertyName,f=g.trim(a.substring(f.from,f.to))||null,"`"==j?(f=f?e+"|"+f:e,e="class"):"$"==j?(f=e+"|"+f,e="pub"):"!"==j&&(f=f.split(R),f.splice(1,0,e),f=f.join("|"),e="sub"),c[e]=c[e]?c[e]+";"+f:f;return c}}function Qa(a){var b=i.themes[a],c=[],d=b.parentThemes;!d&&"via"!=a&&(d="via");"null"==d&&(d=r);b.classes&&c.push(b.classes);if(d){d=d.split(";");for(a=0;a<d.length;a++)c=c.concat(Qa(d[a]))}return c}function qa(a,b){for(var c=
g(a);(c=c.parent())&&c.length;){var d=c.dataSub();if(d&&d[b])return d[b]}return""}function Ra(a,b,c,d){var e,f,j,h,i,k,l=c[a]&&c[a].split(";");if(l)for(e=0;e<l.length;e++)if(f=g.trim(l[e]))if(f=f.split(R))"sub"==a?(j=f[0],j=j.startsWith("$")?j:w(c.ns,j),h=f[1],i=b):(j=b,h=f[0],i=f[1],i=i.startsWith("$")?i:w(c.ns,i)),k=f[3],k=S(k?k:c.options),d.push({publisher:j,eventTypes:h,subscriber:i,handler:f[2],options:k,delegate:f[4]})}function Sa(a,b,c){var d,e,f,j,s;if(f=s=b[ob])if(f="_"!==s)b:if(f=b.theme,
!f||!i.themes[f])f=!1;else{if(!i.themes[f].loaded){d=Qa(f);if(!d){f=!1;break b}for(e=d.length-1;j=d[e];e--)for(var l in j)Ta[f+"."+l]=j[l];i.themes[f].loaded=!0}f=!0}if(f){s=s.split(pb);for(l=0;l<s.length;l++)if(d=qb.exec(s[l]),f=d[1],f=g.trim(Ta[b.theme+"."+f]),f=Pa(f))e=d[3],d=d[5],f.ns=w(w(b.ns,e),f.ns),f.theme=b.theme,d?(e=d.split(R),f.options=2==e.length?e[1]:d):f.options=b.options,d&&(j=f.sub,e=f.pub,!j&&e&&1==e.split(";").length?(e=e.split(R),f.pub=h(e[3])?f.pub+("|"+d):f.pub+d):!e&&(j&&1==
j.split(";").length)&&(e=j.split(R),f.sub=h(e[3])?f.sub+("|"+d):f.sub+d)),Sa(a,f,c)}for(var k in b)if(Ua.call(b,k)&&!rb.contains(k))if(aa[k])aa[k](a,b,c,"."==b[k]?b.options:b[k]);else g(a).dataSub()[k]=b[k];Ra("sub",a,b,c);Ra("pub",a,b,c)}function ra(a){if(g(a).attr(C.subsAttr)&&!g(a).dataSub()){var b,c,d;(b=g.trim(g(a).attr(C.subsAttr)))?(b=Pa(b),g(a).dataSub(b),c=b.ns,b.ns=c&&"."!==c?w(qa(a,"ns"),c):qa(a,"ns"),b.theme=b.theme||qa(a,"theme")||C.theme,c=[],Sa(a,b,c),d=c.length?c:r):d=void 0;if(d)for(b=
0;b<d.length;b++)c=d[b],y(c.subscriber,c.publisher,c.eventTypes,c.handler,c.options,c.delegate)}g(a).children().each(function(){ra(this)})}function ba(a,b,c){return n({},sa,B(a)?a:{get:a,set:b,finalize:c})}function Va(a){a=a||T.defaultEngine;if(!a)throw"engine name is not specified or default engine name is null";a=ca[a];if(!a)throw"engine '"+a+"' can not be found.";return a}function ta(a){var a=a.originalPublisher.path.substr(a.publisher.path.length+1),b=a.indexOf(".");return-1==b?a:a.substr(0,b)}
function Wa(a,b){var c,d;if(b)for(c=G.length-1;0<=c;c--){if(d=G[c],d.name==b)return d}else for(c=G.length-1;0<=c;c--)if(d=G[c],d.match&&d.match(a))return d}function Xa(a){a=a[0];return"true"==a.value?!0:"false"==a.value?!1:"on"!==a.value?a.value:a.checked}var i=ga.via=function(a,b){return new ua(a,b)},ua=function(a,b){this.path=z(a||"",!0);h(b)||this.set(b)},pa,n=g.extend,va={},K=g.isArray,v=g.isFunction,sb={undefined:r,"boolean":r,number:r,string:r},p="__via",ya=/^__via\.([^\.]+?)(?:\.|$)/,fb=/this\.(?:get)\s*\(\s*(['"])([\*\.\w\/]+)\1\s*\)/g,
q={},C={},o,U=va[p]={},Ua=va.hasOwnProperty,ha=ga.Array,Ya=ha.prototype,tb=String.prototype,I=Ya.slice,m,ub=/^(?:\{.*\}|\[.*\])$/,Za=/^\.(\.*)([\.\*])/,$a=/^[\.\*]/,vb=/[\.\*]/,wb=/#+|\./g,ia=/#+/g,x=ga.RegExp,gb=/^(.+)[\.\*]\w+$/,w,xb=/^.+\.(\w+)$|\w+/,da,h,L,l,B,ea,O,S,z,fa,ab;xa(Ya,{indexOf:function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]==a)return c;return-1},contains:function(a){return-1!==this.indexOf(a)},remove:function(a){a=this.indexOf(a);-1!=a&&this.splice(a,1);return this},removeAt:function(a){this.splice(a,
1);return this},pushUnique:function(a){this.contains(a)||this.push(a);return this},merge:function(a){if(a&&a.length)for(var b=0;b<a.length;b++)this.pushUnique(a[b]);return this},sortObject:function(a,b){h(b)&&(b=!0);a?this.sort(function(c,d){var e=c[a],f=d[a];return e==f?0:b?e>f?1:-1:e>f?-1:1}):b?this.sort():this.sort().reverse();return this}});xa(tb,{startsWith:function(a){return 0===this.indexOf(a)},contains:function(a){return-1!==this.indexOf(a)},endsWith:function(a){return this.lastIndexOf(a)===
this.length-a.length}});pa=ua.prototype=i.fn=i.prototype={constructor:ua,get:function(a){var b=this.accessor(a,!0);if(b)return b=!b.index?b.hostObj:b.hostObj[b.index],v(b)?b.apply(this.cd(a).cd(".."),I.call(arguments,1)):b},helper:function(a,b){var c;v(a)&&(b=a,a="");if(b)return c=this.accessor(a),c.index in c.hostObj?this.update(a,b,c):this.create(a,b,c);if(c=this.accessor(a,!0))return!c.index?c.hostObj:c.hostObj[c.index]},set:function(a,b){if(1==arguments.length){if(""==this.path)throw"root object can not changed";
o.set(this.path,a);return this}var c=this.accessor(a),d=c.hostObj[c.index];if(v(d)){if(d.length)return d.apply(i(c.physicalPath).cd(".."),I.call(arguments,1));throw"Function at "+c.logicalPath+" is not a setter method";}return c.index in c.hostObj?this.update(a,b,c):this.create(a,b,c)},accessor:function(a,b){0===a&&(a="0");var c,d,e=va,f=this.fullPath(a),g=z(f,!0),i=g.split(".");if(1===i.length)d=g;else{d=i[i.length-1];for(c=0;c<i.length-1&&!(e=e[i[c]],e===r);c++);}if(L(e)){if(b)return;throw"invalid access model using path:"+
f;}return{physicalPath:g,logicalPath:f,hostObj:e,index:d}},create:function(a,b,c){c=c||this.accessor(a);if(c.index in c.hostObj)throw"value at path: '"+c.logicalPath+"' has been defined, try use update method instead";a=c.physicalPath;if(m(a,a,"beforeCreate",b).hasError())return!1;c.hostObj[c.index]=b;m(a,a,"afterCreate");ka(a,b,za);return this},extend:function(a,b){var c;b?c=this.cd(a):(b=a,c=this);for(var d in b)c.set(d,b[d]);return this},update:function(a,b,c,d){ea(a)||(d=c,c=b,b=a,a=!1);d=d||
this.accessor(b);if(!(d.index in d.hostObj))throw"value at path: '"+d.logicalPath+"' has been not defined, try use create method instead";var b=d.physicalPath,e=d.hostObj[d.index];if(e==c)return this;if(!a&&m(b,b,"beforeUpdate",c).hasError())return!1;d.hostObj[d.index]=c;m(b,b,"afterUpdate",c,e);ka(b,c,za);return this},del:function(a){if(a===r)return this.path?o.del(this.path):this;var a=this.accessor(a),b=a.hostObj,c=a.physicalPath,d=K(b);if(m(c,c,"beforeDel").hasError())return!1;var e=b[a.index];
d?b.splice(a.index,1):delete b[a.index];for(b=0;b<wa.length;b++)wa[b](c,a.logicalPath,d);m(c,c,"afterDel",r,e);return this},createIfUndefined:function(a,b){var c=this.accessor(a);return c.index in c.hostObj?this:this.create(a,b,c)},pushStack:function(a){a.previous=this;return a},cd:function(a){return this.pushStack(i(this.fullPath(a)))},parentModel:function(){return this.cd("..")},shadowModel:function(){return this.cd("*")},siblingModel:function(a){return this.cd(".."+a)},mainModel:function(){return this.pushStack(i(eb(this.path)))},
triggerChange:function(a){a=this.physicalPath(a);m(a,a,"afterUpdate");return this},fullPath:function(a){return w(this.path,a)},logicalPath:function(a){return fa(this.fullPath(a))},physicalPath:function(a){return z(this.fullPath(a))},contextPath:function(){return Ca(this.path)},indexPath:function(){var a=xb.exec(this.path);return a[1]||a[0]},indexOf:function(a){return this.get().indexOf(a)},contains:function(a){return-1!==this.indexOf(a)},first:function(a){return a?this.filter(a)[0]:this.get("0")},
last:function(){var a=this.get();return a[a.length-1]},push:function(a){return this.create(this.get().length,a)},pushRange:function(a){for(var b=0;b<a.length;b++)this.push(a[b]);return this},pushUnique:function(a){return!this.contains(a)?this.push(a):this},pop:function(){return this.removeAt(this.get().length-1)},insertAt:function(a,b){this.get().splice(a,0,b);m(this.path,this.path+"."+a,"afterCreate");return this},updateAt:function(a,b){return this.update(a,b)},removeAt:function(a){this.del(a);return this},
prepend:function(a){return this.insertAt(0,a)},updateItem:function(a,b){if(a==b)return this;var c=this.indexOf(a);if(-1!=c)return this.updateAt(c,b);throw"oldItem not found";},removeItem:function(a){a=this.indexOf(a);return-1!==a?this.removeAt(a):this},removeItems:function(a){for(var b=0;b<a.length;b++)this.removeItem(a[b]);return this},clear:function(){var a=this.get();a.splice(0,a.length);m(this.path,this.path,"afterCreate");return this},count:function(){return this.get().length},filter:function(a){return g(this.get()).filter(a).get()},
each:function(a,b){ea(a)||(b=a,a=!1);var c,d,e,f;if(a){f=this.get();for(d=f.length-1;0<=d;d--)if(e=b(d,f[d],f),!0===e)c=!0;else if(!1===e)break;c&&this.triggerChange()}else for(d=this.count()-1;0<=d&&!1!==b(d,this.cd(d),this);d--);},sort:function(a,b){return m(this.path,this.path,"afterUpdate",this.get().sortObject(a,b))},isEmpty:function(a){a=this.get(a);return!a?!0:!K(a)?!1:0===a.length},isShadow:function(){return this.path.startsWith(p)},watchPath:function(a){Aa(this.path,a);return this},unwatchPath:function(a){Ba(this.path,
a);return this},pathsWatching:function(){var a,b,c=[],d=this.path;for(a in q)b=q[a],b.contains(d)&&c.push(a);return c},pathsOfWatchers:function(a){var b=q[this.path]||[];if(a)for(var c=0;c<b.length;c++)b.merge(i(b[c]).pathsOfWatchers(a));return b},toJSON:function(a){return JSON.stringify(this.get(a))},compare:function(a){return eval("this.get()"+a)}};var wa=[function(a,b){for(var c in q)Ba(a,c);for(c in q)c.startsWith(a)&&delete q[c];for(var d in U){c=p+"."+d;var e=fa(c);(e==b||e.startsWith(b+"*")||
e.startsWith(b+"."))&&o.del(c)}}];n(i,{util:da={factory:function(a,b){var c,d;v(a)?c=a:(c=function(){},b=a,a=function(a){n(this,a)});n(c.prototype,b);d=function(){var b=new c;a.apply(b,arguments);return b};d.makeSome=hb;return d},toPhysicalPath:z=function(a,b){for(var c,d="",e="",f;c=vb.exec(a);)a=x.rightContext,e=x.leftContext,"."==c[0]?d?(d==p&&(b&&!U[e])&&(f=e.replace(ia,ja),h(o.get(f))||(U[e]={})),d=d+"."+e):d=e:(d?(c=(d?d.replace(wb,db):d)+"#"+e,f=d+"."+e):f=e?c=e:c="",d=p+(c?"."+c:""),b&&(!U[c]&&
d!=p&&!h(o.get(f)))&&(U[c]={}));return!a?d:d?d+"."+a:a},toLogicalPath:fa=function(a){var b;return a===p?"*":(b=ya.exec(a))?(a=x.rightContext,b=b[1].replace(ia,ja),fa(b+"*"+a)):a},isUndefined:h=function(a){return a===r},isPrimitive:L=function(a){return null===a||typeof a in sb},isString:l=function(a){return"string"===typeof a},isObject:B=function(a){return"object"===g.type(a)},isBoolean:ea=function(a){return"boolean"===typeof a},toTypedValue:S=function(a){if(l(a)){a=g.trim(a);try{a="true"===a?!0:"false"===
a?!1:"null"===a?null:"undefined"===a?r:g.isNumeric(a)?parseFloat(a):ub.test(a)?g.parseJSON(a):a}catch(b){}}return a},isPromise:O=function(a){return!(!a||!a.promise||!a.done||!a.fail)},clearObj:ab=function(a){if(L(a))return null;for(var b in a)Ua.call(a,b)&&(a[b]=ab(a[b]));return a},clone:function(a,b){return L(a)?a:K(a)?a.slice(0):n(!!b,{},a)},local:function(a,b){if(1==arguments.length)return S(localStorage.getItem(a));h(b)?localStorage.removeItem(a):localStorage.setItem(a,JSON.stringify(b))},_modelLinks:q},
onDisposing:function(a){wa.push(a)},options:C,mergeLogicalPath:w=function(a,b,c){if(!h(b)&&(b+="",b.startsWith("/")))return b.substr(1);h(c)&&(c=!0);c&&(b&&a&&!$a.test(b))&&(b="."+b);if(!b||"."==b)return a;if($a.test(b)){if(Za.test(b)){for(var b=Za.exec(b),c=1+(b[1]?b[1].length:0),d=x.rightContext;c;)a=Ca(a),c--;return d?a?a+b[2]+d:d:"*"===b[2]?a+"*":a}}else return b;return a+b}});g(["get","set","del","extend"]).each(function(a,b){i[b]=function(){return o[b].apply(o,I.call(arguments))}});o=i();var Fa=
{},J,ma=/ /,Ia=/\*\.$/,mb=/\.|\*/g,yb=/^(\w+)\.?/,Na,Oa,na,Z,Ma,oa,Q=g.fn,D,kb=0,F=[],y,V,zb=/init(\d*)/,Ka="get set convert initialize finalize dispose".split(" ");N.prototype={consturctor:N,isDependent:function(){return!this.publisher.path.startsWith(this.originalPublisher.path)},stopPropagation:function(){this.isPropagationStopped=M},stopImmediatePropagation:function(){this.isCascadeStopped=this.isPropagationStopped=this.isImmediatePropagationStopped=M},stopCascade:function(){this.isCascadeStopped=
M},error:function(){this.hasError=M},isCascadeStopped:W,isPropagationStopped:W,isImmediatePropagationStopped:W,hasError:W,level:0};m=function(a,b,c,d,e){d=new N(a,b,c,d,e);Ha(d);if(!d.isPropagationStopped()&&d.publisher.path){d.isDependent()&&(d.originalPublisher.path=d.publisher.path);do d.publisher.path=d.publisher.contextPath(),d.level++,d.type=yb.exec(d.type)[1]+"."+d.level,Ha(d);while(!d.isPropagationStopped()&&d.publisher.path)}d.type=c;d.originalPublisher.path=b;d.publisher.path=a;return d};
D={getByPublisher:function(a){return la(a,function(a,c){return a.publisher==c})},getBySubscriber:function(a){return la(a,function(a,c){return a.subscriber==c})},getByTarget:function(a){return!a?F:la(a,function(a,c){return a.subscriber==c||a.publisher==c})}};n(i,{Event:N,trigger:m,subscriptions:D.getByTarget,subscribe:y=function(a,b,c,d,e,f){a instanceof i&&(a=a.path);b instanceof i&&(b=b.path);l(a)&&a.startsWith("$")&&(a=g(a.substr(1)));if(a&&a.jquery)if(!a.length&&!a.selector)a=null;else{a.each(function(a,
g){y(g,b,c,d,e,f)});return}l(b)&&b.startsWith("$")&&(b=g(b.substr(1)));if(b&&b.jquery)b.each(function(b,g){y(a,g,c,d,e,f)});else{if(!b&&""!==b)throw"publisher can not be null";if(!c)throw"eventTypes can not be null";if("_"===a||"null"==a||null===a)a=Fa;"_"===e&&(e=r);var j=l(b),h=l(a);Ga(b);Ga(a);j&&(b=z(b));h&&(a=z(a));if(j){var n=b,k=c,o=a,j=e,t,p,q,m;m=k.split(" ");for(var u=0;u<m.length;u++)if(h=zb.exec(m[u])){p=m[u];t=+h[1];m.splice(u,1);k=m.join(" ");break}q=P(d,n,o,j);k&&Da(n,k,o,q);p&&(k=
function(){var a=new N(n,n,p);X(A(o),q,a)},t?setTimeout(k,t):k())}else(t=b,j=c,h=a,m=e,u=j.split(" "),u.contains("init")&&(k=!0,j=u.remove("init").join(" ")),u=P(d,t,h,m),m={handler:u,subscriber:h},j)?(j=Ea(j,t,h),f?(u.delegateSelector=f,g(t).delegate(f,j,m,H)):g(t).bind(j,m,H),Da(t,j,h,u),k&&(f?g(t).find(f).trigger(j):g(t).trigger(j))):k&&(g(t).one("init",m,H),g(t).trigger("init"))}},unsubscribe:V=function(a){var b;if(B(a)){if(!g(a).viewId())return;g(a).removeData(p)}for(var c=F.length-1,d;0<=c;c--){d=
F[c];b=d.handler;var e;e=a;var f=d.publisher,j=d.subscriber;e=e===f||e===j?!0:l(e)?l(f)&&f.startsWith(e+".")||l(j)&&j.startsWith(e+"."):!1;e&&(l(d.publisher)||(b.delegateSelector?g(d.publisher).undelegate(b.delegateSelector,d.eventTypes,H):g(d.publisher).unbind(d.eventTypes,H)),b.dispose&&b.dispose(d.publisher,d.subscriber),F.splice(c,1))}},handlers:function(a,b,c){var d;if(B(a))for(d in a)J[d]=P(a[d]);else return h(a)?J:h(b)?J[a]:J[a]=c?n(P(b),c):P(b)},filters:{getters:Na={},setters:Oa={},converters:na=
{},initializers:Z={},finalizers:oa={},disposers:Ma={}}});J={triggerChange:{get:function(a){o.triggerChange(a.handler.options)}},saveLocal:{get:function(a){da.local(a.publisher.path,a.publisher.get())}}};i.onDisposing(V);n(pa,{subscribe:function(a,b,c,d,e){y(this.path,a,b,c,d,e);return this},subscribedBy:function(a,b,c,d,e){y(a,this.path,b,c,d,e);return this},unsubscribe:function(){V(this.path);return this},subsFromOthers:function(){return D.getByPublisher(this.path)},subsFromMe:function(){return D.getBySubscriber(this.path)},
subscriptions:function(){return D.getByTarget(this.path)},mapEvent:function(a,b,c){y(this.path,this.path,a,function(a){c(a.publisher.get(),a)&&m(a.publisher.path,a.originalPublisher.path,b,a.proposed,a.removed)});return this},saveLocalAfterUpdate:function(a){i.subscribe(null,this.fullPath(a),"after*","*saveLocal");return this}});n(Q,{subscribe:function(a,b,c,d,e){this.length&&y(this,a,b,c,d,e);return this},subscribedBy:function(a,b,c,d,e){this.length&&y(a,this,b,c,d,e);return this},unsubscribe:function(){return this.each(function(){V(this)})},
subsFromOthers:function(){return D.getByPublisher(this[0])},subsFromMe:function(){return D.getBySubscriber(this[0])},subscriptions:function(){return D.getByTarget(this[0])},initView:function(a,b,c){y(this,a,"init",b,c);return this},viewId:function(){return this.data(p)},aliasEvent:function(a,b){this.bind(a,function(){g(this).trigger(b)})}});g.createFilterEvent=function(a,b,c){var d=function(a){(!0===c||c(a))&&g(a.target).trigger(n({},a,{type:b,currentTarget:a.target}))};if(g.event.special[b])throw"event '"+
b+"' has been defined";g.event.special[b]={setup:function(){g(this).bind(a,d)},teardown:function(){g(this).unbind(a,d)}};return this};var Ab=g.cleanData;g.cleanData=function(a){g(a).each(function(){V(this)});Ab(a)};da.getUniqueViewEventTypes=Ea;da._viewHandlerGateway=H;var nb=/\s*([`@!])([#\w\. \*]+):?|\s*(\$)([#\w\. \*]+):/g,pb=/\s*;\s*/g,qb=/^([^|]+)(\|([^|]+))?(\|(.+?))??$/,R=/\s*\|\s*/g,ob="class",rb="sub pub class theme ns options".split(" "),Ta={},aa,E;C.theme="via";C.subsAttr="data-sub";C.autoImportSubs=
!0;n(i,{customSubsProps:aa={},importSubs:function(){ra(document.documentElement)},themes:{via:{classes:E={}}},classes:E});n(Q,{findAll:function(a){if(0===this.length)return this;var b=this.filter(a);this.each(function(){b=b.add(g(this).find(a))});return b},importSubs:function(){return this.each(function(){ra(this)})},dataSub:function(a){return h(a)?this.data("datasub"):this.data("datasub",a)}});var bb=function(){C.autoImportSubs&&i.importSubs()};g.isReady?setTimeout(bb,10):g(document).bind("ready",
bb);var T,ca={},sa={initialize:"*buildTemplateOptions",get:"get",convert:"*template",set:"html",finalize:"*importSubs"};Z.buildTemplateOptions=function(a,b,c,d){if(l(d))d=d.split(","),c.templateId=g.trim(d[0]),c.useDataSourceAsArrayItem="true"==g.trim(d[1]),c.engineName=d[2];else if(B(d)&&d.templateId)n(c,d);else if(!(c.templateId=g(b).data("defaultTemplate")))if(a=g.trim(g(b).html()))g(b).empty(),c.templateId="__"+g.uuid++,T.compile(c.templateId,a),g(b).data("defaultTemplate",c.templateId);else throw"missing template";
};na.template=function(a,b){if(a&&(K(a)&&a.length||!K(a))){var c=b.publisher,d=b.handler,e;var f=d.templateId,j=d.useDataSourceAsArrayItem?[a]:a;e={modelPath:c.path,e:b,get:function(){return c.get.apply(c,I.call(arguments))}};var h=Va(d.engineName,f),f=g.trim(f);if(!h.isTemplateLoaded||h.isTemplateLoaded(f))e=h.render(f,j,e);else{var i=g.Deferred(),d=n(!0,{},e.e),k=n(!0,{},d.publisher),m=n(!0,{},e);d.publisher=k;m.e=d;T.load(f).done(function(){var a=h.render(f,j,m),b=g(a);i.resolve(b.selector||!b.length?
a:b)});e=i.promise()}if(O(e))return e;l(e)&&(e=g.trim(e));return g(g("<div />").html(e)[0].childNodes)}return""};oa.importSubs=function(a){g(a).importSubs()};i.handlers({renderInside:sa,render:ba("get","replaceWith")});E.forOnce="!init:.|*renderInside";E.forObject="!init after*.:.|*renderInside";E.forArray="!init after*. after*.1:.|*renderInside";E.forAll="!init after*:.|*renderInside";E.render="!init:.|*render";Q.renderInside=function(a,b,c){b=b||"";v(c)&&(c={finalize:c});return this.initView(b,
c?n({},sa,c):"*renderInside",a)};Q.render=function(a,b,c){v(c)&&(c={finalize:c});return this.initView(a,c?n({},i.handlers("render"),c):"*render",b)};i.template=T={defaultEngine:"",engines:function(a,b,c){if(!a)return ca;if(!b)return ca[a];ca[a]=b;c||(T.defaultEngine=a)},load:function(a){if("undefined"==typeof matrix)throw"The method via.template.load require matrix.js,or you need override the method";return matrix(a+".template")},compile:function(a,b,c){return Va(c).compile(a,b)},buildTemplateHandler:ba};
var G,cb=function(a){return null===a||a===r?"":""+a};n(!0,i.filters,{getters:{getOriginalModel:function(a){return a.originalPublisher.get()},getViewValue:function(a){return a.handler.getViewValue(a.publisher)}},setters:{setViewValue:function(a,b){return b.handler.setViewValue(this,a,b)}},converters:{toString:cb,toTypedValue:S,toNumber:function(a){return+a},toDate:function(a){return new Date(a)}}});i.handlers({updateViewValue:{initialize:function(a,b,c,d){a=Wa(b,d);if(!a||!a.set)throw"can not find set method for view";
c.setViewValue=a.set;a.initialize&&!b.data("accesserInitialized")&&(a.initialize(b),b.data("accesserInitialized",!0))},get:"get",set:"*setViewValue"},updateModelValue:{initialize:function(a,b,c,d){d=Wa(a,d);if(!d||!d.get)throw"can not find get method for view";c.getViewValue=d.get;d.initialize&&!a.data("accesserInitialized")&&(d.initialize(a),b.data("accesserInitialized",!0))},get:"*getViewValue",set:"set"},options:{get:function(a){var b=a.handler.options,c=this.val();this.children("option[listItem]").remove().end().append(function(){var c=
"";g(a.publisher.get()).each(function(){c+="<option listItem='1' value='"+b.value(this)+"'>"+b.name(this)+"</option>"});return c}).val(c);this.val()!==c&&g(this.trigger("change"))},initialize:function(a,b,c,d){if(d){var a=d.split(","),e=a[0],f=a[1]||a[0];c.options={name:function(a){return a[e]},value:function(a){return a[f]}}}else c.options={name:function(a){return a.toString()},value:function(a){return a.toString()}}}},hide:function(a){this[h(a.handler.options)?a.publisher.isEmpty()?"show":"hide":
a.publisher.compare(a.handler.options)?"hide":"show"]()},show:function(a){this[h(a.handler.options)?a.publisher.isEmpty()?"hide":"show":a.publisher.compare(a.handler.options)?"show":"hide"]()},showPlural:function(a){a=a.publisher.get();this[1<(a.length||a)?"show":"hide"]()},textCount:function(a){a=a.publisher.get();this.text("length"in a?a.length:a)},enable:function(a){this.attr("disabled",h(a.handler.options)?a.publisher.isEmpty():!a.publisher.compare(a.handler.options))},disable:function(a){this.attr("disabled",
h(a.handler.options)?!a.publisher.isEmpty():a.publisher.compare(a.handler.options))},showValue:function(a){this.html("<span style='color:red'>"+a.publisher.path+" : "+a.publisher.toJSON()+"</span>")},appendTmplItem:ba("*getOriginalModel","append"),updateTmplItem:ba(function(a){return a.publisher.get(ta(a))},function(a,b){this.children().eq(+ta(b)).replaceWith(a)}),removeTmplItem:{get:function(a){this.children().eq(+ta(a)).remove()}},addClass:function(a){this[a.publisher.get()?"addClass":"removeClass"](a.handler.options)},
removeClass:function(a){this[a.publisher.get()?"removeClass":"addClass"](a.handler.options)},focus:function(a){if(a.publisher.get()){var b=this;setTimeout(function(){b.focus()},1)}},del:function(){this.del()},"++":function(){this.set(this.get()+1)},"--":function(){this.set(this.get()-1)},hardCode:{initialize:function(a,b,c,d){c.hardCode=S(d)},get:function(a){this.set(a.handler.hardCode)}},"null":function(){this.set(null)},"true":function(){this.set(!0)},"false":function(){this.set(!1)},toggle:function(){this.set(!this.get())},
"0":function(){this.set(0)},preventDefault:function(a){a.preventDefault()},stopPropagation:function(a){a.stopPropagation()},alert:function(a){alert(h(a.handler.options)?this.get():a.handler.options)},log:function(){},sort:{initialize:function(a,b,c,d){d=d.split(",");c.by=d[0];c.asc=!!d[1]},get:function(a){a=a.handler;this.sort(a.by,a.asc);a.asc=!a.asc}}});G=[{name:"textBoxOrDropDown",get:function(a){return a.val()},set:function(a,b){a.val()!==b&&a.val(b)},match:M},{name:"checkbox",get:Xa,set:function(a,
b){var c=a[0];c.checked=ea(b)?b:b==c.value},match:function(a){return a.is(":checkbox")}},{name:"radio",get:Xa,set:function(a,b,c){a=a[0];a.name||(a.name=c.publisher.path);a.checked=cb(b)==a.value},match:function(a){return a.is(":radio")}},{name:"listBox",get:function(a){var b=[];a.children("option:selected").each(function(){b.push(this.value)});return b},set:function(a,b){function c(){if(this.value==e)return this.selected=!0,!1}a.children("option:selected").removeAttr("selected");for(var d=0,e;d<
b.length;d++)e=b[d],a.children("option").each(c)},match:function(a){return a.is("select[multiple]")}}];i.addViewValueAdapters=function(a){if(K(a))for(var b=0;b<a.length;b++)G.push(a[b]);else G.push(a)};n(aa,{caption:function(a,b,c,d){g(a).prepend("<option value=''>"+d+"</option>")},val:function(a,b,c,d){var e,f=b.ns;(d=d||"")?(d=d.split(","),b=d[0]||"change",e=d[1]):b="change";(!e||"updateView"==e)&&c.push({publisher:f,eventTypes:"init1 after*",subscriber:a,handler:"*updateViewValue",options:d[2]});
(!e||"updateModel"==e)&&c.push({publisher:a,eventTypes:b+" resetForm",subscriber:f,handler:"*updateModelValue",options:d[2]})},focusLater:function(a){setTimeout(function(){g(a).focus()},1)},aliasEvent:function(a,b,c,d){setTimeout(function(){var b,c,h=d.split(";"),i=g(a);for(b=0;b<h.length;b++)c=h[b].split(","),i.aliasEvent(c[0],c[1])},1)},initSubs:function(a,b,c,d){o.get(d,a,b,c,d)}});n(E,{listView:"!init after*.:.|*renderInside!afterCreate.1:.|*appendTmplItem!afterUpdate.1:.|*updateTmplItem!afterDel.1:.|*removeTmplItem",
fullUpdateListView:"!init after*:.|*renderInside",val:"@val:.",options:"!init after*:.|*options",show:"!init after*:.|*show",hide:"!init after*:.|*hide",addClass:"!init after*:.|*addClass",removeClass:"!init after*:.|*removeClass",focus:"!init after*:.|*focus",enableLater:"!after*:.|*enable",disableLater:"!after*:.|*disable",enable:"!init after*:.|*enable",disable:"!init after*:.|*disable",html:"!init after*:.|get html *toString",text:"!init after*:.|get text *toString",showPlural:"!init after*:.|*showPlural",
showValue:"!init after*:.|*showValue",textCount:"!init after*:.|*textCount",alert:"$click:.|*alert",preventDefault:"$click:.|*preventDefault",deleteButton:"@aliasEvent:click,delete",updateButton:"@aliasEvent:click,update",editButton:"@aliasEvent:click,edit",cancelButton:"@aliasEvent:click,cancel",pageButton:"@aliasEvent:click,changePage"});g.createFilterEvent("keyup","enter",function(a){return 13===a.keyCode}).createFilterEvent("keyup","esc",function(a){return 27===a.keyCode});g.Event.prototype.selectedRowIndex=
function(){return this.publisher.children().filter(this.originalPublisher.parents()).index()}})(jQuery,window);
